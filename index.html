<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Logo da Empresa - Sistema de Eventos</title>
  <link rel="stylesheet" href="sistema.css" />
  <script src="scriptindex.js" defer></script>
  <script src="formulario.js" defer></script>
</head>
<body>
   <button onclick="showPage('pagina_inicial')">In√≠cio</button>
  <button onclick="showPage('pagina2')">P√°gina 2</button>

  <div id="pagina_inicial" class="page">Conte√∫do inicial</div>
  <div id="pagina2" class="page" style="display:none;">Conte√∫do 2</div>
 
  <!-- ==================== TOPO ==================== -->
  <header class="topbar">
    <div class="brand">Nome da Empresa- Sistema de Eventos</div>
    <div class="top-actions">
      <span id="userName">Administrador</span>
      <span id="userClock">--:--:--</span>
      <button id="logoutBtn" class="btn danger">Sair</button>
    </div>
  </header>

  <!-- ==================== LAYOUT: SIDEBAR + MAIN ==================== -->
  <div class="app-root">
    <!-- BARRA LATERAL ESQUERDA -->
    <aside class="sidebar" id="sidebar">
      <nav class="sidebar-nav">
        <!-- PAINEL (Dashboard) -->
        <button class="nav-btn active" data-page="dashboard">
          <span class="nav-icon">üè†</span>
          <span class="nav-text">Painel</span>
        </button>

        <!-- EVENTOS -->
        <div class="nav-group">
          <button class="nav-btn" data-toggle="menuEventos">
            <span class="nav-icon">üìÖ</span>
            <span class="nav-text">Eventos</span>
            <span class="nav-arrow">‚ñæ</span>
          </button>
          <div id="menuEventos" class="sidebar-submenu">
            <button class="nav-subbtn" data-page="reservar_evento">
              <span class="submenu-icon">üìù</span>
              <span class="submenu-text">Reservar Evento</span>
            </button>
            <button class="nav-subbtn" data-page="todos_eventos">
              <span class="submenu-icon">üìÖ</span>
              <span class="submenu-text">Todos os Eventos</span>
            </button>
            <button class="nav-subbtn" data-page="eventos_futuros">
              <span class="submenu-icon">üìÖ</span>
              <span class="submenu-text">Eventos Futuros</span>
            </button>
            <button class="nav-subbtn" data-page="confirmar_dados">
              <span class="submenu-icon">‚úÖ</span>
              <span class="submenu-text">Confirmar Dados</span>
            </button>
            <button class="nav-subbtn" data-page="eventos_finalizados">
              <span class="submenu-icon">üìÖ</span>
              <span class="submenu-text">Eventos Finalizados</span>
            </button>
          </div>
        </div>

        <!-- CADASTROS -->
        <div class="nav-group">
          <button class="nav-btn" data-toggle="menuCadastros">
            <span class="nav-icon">üìá</span>
            <span class="nav-text">Cadastros</span>
            <span class="nav-arrow">‚ñæ</span>
          </button>
          <div id="menuCadastros" class="sidebar-submenu">
            <button class="nav-subbtn" data-page="clientes">
              <span class="submenu-icon">üë§</span>
              <span class="submenu-text">Clientes</span>
            </button>
            <button class="nav-subbtn" data-page="casa_de_festas">
              <span class="submenu-icon">üè†</span>
              <span class="submenu-text">Casa de Festas</span>
            </button>
            <button class="nav-subbtn" data-page="elenco">
              <span class="submenu-icon">üé¨</span>
              <span class="submenu-text">Elenco</span>
            </button>
            <button class="nav-subbtn" data-page="personagens">
              <span class="submenu-icon">üé≠</span>
              <span class="submenu-text">Personagens</span>
            </button>
            <button class="nav-subbtn" data-page="motoristas">
              <span class="submenu-icon">üöó</span>
              <span class="submenu-text">Motoristas</span>
            </button>
            <button class="nav-subbtn" data-page="fornecedores">
              <span class="submenu-icon">üì¶</span>
              <span class="submenu-text">Fornecedores</span>
            </button>
            <button class="nav-subbtn" data-page="funcionarios">
              <span class="submenu-icon">üë•</span>
              <span class="submenu-text">Funcion√°rios</span>
            </button>
            
            <!-- CHECK LIST (submenu dentro de Cadastros) -->
            <div class="submenu-group">
              <button class="nav-subbtn" data-toggle="menuCheckList">
                <span class="submenu-icon">‚úÖ</span>
                <span class="submenu-text">Check List</span>
                <span class="nav-arrow">‚ñ∏</span>
              </button>
              <div id="menuCheckList" class="sidebar-submenu-nested">
                <button class="nav-subbtn-nested" data-page="criar_checklist">
                  <span class="submenu-icon">üìù</span>
                  <span class="submenu-text">Criar Check List</span>
                </button>
                <button class="nav-subbtn-nested" data-page="lista_checklists">
                  <span class="submenu-icon">üìã</span>
                  <span class="submenu-text">Lista de Check Lists</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ESCALAS -->
        <div class="nav-group">
          <button class="nav-btn" data-toggle="menuEscalas">
            <span class="nav-icon">üìã</span>
            <span class="nav-text">Escalas</span>
            <span class="nav-arrow">‚ñæ</span>
          </button>
          <div id="menuEscalas" class="sidebar-submenu">
            <button class="nav-subbtn" data-page="escalas">
              <span class="submenu-icon">üßë‚Äçü§ù‚Äçüßë</span>
              <span class="submenu-text">Escalar Equipe</span>
            </button>
          </div>
        </div>

        <!-- FINANCEIRO -->
        <div class="nav-group">
          <button class="nav-btn" data-toggle="menuFinanceiro">
            <span class="nav-icon">üí∞</span>
            <span class="nav-text">Financeiro</span>
            <span class="nav-arrow">‚ñæ</span>
          </button>
          <div id="menuFinanceiro" class="sidebar-submenu">
            <!-- CONTAS A RECEBER -->
            <div class="submenu-group">
              <button class="nav-subbtn" data-page="contasReceber">
                <span class="submenu-icon">üíµ</span>
                <span class="submenu-text">Contas a Receber</span>
                <span class="nav-arrow">‚ñ∏</span>
              </button>
              <div id="contasReceber" class="sidebar-submenu-nested">
                <button class="nav-subbtn-nested" data-page="contas_receber_eventos">
                  <span class="submenu-icon">üéâ</span>
                  <span class="submenu-text">Todos os Eventos</span>
                </button>
              </div>
            </div>
            
            <!-- CONTAS A PAGAR -->
            <div class="submenu-group">
              <button class="nav-subbtn" data-page="contasPagar">
                <span class="submenu-icon">üí≥</span>
                <span class="submenu-text">Contas a Pagar</span>
                <span class="nav-arrow">‚ñ∏</span>
              </button>
              <div id="contasPagar" class="sidebar-submenu-nested">
                <button class="nav-subbtn-nested" data-page="contas_pagar_fornecedores">
                  <span class="submenu-icon">üõí</span>
                  <span class="submenu-text">Fornecedores</span>
                </button>
                <button class="nav-subbtn-nested" data-page="contas_pagar_elenco">
                  <span class="submenu-icon">üßë</span>
                  <span class="submenu-text">Elenco</span>
                </button>
                <button class="nav-subbtn-nested" data-page="contas_pagar_motoristas">
                  <span class="submenu-icon">üöó</span>
                  <span class="submenu-text">Motoristas</span>
                </button>
                <button class="nav-subbtn-nested" data-page="contas_pagar_producao">
                  <span class="submenu-icon">üßë</span>
                  <span class="submenu-tex"></span>Produ√ßao</span>
                  </button>
                <button class="nav-subbtn-nested" data-page="contas_pagar_funcionarios">
                  <span class="submenu-icon">üßæ</span>
                  <span class="submenu-text">Funcion√°rios</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- DISPONIBILIDADE PERSONAGEM -->
        <div class="nav-group">
          <button class="nav-btn" data-toggle="disponibilidade_personagem">
            <span class="nav-icon">üé≠</span>
            <span class="nav-text">Disponibilidade</span>
            <span class="nav-arrow">‚ñæ</span>
          </button>
          <div id="disponibilidade_personagem" class="sidebar-submenu">
            <button class="nav-subbtn" data-page="lista_disponibilidade_personagens">
              <span class="submenu-icon">üìã</span>
              <span class="submenu-text">Lista de Disponibilidade</span>
            </button>
          </div>
        </div>

        <!-- MANUTEN√á√ÉO -->
        <div class="nav-group">
          <button class="nav-btn" data-toggle="manutencao">
            <span class="nav-icon">üö™</span>
            <span class="nav-text">Manuten√ß√£o</span>
            <span class="nav-arrow">‚ñæ</span>
          </button>
          <div id="manutencao" class="sidebar-submenu">
            <button class="nav-subbtn" data-page="cadastrar_manutencao">
              <span class="submenu-icon">üõ†Ô∏è</span>
              <span class="submenu-text">Cadastrar Manuten√ß√£o</span>
            </button>
            <button class="nav-subbtn" data-page="lista_de_manutencao">
              <span class="submenu-icon">üìã</span>
              <span class="submenu-text">Lista de Manuten√ß√£o</span>
            </button>
          </div>
        </div>

        <!-- RELAT√ìRIOS -->
      <div class="nav-group">
  <button class="nav-btn" data-toggle="menuRelatorios">
    <span class="nav-icon">üìä</span>
    <span class="nav-text">Relat√≥rios</span>
    <span class="nav-arrow">‚ñæ</span>
  </button>
  <div id="menuRelatorios" class="sidebar-submenu">
    
    <!-- RELAT√ìRIOS DE EVENTOS -->
    <button class="nav-subbtn" data-page="relatorios_eventos">
      <span class="submenu-icon">üéâ</span>
      <span class="submenu-text">Eventos</span>
    </button>       
    
    <!-- RELAT√ìRIOS CLIENTES -->
    <button class="nav-subbtn" data-page="relatorios_clientes">
      <span class="submenu-icon">üë•</span>
      <span class="submenu-text">Clientes</span>
    </button>

     <!-- RELAT√ìRIOS PERSONAGENS -->
    <button class="nav-subbtn" data-page="relatorios_personagens">
      <span class="submenu-icon">üë§</span>
      <span class="submenu-text">Personagens</span>
    </button>
    
    <!-- RELAT√ìRIOS CASAS DE FESTA -->
    <button class="nav-subbtn" data-page="relatorios_casas_de_festa">
      <span class="submenu-icon">üè∞</span>
      <span class="submenu-text">Casas de Festa</span>
    </button>

 <!-- RELAT√ìRIOS FINANCEIRO -->
    <div class="submenu-group">
      <button class="nav-subbtn" data-page="relatorios_financeiro">
        <span class="submenu-icon">üí∞</span>
        <span class="submenu-text">Financeiro</span>
        <span class="nav-arrow">‚ñ∏</span>
      </button>
      <div id="relatorios_financeiro" class="sidebar-submenu-nested">
        <button class="nav-subbtn-nested" data-page="relatorios_receitas">
          <span class="submenu-icon">üìà</span>
          <span class="submenu-text">Receitas</span>
        </button>
        <button class="nav-subbtn-nested" data-page="relatorios_despesas">
          <span class="submenu-icon">üìâ</span>
          <span class="submenu-text">Despesas</span>
        </button>
        <button class="nav-subbtn-nested" data-page="relatorios_lucros">
          <span class="submenu-icon">üíπ</span>
          <span class="submenu-text">Lucros</span>
        </button>
    <!-- RELAT√ìRIOS EQUIPE -->
    <div class="submenu-group">
      <button class="nav-subbtn" data-page="relatorios_equipe">
        <span class="submenu-icon">üë•</span>
        <span class="submenu-text">Equipe</span>
        <span class="nav-arrow">‚ñ∏</span>
      </button>
      <div id="relatorios_equipe" class="sidebar-submenu-nested">
        <button class="nav-subbtn-nested" data-page="lista_elenco">
          <span class="submenu-icon">üìù</span>
          <span class="submenu-text">Lista Elenco</span>
        </button>
        <button class="nav-subbtn-nested" data-page="lista_motoristas">
          <span class="submenu-icon">üìã</span>
          <span class="submenu-text">Lista Motoristas</span>
        </button>
        <button class="nav-subbtn-nested" data-page="lista_producao">
          <span class="submenu-icon">üìã</span>
          <span class="submenu-text">Lista Produ√ß√£o</span>
        </button>
        <button class="nav-subbtn-nested" data-page="lista_funcionarios">
          <span class="submenu-icon">üìã</span>
          <span class="submenu-text">Lista Funcion√°rios</span>
        </button>
        </div>
         </div>
           </div>
    </div>
        </div>
     
<!-- ==================== CONFIGURA√á√ïES ==================== -->
<div class="nav-group">
  <button class="nav-btn" data-toggle="config_sistema">
    <span class="nav-icon">‚öôÔ∏è</span>
    <span class="nav-text">Configura√ß√µes</span>
    <span class="nav-arrow">‚ñæ</span>
  </button>
  <div id="config_sistema" class="sidebar-submenu">
    <button class="nav-subbtn" data-page="usuarios_sistema">
      <span class="submenu-icon">üë§</span>
      <span class="submenu-text">Cadastrar Usu√°rios</span>
    </button>
    <button class="nav-subbtn" data-page="permissoes_sistema">
      <span class="submenu-icon">üîí</span>
      <span class="submenu-text">Gerenciar Permiss√µes</span>
    </button>
  </div>
</div>
      </nav>
    </aside>


    <!-- ==================== CONTE√öDO PRINCIPAL ==================== -->
      <main id="main">
      <!-- DASHBOARD -->
      <section id="dashboard" class="page active">
        <div class="panel-card">
          <h1>Bem-vindo ao Sistema Nome da empresa</h1>
          <p>Gerencie seus eventos de forma profissional e eficiente.</p>
        </div>

        <div class="dashboard-top-cards">
          <div class="card" id="nextEventCard">
            <h3><span class="card-icon">üìÖ</span> Pr√≥ximos Eventos</h3>
            <div id="eventsList">
              <div id="eventInfo">
                <p><strong>Data:</strong> <span id="nextEventDate">--/--/----</span></p>
                <p><strong>Hor√°rio:</strong> <span id="nextEventTime">--:--</span></p>
                <p><strong>Cliente:</strong> <span id="nextEventClient">Nenhum evento agendado</span></p>
                <p><strong>Local:</strong> <span id="nextEventLocation">--</span></p>
              </div>
            </div>
          </div>

          <div class="card" id="weatherCard">
            <h3><span class="card-icon">üå¶Ô∏è</span> Previs√£o do Tempo</h3>
            <div id="weatherInfo">
              <div style="text-align:center;">
                <div style="font-size:2rem;margin:1rem 0;">üå§Ô∏è</div>
                <p><strong>Temperatura:</strong> <span id="weatherTemp">25¬∞C</span></p>
                <p><strong>Condi√ß√£o:</strong> <span id="weatherCondition">Parcialmente nublado</span></p>
                <p><strong>Umidade:</strong> <span id="weatherHumidity">65%</span></p>
                <p style="font-size:12px;color:#666;margin-top:0.5rem;">Atualizado: <span id="weatherUpdate">--:--</span></p>
              </div>
            </div>
          </div>

          <div class="card" id="trafficCard">
            <h3><span class="card-icon">üöó</span> Tr√¢nsito</h3>
            <div id="trafficInfo">
              <div style="text-align:center;">
                <div style="font-size:2rem;margin:1rem 0;color:#28a745;">üü¢</div>
                <p><strong>Condi√ß√£o:</strong> <span id="trafficCondition">Tr√¢nsito normal</span></p>
                <p><strong>Tempo estimado:</strong> <span id="trafficTime">25 min</span></p>
                <p><strong>Dist√¢ncia:</strong> <span id="trafficDistance">15 km</span></p>
                <p style="font-size:12px;color:#666;margin-top:0.5rem;">Atualizado: <span id="trafficUpdate">--:--</span></p>
              </div>
            </div>
          </div>
        </div>

        <div id="calendarCard" class="card">
          <h3><span class="card-icon">üìÜ</span> Calend√°rio de Eventos</h3>
          <div class="calendar-container">
            <div class="calendar-main">
              <div id="calendarHeader" class="calendar-header">
                <button onclick="previousMonth()" class="btn calendar-nav">‚óÄ</button>
                <div class="calendar-title">
                  <h4 id="currentMonth" class="current-month"></h4>
                  <div class="font-controls">
                 </div>
                </div>
                <button onclick="nextMonth()" class="btn calendar-nav">‚ñ∂</button>
              </div>
              <div id="calendar"></div>
            </div>
            <div class="calendar-legend">
              <h4>Legenda de Cores:</h4>
              <div class="legend-items">
                <div class="legend-item">
                  <div class="legend-color" style="background:#007bff;"></div>
                  <span>Mais de 5 dias</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background:#ffc107;"></div>
                  <span>Entre 4 a 2 dias</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background:#dc3545;"></div>
                  <span>1 dia</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background:#28a745;"></div>
                  <span>Dia do evento</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background:#6c757d;"></div>
                  <span>Evento finalizado</span>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- RESERVAR EVENTO -->
        <section id="reservar_evento" class="page">
        <div class="card">
          <h2>üéâ Reservar Evento</h2>
          <form id="eventoForm" onsubmit="return false;">
      <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem;">
  <button type="button" id="btnCpf_evento" class="btn-doc active" onclick="selecionarTipoFormulario('cpf', 'evento')">CPF</button>
  <button type="button" id="btnCnpj_evento" class="btn-doc" onclick="selecionarTipoFormulario('cnpj', 'evento')">CNPJ</button>
  <input type="text" id="doc_evento_cadastro" placeholder="000.000.000-00" maxlength="14" style="width:180px; padding: 8px; border-radius: 6px; border: 1px solid #ddd;" oninput="formatDocumentFormulario('evento')" onkeypress="if(event.key==='Enter')searchCliente()">
  <button type="button" class="btn-search" onclick="searchCliente()">üîç</button>
</div>
<div id="clienteInfo" style="display:none;padding:10px;background:#131212;border-radius:6px;margin-bottom:10px;"></div>
<div id="clienteNotFound" style="display:none;width:180px; padding:6px;background:transparent;border-radius:6px;margin-bottom:5px;">

  <p>Cliente n√£o encontrado</p>
  <button type="button" class="btn" onclick="showPage('clientes')">Cadastrar Cliente Novo</button>
</div>
          <div id="dadosClienteEvento" style="display:none;margin-bottom:1rem;padding:1rem;background:#f1f7ff;border-radius:1px;">
           
 <h5 style="margin:0 0 0.5rem 0;">Cliente encontrado:</h5>
 <div id="cliente_found"></div>
    </div>
    <div id="clienteNaoEncontrado" style="display:none;margin-bottom:1rem;color:#b22222;"></div>

     <h3>Local do Evento</h3>
          <div style="margin-bottom:1rem;">
            <div style="display:flex;gap:1rem;align-items:center;width:100%;max-width:600px;">
              <div class="form-group" style="flex:1;">
                <label for="casa_festa_select" name="casa_festa">Selecione a Casa de Festa:</label>
                <select id="casa_festa_select" style="width: 400px; padding:8px;border-radius:6px;border:1px solid #ddd;">
                  <option value="">‚Äî selecione ‚Äî</option>
                </select>
              </div>
              
              <button type="button" class="btn btn-adicionar" style="width:auto;padding:8px 16px;" onclick="adicionarCasaSelecionada()">‚ûï Adicionar</button>
              <button type="button" class="btn btn-adicionar" style="width: 120px; padding:8px; margin-left:0.5rem;" onclick="toggleOutroLocal()">Outro Local</button>
            </div>
            <div id="outro_local_container" style="display:none; margin-top: 1rem;">
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:0.5rem;">
                <div class="form-group">
                  <label for="nome_local_evento">Nome do Local</label>
                  <input type="text" id="nome_local_evento" placeholder="Condom√≠nio, Bar, Restaurante, etc." />
                </div>
                <div class="form-group">
                  <label for="cep_evento">CEP</label>
                  <input type="text" id="cep_evento" placeholder="00000-000" oninput="formatarCEP(this)" onblur="buscarCEPEvento(this.value)" />
                </div>
                <div class="form-group">
                  <label for="logradouro_evento">Rua / Logradouro</label>
                  <input type="text" id="logradouro_evento" />
                </div>
                <div class="form-group">
                  <label for="numero_evento">N√∫mero</label>
                  <input type="text" id="numero_evento" />
                </div>
                <div class="form-group">
                  <label for="complemento_evento">Complemento</label>
                  <input type="text" id="complemento_evento" />
                </div>
                <div class="form-group">
                  <label for="bairro_evento">Bairro</label>
                  <input type="text" id="bairro_evento" />
                </div>
                <div class="form-group">
                  <label for="cidade_evento">Cidade</label>
                  <input type="text" id="cidade_evento" />
                </div>
                <div class="form-group">
                  <label for="estado_evento">Estado</label>
                  <input type="text" id="estado_evento" />
                </div>
                <div class="form-group">
                  <label for="referencia_evento">Ponto de refer√™ncia</label>
                  <input type="text" id="referencia_evento" />
                </div>
                <div class="form-group">
                  <label for="telefone_evento">Telefone do local</label>
                  <input type="text" id="telefone_evento" placeholder="(00) 0000-0000" />
                </div>
                <div class="form-group">
                  <label for="tipo_local">Tipo de Local</label>
                  <select id="tipo_local">
                    <option value="">‚Äî selecione ‚Äî</option>
                    <option value="condominio">Condom√≠nio</option>
                    <option value="edificio">Edif√≠cio</option>
                    <option value="bar">Bar</option>
                    <option value="restaurante">Restaurante</option>
                    <option value="shopping">Shopping</option>
                    <option value="loja">Loja</option>
                    <option value="farmacia">Farm√°cia</option>
                    <option value="cafeteria">Cafeteria</option>
                    <option value="hotel">Hotel</option>
                    <option value="clube">Clube</option>
                    <option value="petshop">Pet Shop</option>
                    <option value="outros">Outros</option>
                  </select>
                </div>
              </div>
              <div style="text-align:center;margin-top:1rem;">
                <button type="button" class="btn" onclick="salvarLocalAvulso()">Salvar Local</button>
              </div>
            </div>
            <!-- √Årea centralizada para informa√ß√µes da casa selecionada -->
            <div id="dadosCasaSelecionada" style="width:100%;text-align:center;margin-top:1rem;"></div>
            <div id="infoCasa" style="width:100%;text-align:center;margin-top:1rem;"></div>
            
            <!-- √Årea para dados do outro local -->
            <div id="dadosOutroLocal" style="width: auto; padding:8px ;background:transparent;border-radius:8px;margin-top:1rem;">
            </div>
          </div>                    
          <div id="containerOutroLocal" style="display:none;margin-bottom:1rem;padding:0.75rem;border-radius:8px;border:1px dashed #ddd;background:#fff;">
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:0.5rem;">
              <div class="form-group">
                <label for="nome_local_evento">Nome do Local</label>
                <input type="text" id="nome_local_evento" placeholder="Condom√≠nio, Bar, Restaurante, etc." />
              </div>
              <div class="form-group">
                <label for="cep_evento">CEP</label>
                <input type="text" id="cep_evento" placeholder="00000-000" onblur="buscarCEP(this.value, 'evento')" />
              </div>
              <div class="form-group">
                <label for="logradouro_evento">Rua / Logradouro</label>
                <input type="text" id="logradouro_evento" />
              </div>
              <div class="form-group">
                <label for="numero_evento">N√∫mero</label>
                <input type="text" id="numero_evento" />
              </div>
              <div class="form-group">
                <label for="complemento_evento">Complemento</label>
                <input type="text" id="complemento_evento" />
              </div>
              <div class="form-group">
                <label for="bairro_evento">Bairro</label>
                <input type="text" id="bairro_evento" />
              </div>
              <div class="form-group">
                <label for="cidade_evento">Cidade</label>
                <input type="text" id="cidade_evento" />
              </div>
              <div class="form-group">
                <label for="estado_evento">Estado</label>
                <input type="text" id="estado_evento" />
              </div>
              <div class="form-group">
                <label for="referencia_evento">Ponto de refer√™ncia</label>
                <input type="text" id="referencia_evento" />
              </div>
              <div class="form-group">
                <label for="telefone_evento">Telefone do local</label>
                <input type="text" id="telefone_evento" placeholder="(00) 0000-0000" />
              </div>
              <div class="form-group">
                <label for="tipo_local">Tipo de Local</label>
                <select id="tipo_local">
                  <option value="">‚Äî selecione ‚Äî</option>
                  <option value="condominio">Condom√≠nio</option>
                  <option value="edificio">Edif√≠cio</option>
                  <option value="bar">Bar</option>
                  <option value="restaurante">Restaurante</option>
                  <option value="shopping">Shopping</option>
                  <option value="loja">Loja</option>
                  <option value="farmacia">Farm√°cia</option>
                  <option value="cafeteria">Cafeteria</option>
                  <option value="hotel">Hotel</option>
                  <option value="clube">Clube</option>
                  <option value="petshop">Pet Shop</option>
                  <option value="outros">Outros</option>
                  
                </select>
              </div>
            </div>
            <div style="text-align:center;margin-top:1rem;">
              <button type="button" class="btn" onclick="salvarLocalAvulso()">Salvar Local</button>
            </div>
          </div>
          
          <!-- √Årea onde os dados do local salvo aparecer√£o -->
          <div id="dadosLocalSalvo" style="width:100%;text-align:center;display:none;margin-top:1rem;">
            <div id="infoLocalSalvo"></div>
          </div>
          
          <h3>Detalhes do Evento</h3>
          <div class="form-row">
              <div class="form-group">
               <label for="data_evento">Data do Evento *</label>
                <input type="date" id="data_evento" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="hora_evento">Hor√°rio do Evento *</label>
                <input type="time" id="hora_evento" required onchange="calcularHoraSaida()">
              </div>

              <div class="form-group">
                <label for="duracao">Dura√ß√£o (horas)</label>
                <input type="number" id="duracao" placeholder="Dura√ß√£o do evento" required oninput="calcularHoraSaida()">
              </div>
              <div class="form-group">
                <label for="hora_saida">Hora Sa√≠da</label>
                <input type="time" id="hora_saida" readonly style="background:#f8f9fa;" /></div>
             </div>

             <h3>Personagens</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:0.5rem;align-items:end;margin-bottom:0.5rem;">
            <div class="form-group">
              <label for="personagem_select">Personagem</label>
              <select id="personagem_select" onchange="mostrarDetalhesPersonagem()"><option value="">‚Äî selecione ‚Äî</option></select>
            </div>
            <div class="form-group">
              <label for="tema_personagem">Tema</label>
              <input type="text" id="tema_personagem" readonly style="background:#f8f9fa;" />
            </div>
            <div class="form-group">
              <label for="figurino_personagem">Figurino</label>
              <input type="text" id="figurino_personagem" readonly style="background:#f8f9fa;" />
            </div>
            <div style="align-self:flex-end;">
              <button type="button" id="addPersonagemBtn" class="btn" onclick="adicionarPersonagemEvento()">Adicionar</button>
            </div>
          </div>
          <div id="personagensSelecionados" style="margin-bottom:1rem;"></div>

         <h3>Valores e Pagamentos</h3>
              <!-- Linha 1 -->
             <div style="display:grid;grid: template columns: 600px,10fr 10fr 10fr auto; end;margin-bottom:1.5rem;">
             <div class="linha"><label for="valor_total" style="font-size:22px;font-weight:bold; color:#057001;">Total</label>
               <input type="text" id="valor_total" style="background:#e8f0ff;color:#067002;font-weight:bold;font-size:16px;border:1px solid #0066cc;border-radius:6px;padding:6px;"
                     placeholder="R$ 0,00" />
            </div>
              <!-- Linha 2 -->
            <div style="display:grid;grid-template-columns:200px 10fr 15fr 30fr auto;gap: 8.5px 7.5rem;align-items:end;margin-bottom: 10.5px;">
            <div class="form-group"><label for="valor_sinal">Valor do Sinal</label><input type="text" id="valor_sinal" oninput="formatarMoeda(this); calcularValoresEvento();" placeholder="R$ 0,00" /></div>
            <div class="form-group"><label for="forma_pagamento_sinal">Forma de Pagamento do Sinal</label><select id="forma_pagamento_sinal"><option>Dinheiro</option><option>Cart√£o</option><option>PIX</option><option>Transfer√™ncia</option></select></div>
            <div class="form-group"><label for="sinal_pago_status">Sinal Pago?</label><select id="sinal_pago_status" onchange="calcularValoresEvento()"><option value="false">N√£o</option><option value="true">Sim</option></select></div>
            </div>
              <!-- Linha 3 -->
            <section style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:0.5rem;margin-bottom:0.5rem;">
            <div class="form-group"><label for="desconto">Desconto</label><input type="text" id="desconto" oninput="formatarMoeda(this); calcularValoresEvento();" placeholder="R$ 0,00" /></div>
            <div class="form-group"><label for="deslocamento">Deslocamento</label><input type="text" id="deslocamento" oninput="formatarMoeda(this); calcularValoresEvento();" placeholder="R$ 0,00" /></div>
            </section>
              <!-- Linha 3 -->
            <section style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:4.5rem;margin-bottom:0.5rem;">
            <div class="form-group"><label for="valor_avulso">Valor Avulso</label><input type="text" id="valor_avulso" oninput="formatarMoeda(this); calcularValoresEvento();" placeholder="R$ 0,00" /></div>
            <div class="form-group"><label for="forma_pagamento_avulso">Forma Pagamento Avulso</label><select id="forma_pagamento_avulso"><option>Dinheiro</option><option>Cart√£o</option><option>PIX</option><option>Transfer√™ncia</option></select></div>
            <div class="form-group"><label for="valor_avulso_pago">Valor Avulso Pago?</label><select id="valor_avulso_pago" onchange="calcularValoresEvento()"><option value="false">N√£o</option><option value="true">Sim</option></select></div>
            </section>
             <!-- Linha 4 -->
            <div style="display:grid;grid-template-columns:600px 10fr 10fr 10fr auto;gap: 5.5px 4.5rem;align-items:end;margin-bottom: 8.5px;">
            <div class="linha">
            <label for="valor_falta_receber" style="font-size:18px;font-weight:bold;color: #da040d;">Valor que Falta Receber</label>
            <input type="text" id="valor_falta_receber" style="background:#e8f0ff;color:#da040d;font-weight:bold;font-size:18px;border-radius:8px; padding:6px;" placeholder="R$ 0,00" readonly />
            <input type="hidden" id="valor_restante" value="0" />

            </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:4.5rem;margin-bottom:0.5rem;">
            <div class="form-group"><label for="forma_pagamento_restante">Forma Pagamento Restante</label><select id="forma_pagamento_restante"><option>Dinheiro</option><option>Cart√£o</option><option>PIX</option><option>Transfer√™ncia</option></select></div>
            <div class="form-group"><label for="valor_restante_recebido">Valor Restante Foi Recebido?</label><select id="valor_restante_recebido" onchange="calcularValoresEvento()"><option value="false">N√£o</option><option value="true">Sim</option></select></div>
          </div>

          <div id="dataPagamentoSinalDiv" style="display:none;margin-bottom:0.5rem;">
            <label for="dataPagamentoSinal">Data do Pagamento do Sinal</label>
            <input type="date" id="dataPagamentoSinal" />
          </div>
          <div id="dataPagamentoAvulsoDiv" style="display:none;margin-bottom:0.5rem;">
            <label for="dataPagamentoAvulso">Data do Pagamento Avulso</label>
            <input type="date" id="dataPagamentoAvulso" />
          </div>

          <div class="form-group">
            <label for="observacoes">Observa√ß√µes</label>
            <textarea id="observacoes"></textarea>
          </div>
            
            <div class="form-actions">
              <button type="button" class="btn primary" onclick="salvarEventoCompleto()">Reservar Evento</button>
              <button type="button" class="btn" onclick="limparFormularioEvento()">Limpar Formul√°rio</button>
            </div>
          </form>
        </div>
      </section>        
      </section>

      <!-- CLIENTES -->
      <section id="clientes" class="page">
        <div class="card">
          <h2>üìã Cadastro de Clientes</h2>
          <form id="clientesForm">
            <div class="form-group">
              <label>ID</label>
              <input type="text" id="ID_cliente" readonly style="width:120px; background:#f0f0f0;">
            </div>

            <div class="form-group" style="display: flex; flex-direction: column; margin-bottom: 0;">
              <label style="margin-bottom: 5px;">CPF/CNPJ</label>
              <div style="display:flex; gap:0.3rem; align-items: center;">
                <button type="button" class="btn-doc active" id="btnCPF_cliente" onclick="selecionarTipoFormulario('cpf', 'cliente')">CPF</button>
                <button type="button" class="btn-doc" id="btnCNPJ_cliente" onclick="selecionarTipoFormulario('cnpj', 'cliente')">CNPJ</button>
                <input type="text" id="doc_cliente_cadastro" placeholder="000.000.000-00" maxlength="14" style="width:180px;" oninput="formatDocumentFormulario('cliente')">
              </div>
            </div>
            
            <div class="form-group">
              <label id="labelData_cliente">Data de Nascimento</label>
              <input type="date" id="data_nascimento_cliente" onchange="calcularIdadeOuTempo(this, 'cliente')">
            </div>
            
            <div class="form-group">
              <label id="labelIdade_cliente">Idade</label>
              <input id="idade_cliente" type="number" readonly style="width:80px; background:#f8f9fa;">
            </div>
            
            <div class="form-row">
              <div class="form-group" style="flex:2;">
                <label id="labelNome_cliente">Nome Completo *</label>
                <input type="text" id="nome_cliente" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Telefone</label>
                <input type="text" id="telefone_cliente" placeholder="(00)00000-0000">
              </div>
              <div class="form-group">
                <label>Email</label> 
                <input type="email" id="email_cliente" placeholder="exemplo@provedor.com">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>CEP</label>
                <input type="text" id="cep_cliente" maxlength="9" placeholder="00000-000">
              </div>
              <div class="form-group" style="flex:2;">
                <label>Logradouro</label>
                <input type="text" id="logradouro_cliente">
              </div>
              <div class="form-group">
                <label>N√∫mero</label>
                <input type="text" id="numero_cliente">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Complemento</label>
                <input type="text" id="complemento_cliente">
              </div>
              <div class="form-group">
                <label>Bairro</label>
                <input type="text" id="bairro_cliente">
              </div>
              <div class="form-group">
                <label>Cidade</label>
                <input type="text" id="cidade_cliente">
              </div>
              <div class="form-group">
                <label>Estado</label>
                <input type="text" id="estado_cliente">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn primary">Salvar</button>
            </div>
          </form>
        </div>
      </section>

      <!-- CASA DE FESTAS -->
      <section id="casa_de_festas" class="page">
        <div class="card">
          <h2>Cadastro de Casa de Festas</h2>
          <form id="casaDeFestasForm">
            <div class="form-row" style="display: flex; gap: 1rem; align-items: flex-end;">
              <div class="form-group" style="width: 100px;">
                <label>ID</label>
                <input type="text" id="ID_casa_de_festas" readonly style="width:100%; background:#f0f0f0;">
              </div>
              
              <div class="form-group" style="flex: 1; min-width: 100px;">
                <label>CNPJ</label>
                <input type="text" id="cnpj_casa_de_festas" placeholder="00.000.000/0000-00" maxlength="18" 
                       style="width:100%;" oninput="formatarCNPJCasaFestas(this)">
              </div>
              
              <div style="flex: 1;"></div>
            </div>
            
            <div class="form-row">
              <div class="form-group" style="width: 100%;">
                <label>Nome da Casa de Festas *</label>
                <input type="text" id="nomecasadefestas" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Telefone</label>
                <input type="text" id="telefone_casadefestas" placeholder="(00)00000-0000">
              </div>

              <div class="form-group">
                <label>Email</label>
                <input type="email" id="email_casadefestas" placeholder="exemplo@provedor.com">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>CEP</label>
                <input type="text" id="cep_casadefestas" maxlength="9" placeholder="00000-000">
              </div>
              <div class="form-group" style="flex:2;">
                <label>Logradouro</label>
                <input type="text" id="logradouro_casadefestas">
              </div>
              <div class="form-group">
                <label>N√∫mero</label>
                <input type="text" id="numero_casadefestas">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Complemento</label>
                <input type="text" id="complemento_casadefestas">
              </div>
              <div class="form-group">
                <label>Bairro</label>
                <input type="text" id="bairro_casadefestas">
              </div>
              <div class="form-group">
                <label>Cidade</label>
                <input type="text" id="cidade_casadefestas">
              </div>
              <div class="form-group">
                <label>Estado</label>
                <input type="text" id="estado_casadefestas">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn primary">Salvar</button>
            </div>
          </form>
        </div>
      </section>

      <!-- ELENCO -->
      <section id="elenco" class="page">
        <div class="card">
          <h2>Cadastro de Elenco</h2>
          <form id="elencoForm">
            <div class="form-row" style="display: flex; gap: 1rem; align-items: flex-end;">
              <!-- ID -->
              <div class="form-group" style="width: 80px;">
                <label>ID</label>
                <input type="text" id="ID_elenco" readonly style="width:100%; background:#f0f0f0;">
              </div>
              
              <!-- Bot√µes CPF/CNPJ -->
              <div class="form-group" style="margin-bottom: 0;">
                <label style="visibility: hidden;">CPF/CNPJ</label>
                <div style="display: flex; gap: 0.5rem; margin-top: 8px;">
                  <button type="button" class="btn-doc active" id="btnCPF_elenco" onclick="selecionarTipoFormulario('cpf', 'elenco')">CPF</button>
                  <button type="button" class="btn-doc" id="btnCNPJ_elenco" onclick="selecionarTipoFormulario('cnpj', 'elenco')">CNPJ</button>
                </div>
              </div>
              
              <!-- Campo Documento -->
              <div class="form-group" style="margin-bottom: 0;">
                <label>Documento</label>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <input type="text" id="doc_elenco_cadastro" placeholder="000.000.000-00" maxlength="14" style="width:180px;">
                </div>
              </div>
              
              <!-- Espa√ßo para Data Nascimento -->
              <div style="flex:1"></div>
              
              <!-- Data Nascimento -->
              <div class="form-group" style="width: 160px;">
                <label id="labelData_elenco">Data de Nascimento</label>
                <input type="date" id="data_nascimento_elenco" onchange="calcularIdadeOuTempo(this, 'elenco')">
              </div>
              
              <!-- Idade -->
              <div class="form-group" style="width: 80px;">
                <label id="labelIdade_elenco">Idade</label>
                <input id="idade_elenco" type="number" readonly style="width:100%; background:#f8f9fa;">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group" style="flex:2;">
                <label id="labelNome_elenco">Nome Completo</label>
                <input type="text" id="nome_elenco" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Telefone</label>
                <input type="text" id="telefone_elenco">
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="email_elenco">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>CEP</label>
                <input type="text" id="cep_elenco" maxlength="9" placeholder="00000-000">
              </div>
              <div class="form-group" style="flex:2;">
                <label>Logradouro</label>
                <input type="text" id="logradouro_elenco">
              </div>
              <div class="form-group">
                <label>N√∫mero</label>
                <input type="text" id="numero_elenco">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Complemento</label>
                <input type="text" id="complemento_elenco">
              </div>
              <div class="form-group">
                <label>Bairro</label>
                <input type="text" id="bairro_elenco">
              </div>
              <div class="form-group">
                <label>Cidade</label>
                <input type="text" id="cidade_elenco">
              </div>
              <div class="form-group">
                <label>Estado</label>
                <input type="text" id="estado_elenco">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn primary">Salvar</button>
            </div>
          </form>
        </div>
      </section>

      <!-- PERSONAGENS -->
      <section id="personagens" class="page">
        <div class="card">
          <h2>Cadastro de Personagens</h2>
          <form id="personagensForm">
            <div class="form-row">
              <div class="form-group">
                <label>ID</label>
                <input type="text" id="ID_personagens" readonly style="width:120px; background:#f0f0f0;">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group" style="flex:2;">
                <label>Nome do Personagem</label>
                <input type="text" id="nome_personagens">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Figurino</label>
                <input type="text" id="figurino">
              </div>
              <div class="form-group">
                <label>Tema</label>
                <input type="text" id="tema">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Quantidade</label>
                <input type="number" id="quantidade" min="1">
              </div>
              <div class="form-group">
                <label>Valor</label>
                <input type="text" id="valor_personagens" placeholder="R$ 0,00">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group" style="flex: 1;">
                <label>Foto do Personagem</label>
                <input type="file" id="foto_personagem" accept="image/*" onchange="previewFotoPersonagem(this)">
              </div>
              <div class="form-group" style="flex: 1; display: flex; justify-content: center; align-items: center;">
                <div id="previewContainer" style="width: 150px; height: 150px; border: 2px dashed #ccc; display: flex; justify-content: center; align-items: center; overflow: hidden;">
                  <img id="fotoPreview" src="" alt="Pr√©-visualiza√ß√£o da foto" style="max-width: 100%; max-height: 100%; display: none;">
                  <span id="previewText" style="color: #888;">Pr√©-visualiza√ß√£o</span>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" id="btnSalvarPersonagens" class="btn primary">Salvar</button>
            </div>
            <div id="personagensSuccess" class="msg" style="display:none;"></div>
          </form>
        </div>
      </section>

      <!-- MOTORISTAS -->
      <section id="motoristas" class="page">
        <div class="card">
          <h2>Cadastro de Motoristas</h2>
          <form id="motoristasForm">
            <div class="form-row" style="display: flex; gap: 1rem; align-items: flex-end;">
              <!-- ID -->
              <div class="form-group" style="width: 80px;">
                <label>ID</label>
                <input type="text" id="ID_motoristas" readonly style="width:100%; background:#f0f0f0;">
              </div>
              
              <!-- Bot√µes CPF/CNPJ -->
              <div class="form-group" style="margin-bottom: 0;">
                <label style="visibility: hidden;">CPF/CNPJ</label>
                <div style="display: flex; gap: 0.5rem; margin-top: 8px;">
                  <button type="button" class="btn-doc active" id="btnCPF_motoristas" onclick="selecionarTipoFormulario('cpf', 'motoristas')">CPF</button>
                  <button type="button" class="btn-doc" id="btnCNPJ_motoristas" onclick="selecionarTipoFormulario('cnpj', 'motoristas')">CNPJ</button>
                </div>
              </div>
              
              <!-- Campo Documento -->
              <div class="form-group" style="margin-bottom: 0;">
                <label>Documento</label>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <input type="text" id="doc_motoristas_cadastro" placeholder="000.000.000-00" maxlength="14" style="width:180px;">
                </div>
              </div>
              
              <!-- Espa√ßo para Data Nascimento -->
              <div style="flex:1"></div>
              
              <!-- Data Nascimento -->
              <div class="form-group" style="width: 160px;">
                <label id="labelData_motoristas">Data de Nascimento</label>
                <input type="date" id="data_nascimento_motoristas" onchange="calcularIdadeOuTempo(this, 'motoristas')">
              </div>
              
              <!-- Idade -->
              <div class="form-group" style="width: 80px;">
                <label id="labelIdade_motoristas">Idade</label>
                <input id="idade_motoristas" type="number" readonly style="width:100%; background:#f8f9fa;">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group" style="flex:2;">
                <label id="labelNome_motoristas">Nome Completo</label>
                <input type="text" id="nome_motoristas" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Telefone</label>
                <input type="text" id="telefone_motoristas" required>
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="email_motoristas">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>CEP</label>
                <input type="text" id="cep_motoristas" maxlength="9" placeholder="00000-000">
              </div>
              <div class="form-group" style="flex:2;">
                <label>Logradouro</label>
                <input type="text" id="logradouro_motoristas">
              </div>
              <div class="form-group">
                <label>N√∫mero</label>
                <input type="text" id="numero_motoristas">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Complemento</label>
                <input type="text" id="complemento_motoristas">
              </div>
              <div class="form-group">
                <label>Bairro</label>
                <input type="text" id="bairro_motoristas">
              </div>
              <div class="form-group">
                <label>Cidade</label>
                <input type="text" id="cidade_motoristas">
              </div>
              <div class="form-group">
                <label>Estado</label>
                <input type="text" id="estado_motoristas">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>CNH</label>
                <input type="text" id="cnh_motoristas" required>
              </div>
              <div class="form-group">
                <label>Ve√≠culo</label>
                <input type="text" id="veiculo_motoristas">
              </div>
              <div class="form-group">
                <label>Chave Pix</label>
                <input type="text" id="chave_pix_motoristas">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn primary">Salvar</button>
            </div>
          </form>
        </div>
      </section>

      <!-- FORNECEDORES -->
      <section id="fornecedores" class="page">
        <div class="card">
          <h2>Cadastro de Fornecedores</h2>
          <form id="fornecedoresForm">
            <div class="form-row" style="display: flex; gap: 1rem; align-items: flex-end;">
              <!-- ID -->
              <div class="form-group" style="width: 80px;">
                <label>ID</label>
                <input type="text" id="ID_fornecedores" readonly style="width:100%; background:#f0f0f0;">
              </div>
              
              <!-- Bot√µes CPF/CNPJ -->
              <div class="form-group" style="margin-bottom: 0;">
                <label style="visibility: hidden;">CPF/CNPJ</label>
                <div style="display: flex; gap: 0.5rem; margin-top: 8px;">
                  <button type="button" class="btn-doc" onclick="selecionarTipoFormulario('cpf', 'fornecedores')">CPF</button>
                  <button type="button" class="btn-doc active" onclick="selecionarTipoFormulario('cnpj', 'fornecedores')">CNPJ</button>
                </div>
              </div>
              
              <!-- Campo Documento -->
              <div class="form-group" style="margin-bottom: 0;">
                <label>Documento</label>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <input type="text" id="doc_fornecedores_cadastro" placeholder="00.000.000/0000-00" maxlength="18" style="width:180px;">
                </div>
              </div>
              
              <!-- Espa√ßo para Data Abertura -->
              <div style="flex:1"></div>
              
              <!-- Data Abertura -->
              <div class="form-group" style="width: 160px;">
                <label id="labelData_fornecedores">Data da Abertura</label>
                <input type="date" id="data_abertura_fornecedores" onchange="calcularIdadeOuTempo(this, 'fornecedores')">
              </div>
              
              <!-- Tempo de Empresa -->
              <div class="form-group" style="width: 80px;">
                <label id="labelIdade_fornecedores">Tempo de Empresa (anos)</label>
                <input id="idade_fornecedores" type="number" readonly style="width:100%; background:#f8f9fa;">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group" style="flex:2;">
                <label>Nome da Empresa</label>
                <input type="text" id="nome_fornecedores" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Telefone</label>
                <input type="text" id="telefone_fornecedores">
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="email_fornecedores">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>CEP</label>
                <input type="text" id="cep_fornecedores" maxlength="9" placeholder="00000-000">
              </div>
              <div class="form-group" style="flex:2;">
                <label>Logradouro</label>
                <input type="text" id="logradouro_fornecedores">
              </div>
              <div class="form-group">
                <label>N√∫mero</label>
                <input type="text" id="numero_fornecedores">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Complemento</label>
                <input type="text" id="complemento_fornecedores">
              </div>
              <div class="form-group">
                <label>Bairro</label>
                <input type="text" id="bairro_fornecedores">
              </div>
              <div class="form-group">
                <label>Cidade</label>
                <input type="text" id="cidade_fornecedores">
              </div>
              <div class="form-group">
                <label>Estado</label>
                <input type="text" id="estado_fornecedores">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn primary">Salvar</button>
            </div>
          </form>
        </div>
      </section>

      <!-- FUNCION√ÅRIOS -->
      <section id="funcionarios" class="page">
        <div class="card">
          <h2>Cadastro de Funcion√°rios</h2>
          <form id="funcionariosForm">
            <div class="form-row" style="display: flex; gap: 1rem; align-items: flex-end;">
              <!-- ID -->
              <div class="form-group" style="width: 80px;">
                <label>ID</label>
                <input type="text" id="ID_funcionarios" readonly style="width:100%; background:#f0f0f0;">
              </div>
              
              <!-- Bot√µes CPF/CNPJ -->
              <div class="form-group" style="margin-bottom: 0;">
                <label style="visibility: hidden;">CPF/CNPJ</label>
                <div style="display: flex; gap: 0.5rem; margin-top: 8px;">
                  <button type="button" class="btn-doc active" onclick="selecionarTipoFormulario('cpf', 'funcionarios')">CPF</button>
                  <button type="button" class="btn-doc" onclick="selecionarTipoFormulario('cnpj', 'funcionarios')">CNPJ</button>
                </div>
              </div>
              
              <!-- Campo Documento -->
              <div class="form-group" style="margin-bottom: 0;">
                <label>Documento</label>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <input type="text" id="doc_funcionarios_cadastro" placeholder="000.000.000-00" maxlength="14" style="width:180px;">
                </div>
              </div>
              
              <!-- Espa√ßo para Data Nascimento -->
              <div style="flex:1"></div>
              
              <!-- Data Nascimento -->
              <div class="form-group" style="width: 160px;">
                <label id="labelData_funcionarios">Data de Nascimento</label>
                <input type="date" id="data_nascimento_funcionarios" onchange="calcularIdadeOuTempo(this, 'funcionarios')">
              </div>
              
              <!-- Idade -->
              <div class="form-group" style="width: 80px;">
                <label id="labelIdade_funcionarios">Idade</label>
                <input id="idade_funcionarios" type="number" readonly style="width:100%; background:#f8f9fa;">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group" style="flex:2;">
                <label>Nome Completo</label>
                <input type="text" id="nome_funcionarios" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Telefone</label>
                <input type="text" id="telefone_funcionarios" required>
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="email_funcionarios" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>CEP</label>
                <input type="text" id="cep_funcionarios" maxlength="9" placeholder="00000-000">
              </div>
              <div class="form-group" style="flex:2;">
                <label>Logradouro</label>
                <input type="text" id="logradouro_funcionarios">
              </div>
              <div class="form-group">
                <label>N√∫mero</label>
                <input type="text" id="numero_funcionarios">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Complemento</label>
                <input type="text" id="complemento_funcionarios">
              </div>
              <div class="form-group">
                <label>Bairro</label>
                <input type="text" id="bairro_funcionarios">
              </div>
              <div class="form-group">
                <label>Cidade</label>
                <input type="text" id="cidade_funcionarios">
              </div>
              <div class="form-group">
                <label>Estado</label>
                <input type="text" id="estado_funcionarios">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn primary">Salvar</button>
            </div>
          </form>
        </div>
      </section>

      <!-- CRIAR CHECKLIST -->
      <section id="criar_checklist" class="page">
        <div class="card">
          <h2>Criar Check List</h2>
          <form id="checklistForm">
            <div class="form-row">
              <div class="form-group">
                <label>Nome do Check List</label>
                <input type="text" id="nomeChecklist" required placeholder="Ex: Check List Festa Infantil">
              </div>
              <div class="form-group">
                <label>Descri√ß√£o</label>
                <input type="text" id="descricaoChecklist" placeholder="Descri√ß√£o opcional">
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn primary" onclick="salvarChecklist()">Salvar Check List</button>
            </div>
          </form>
        </div>
      </section>

      <!-- OUTRAS P√ÅGINAS (adicione conforme necess√°rio) -->


      <section id="todos_eventos" class="page">
        <div class="card">
          <h2>Todos os Eventos</h2>
          <p>Conte√∫do da p√°gina Todos os Eventos</p>
        </div>
      </section>

      <section id="eventos_futuros" class="page">
        <div class="card">
          <h2>Eventos Futuros</h2>
          <p>Conte√∫do da p√°gina Eventos Futuros</p>
        </div>
      </section>

      <section id="confirmar_dados" class="page">
        <div class="card">
          <h2>Confirmar Dados</h2>
          <p>Conte√∫do da p√°gina Confirmar Dados</p>
        </div>
      </section>

      <section id="eventos_finalizados" class="page">
  <div class="card">
    <h2>Eventos Finalizados</h2>
    <p>Conte√∫do da p√°gina Eventos Finalizados</p>
  </div>
</section>
<!-- ESCALAS (NOVA P√ÅGINA) -->
  <section id="escalas" class="page">
    <div class="card">
      <h2>üéØ Escalar Equipe</h2>
      <p>Gerencie a escala√ß√£o de equipe para os eventos</p>
      
      <!-- BOT√ïES DE CONTROLE (AGORA NO TOPO) -->
      <div style="display: flex; gap: 1rem; margin: 2rem 0;">
        <button class="btn primary" onclick="abrirModalEventosParaEscalar()">
          üìã Abrir Eventos para Escalar
        </button>
        <button class="btn" onclick="mostrarEventosEscalados()">
          ‚úÖ Eventos Escalados
        </button>
        <button class="btn" onclick="exportarEscalas()">
          üì§ Exportar Escalas
        </button>
      </div>
      
      <!-- LISTA DE EVENTOS PARA ESCALAR -->
      <div id="listaEventosEscalar" style="display: none;">
        <h3>Eventos Dispon√≠veis para Escala√ß√£o</h3>
        <div id="tabelaEventosParaEscalar"></div>
      </div>
      
      <!-- LISTA DE EVENTOS ESCALADOS -->
      <div id="listaEventosEscalados" style="display: none;">
        <h3>Eventos com Escala Realizada</h3>
        <div id="tabelaEventosEscalados"></div>
      </div>
      
      <!-- √ÅREA DE EDI√á√ÉO DE ESCALA (aparece quando seleciona evento) -->
      <div id="areaEscala" style="display: none; margin-top: 2rem;">
        <h3>Escalar Equipe para o Evento</h3>
        <div id="detalhesEventoEscala"></div>
        
        <!-- FORMUL√ÅRIO DE ESCALA√á√ÉO -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
          
          <!-- ELENCO -->
          <div class="form-group">
            <label>Selecionar Elenco</label>
            <select id="selectElenco" multiple style="height: 150px;">
              <!-- Preenchido dinamicamente -->
            </select>
            <button type="button" class="btn small" onclick="adicionarElenco()">‚ûï Adicionar</button>
          </div>
          
          <!-- MOTORISTAS -->
          <div class="form-group">
            <label>Selecionar Motorista</label>
            <select id="selectMotoristas">
              <!-- Preenchido dinamicamente -->
            </select>
            <button type="button" class="btn small" onclick="adicionarMotorista()">‚ûï Adicionar</button>
          </div>
          
          <!-- FUNCION√ÅRIOS/PRODU√á√ÉO -->
          <div class="form-group">
            <label>Selecionar Equipe de Produ√ß√£o</label>
            <select id="selectProducao" multiple style="height: 150px;">
              <!-- Preenchido dinamicamente -->
            </select>
            <button type="button" class="btn small" onclick="adicionarProducao()">‚ûï Adicionar</button>
          </div>
          
        </div>
        
        <!-- LISTA DE EQUIPE SELECIONADA -->
        <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
          <h4>Equipe Selecionada:</h4>
          <div id="equipeSelecionada"></div>
        </div>
        
        <!-- BOT√ïES DE A√á√ÉO -->
        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
          <button class="btn primary" onclick="salvarEscala()">üíæ Salvar Escala</button>
          <button class="btn" onclick="cancelarEscala()">‚ùå Cancelar</button>
        </div>
      </div>
    </div>
  </section>
  <!-- ==================== LISTA ELENCO (P√ÅGINA INDIVIDUAL) ==================== -->
<section id="lista_elenco" class="page">
  <div class="card">
    <h2>üé¨ Lista do Elenco</h2>
    <div id="conteudoListaElenco">
      <!-- Conte√∫do ser√° carregado dinamicamente -->
    </div>
  </div>
</section>

<!-- ==================== LISTA MOTORISTAS (P√ÅGINA INDIVIDUAL) ==================== -->
<section id="lista_motoristas" class="page">
  <div class="card">
    <h2>üöó Lista de Motoristas</h2>
    <div id="conteudoListaMotoristas">
      <!-- Conte√∫do ser√° carregado dinamicamente -->
    </div>
  </div>
</section>

<!-- ==================== LISTA PRODU√á√ÉO (P√ÅGINA INDIVIDUAL) ==================== -->
<section id="lista_producao" class="page">
  <div class="card">
    <h2>üë∑ Lista de Produ√ß√£o</h2>
    <div id="conteudoListaProducao">
      <!-- Conte√∫do ser√° carregado dinamicamente -->
    </div>
  </div>
</section>

<!-- ==================== LISTA FUNCION√ÅRIOS (P√ÅGINA INDIVIDUAL) ==================== -->
<section id="lista_funcionarios" class="page">
  <div class="card">
    <h2>üßæ Lista de Funcion√°rios</h2>
    <div id="conteudoListaFuncionarios">
      <!-- Conte√∫do ser√° carregado dinamicamente -->
    </div>
  </div>
</section>
<!-- ==================== CONTAS A RECEBER ==================== -->
<section id="contas_receber_eventos" class="page">
  <div class="card">
    <h2>üí∞ Contas a Receber - Eventos</h2>
    <p>Contas a receber de clientes por evento</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="filtroStatusReceber" onchange="filtrarContasReceber()">
          <option value="todos">Todos</option>
          <option value="pendente">Pendente</option>
          <option value="recebido">Recebido</option>
          <option value="atrasado">Atrasado</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 150px;">
        <label>Cliente</label>
        <select id="filtroClienteReceber" onchange="filtrarContasReceber()">
          <option value="todos">Todos os clientes</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 120px;">
        <label>Data In√≠cio</label>
        <input type="date" id="filtroDataInicioReceber" onchange="filtrarContasReceber()">
      </div>
      <div class="form-group" style="min-width: 120px;">
        <label>Data Fim</label>
        <input type="date" id="filtroDataFimReceber" onchange="filtrarContasReceber()">
      </div>
      <div style="display: flex; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosReceber()">‚Üª Limpar Filtros</button>
      </div>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total a Receber</h4>
        <p id="totalReceber" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">R$ 0,00</p>
      </div>
      <div class="card-mini" style="background: #e6f7ed;">
        <h4>Recebido</h4>
        <p id="totalRecebido" style="font-size: 1.5rem; font-weight: bold; color: #28a745;">R$ 0,00</p>
      </div>
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Pendente</h4>
        <p id="totalPendente" style="font-size: 1.5rem; font-weight: bold; color: #856404;">R$ 0,00</p>
      </div>
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Atrasado</h4>
        <p id="totalAtrasado" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
    </div>
    
    <!-- Tabela de Contas a Receber -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>ID Evento</th>
            <th>Data Evento</th>
            <th>Cliente</th>
            <th>Valor Total</th>
            <th>Valor Recebido</th>
            <th>Valor Pendente</th>
            <th>Status</th>
            <th>Vencimento</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaContasReceber">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Bot√µes de A√ß√£o -->
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <button class="btn primary" onclick="baixarRelatorioReceber()">üì• Exportar Relat√≥rio</button>
      <button class="btn" onclick="imprimirContasReceber()">üñ®Ô∏è Imprimir</button>
      <button class="btn" onclick="atualizarContasReceber()">üîÑ Atualizar</button>
    </div>
  </div>
</section>

<!-- ==================== CONTAS A PAGAR - ELENCO ==================== -->
<section id="contas_pagar_elenco" class="page">
  <div class="card">
    <h2>üé≠ Contas a Pagar - Elenco</h2>
    <p>Pagamentos para o elenco escalado nos eventos</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="filtroStatusElenco" onchange="filtrarContasPagarElenco()">
          <option value="todos">Todos</option>
          <option value="pendente">Pendente</option>
          <option value="pago">Pago</option>
          <option value="atrasado">Atrasado</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Evento</label>
        <select id="filtroEventoElenco" onchange="filtrarContasPagarElenco()">
          <option value="todos">Todos os eventos</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Membro do Elenco</label>
        <select id="filtroElenco" onchange="filtrarContasPagarElenco()">
          <option value="todos">Todos</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Forma de Pagamento</label>
        <select id="filtroFormaPagamentoElenco" onchange="filtrarContasPagarElenco()">
          <option value="todos">Todas</option>
          <option value="PIX">PIX</option>
          <option value="Dinheiro">Dinheiro</option>
          <option value="Transfer√™ncia">Transfer√™ncia</option>
          <option value="Cart√£o">Cart√£o</option>
        </select>
      </div>
      <div>
        <button class="btn" onclick="resetarFiltrosElenco()">‚Üª Limpar Filtros</button>
      </div>
    </div>
    
    <!-- Tabela de Contas a Pagar - Elenco -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Evento</th>
            <th>Data</th>
            <th>Membro</th>
            <th>Valor a Pagar</th>
            <th>Forma de Pagamento</th>
            <th>Status</th>
            <th>Vencimento</th>
            <th>Data Pagamento</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaContasPagarElenco">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Total a Pagar</h4>
        <p id="totalPagarElenco" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
      <div class="card-mini" style="background: #d4edda;">
        <h4>Total Pago</h4>
        <p id="totalPagoElenco" style="font-size: 1.5rem; font-weight: bold; color: #155724;">R$ 0,00</p>
      </div>
    </div>
    
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <button class="btn primary" onclick="registrarPagamentoElenco()">üí≥ Registrar Pagamento</button>
      <button class="btn" onclick="exportarRelatorioElenco()">üì§ Exportar Relat√≥rio</button>
      <button class="btn" onclick="atualizarContasElenco()">üîÑ Atualizar</button>
    </div>
  </div>
</section>

<!-- ==================== CONTAS A PAGAR - MOTORISTAS ==================== -->
<section id="contas_pagar_motoristas" class="page">
  <div class="card">
    <h2>üöó Contas a Pagar - Motoristas</h2>
    <p>Pagamentos para motoristas escalados nos eventos</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="filtroStatusMotoristas" onchange="filtrarContasPagarMotoristas()">
          <option value="todos">Todos</option>
          <option value="pendente">Pendente</option>
          <option value="pago">Pago</option>
          <option value="atrasado">Atrasado</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Evento</label>
        <select id="filtroEventoMotoristas" onchange="filtrarContasPagarMotoristas()">
          <option value="todos">Todos os eventos</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Motorista</label>
        <select id="filtroMotorista" onchange="filtrarContasPagarMotoristas()">
          <option value="todos">Todos</option>
        </select>
      </div>
      <div>
        <button class="btn" onclick="resetarFiltrosMotoristas()">‚Üª Limpar Filtros</button>
      </div>
    </div>
    
    <!-- Tabela de Contas a Pagar - Motoristas -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Evento</th>
            <th>Data</th>
            <th>Motorista</th>
            <th>Ve√≠culo</th>
            <th>Valor a Pagar</th>
            <th>Forma de Pagamento</th>
            <th>Status</th>
            <th>Vencimento</th>
            <th>Data Pagamento</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaContasPagarMotoristas">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Total a Pagar</h4>
        <p id="totalPagarMotoristas" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
    </div>
  </div>
</section>

<!-- ==================== CONTAS A PAGAR - PRODUCAO ==================== -->
<section id="contas_pagar_producao" class="page">
  <div class="card">
    <h2>üë∑ Contas a Pagar - Produ√ß√£o</h2>
    <p>Pagamentos para equipe de produ√ß√£o escalada nos eventos</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="filtroStatusProducao" onchange="filtrarContasPagarProducao()">
          <option value="todos">Todos</option>
          <option value="pendente">Pendente</option>
          <option value="pago">Pago</option>
          <option value="atrasado">Atrasado</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Evento</label>
        <select id="filtroEventoProducao" onchange="filtrarContasPagarProducao()">
          <option value="todos">Todos os eventos</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Membro da Produ√ß√£o</label>
        <select id="filtroProducao" onchange="filtrarContasPagarProducao()">
          <option value="todos">Todos</option>
        </select>
      </div>
      <div>
        <button class="btn" onclick="resetarFiltrosProducao()">‚Üª Limpar Filtros</button>
      </div>
    </div>
    
    <!-- Tabela de Contas a Pagar - Produ√ß√£o -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Evento</th>
            <th>Data</th>
            <th>Membro da Produ√ß√£o</th>
            <th>Cargo/Fun√ß√£o</th>
            <th>Valor a Pagar</th>
            <th>Forma de Pagamento</th>
            <th>Status</th>
            <th>Vencimento</th>
            <th>Data Pagamento</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaContasPagarProducao">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Total a Pagar</h4>
        <p id="totalPagarProducao" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
    </div>
  </div>
</section>

<!-- ==================== CONTAS A PAGAR - FORNECEDORES ==================== -->
<section id="contas_pagar_fornecedores" class="page">
  <div class="card">
    <h2>üè¢ Contas a Pagar - Fornecedores</h2>
    <p>Contas de fornecedores (√Ågua, Luz, Figurino, etc.)</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Tipo de Fornecedor</label>
        <select id="filtroTipoFornecedor" onchange="filtrarContasFornecedores()">
          <option value="todos">Todos</option>
          <option value="agua">√Ågua</option>
          <option value="luz">Luz/Energia</option>
          <option value="figurino">Figurino</option>
          <option value="aluguel">Aluguel</option>
          <option value="outros">Outros</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Fornecedor</label>
        <select id="filtroFornecedor" onchange="filtrarContasFornecedores()">
          <option value="todos">Todos</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="filtroStatusFornecedor" onchange="filtrarContasFornecedores()">
          <option value="todos">Todos</option>
          <option value="pendente">Pendente</option>
          <option value="pago">Pago</option>
          <option value="atrasado">Atrasado</option>
        </select>
      </div>
      <div>
        <button class="btn" onclick="adicionarContaFornecedor()">‚ûï Nova Conta</button>
      </div>
    </div>
    
    <!-- Tabela de Contas a Pagar - Fornecedores -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Fornecedor</th>
            <th>Tipo</th>
            <th>Descri√ß√£o</th>
            <th>Vencimento</th>
            <th>Valor</th>
            <th>Forma de Pagamento</th>
            <th>Status</th>
            <th>Data Pagamento</th>
            <th>Comprovante</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaContasFornecedores">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Total a Pagar</h4>
        <p id="totalPagarFornecedores" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
    </div>
  </div>
</section>

<!-- ==================== CONTAS A PAGAR - FUNCIONARIOS ==================== -->
<section id="contas_pagar_funcionarios" class="page">
  <div class="card">
    <h2>üßæ Contas a Pagar - Funcion√°rios</h2>
    <p>Pagamentos de sal√°rios e comiss√µes para funcion√°rios</p>
    
    <!-- Filtros por M√™s/Ano -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: flex-end;">
      <div class="form-group">
        <label>M√™s</label>
        <select id="filtroMesFuncionarios" onchange="carregarContasPagarFuncionarios()">
          <option value="1">Janeiro</option>
          <option value="2">Fevereiro</option>
          <option value="3">Mar√ßo</option>
          <option value="4">Abril</option>
          <option value="5">Maio</option>
          <option value="6">Junho</option>
          <option value="7">Julho</option>
          <option value="8">Agosto</option>
          <option value="9">Setembro</option>
          <option value="10">Outubro</option>
          <option value="11">Novembro</option>
          <option value="12">Dezembro</option>
        </select>
      </div>
      <div class="form-group">
        <label>Ano</label>
        <select id="filtroAnoFuncionarios" onchange="carregarContasPagarFuncionarios()">
          <!-- Op√ß√µes ser√£o preenchidas dinamicamente -->
        </select>
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Forma de Pagamento</label>
        <select id="filtroFormaPagamentoFuncionarios" onchange="filtrarContasPagarFuncionarios()">
          <option value="todos">Todas</option>
          <option value="PIX">PIX</option>
          <option value="Transfer√™ncia">Transfer√™ncia Banc√°ria</option>
          <option value="Dinheiro">Dinheiro</option>
        </select>
      </div>
      <div>
        <button class="btn" onclick="gerarFolhaPagamentoAtual()">üìã Gerar Folha do M√™s</button>
      </div>
    </div>
    
    <!-- Tabela de Contas a Pagar - Funcion√°rios -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Funcion√°rio</th>
            <th>Cargo</th>
            <th>Sal√°rio Base</th>
            <th>Comiss√µes</th>
            <th>Descontos</th>
            <th>Valor L√≠quido</th>
            <th>Forma de Pagamento</th>
            <th>Status</th>
            <th>Data Pagamento</th>
            <th>Comprovante</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaContasPagarFuncionarios">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Total a Pagar</h4>
        <p id="totalPagarFuncionarios" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
      <div class="card-mini" style="background: #d4edda;">
        <h4>Total Pago</h4>
        <p id="totalPagoFuncionarios" style="font-size: 1.5rem; font-weight: bold; color: #155724;">R$ 0,00</p>
      </div>
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Total Descontos</h4>
        <p id="totalDescontosFuncionarios" style="font-size: 1.5rem; font-weight: bold; color: #856404;">R$ 0,00</p>
      </div>
    </div>
    
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <button class="btn primary" onclick="pagarTodosFuncionarios()">üí≥ Pagar Todos</button>
      <button class="btn" onclick="exportarFolhaPagamento()">üì§ Exportar Folha</button>
      <button class="btn" onclick="imprimirFolhaPagamento()">üñ®Ô∏è Imprimir</button>
    </div>
  </div>
</section>

<style>
.card-mini {
  padding: 1rem;
  border-radius: 8px;
  flex: 1;
  min-width: 150px;
}

.table-container {
  overflow-x: auto;
  margin: 1rem 0;
}

.tabela-relatorio {
  border-collapse: collapse;
  width: 100%;
}

.tabela-relatorio th {
  background-color: #f8f9fa;
  padding: 12px;
  text-align: left;
  border-bottom: 2px solid #dee2e6;
  font-weight: bold;
}

.tabela-relatorio td {
  padding: 12px;
  border-bottom: 1px solid #dee2e6;
}

.tabela-relatorio tr:hover {
  background-color: #f8f9fa;
}

.status-pendente {
  background-color: #fff3cd;
  color: #856404;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.875rem;
}

.status-pago {
  background-color: #d4edda;
  color: #155724;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.875rem;
}

.status-atrasado {
  background-color: #f8d7da;
  color: #721c24;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.875rem;
}
</style>
<!-- ==================== LISTA DE DISPONIBILIDADE DE PERSONAGENS ==================== -->
<section id="lista_disponibilidade_personagens" class="page">
  <div class="card">
    <h2>üìã Lista de Disponibilidade de Personagens</h2>
    <p>Verifique a disponibilidade dos personagens para agendamento</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 180px;">
        <label>Data</label>
        <input type="date" id="filtroDataDisponibilidade" value="<?php echo date('Y-m-d'); ?>" onchange="carregarDisponibilidade()">
      </div>
      <div class="form-group" style="min-width: 180px;">
        <label>Personagem</label>
        <select id="filtroPersonagemDisponibilidade" onchange="carregarDisponibilidade()">
          <option value="todos">Todos os personagens</option>
        </select>
      </div>
      <div class="form-group" style="min-width: 120px;">
        <label>Hor√°rio In√≠cio</label>
        <input type="time" id="filtroHoraInicio" onchange="carregarDisponibilidade()">
      </div>
      <div class="form-group" style="min-width: 120px;">
        <label>Hor√°rio Fim</label>
        <input type="time" id="filtroHoraFim" onchange="carregarDisponibilidade()">
      </div>
      <div>
        <button class="btn" onclick="resetarFiltrosDisponibilidade()">‚Üª Limpar Filtros</button>
        <button class="btn primary" onclick="exportarDisponibilidade()">üì§ Exportar</button>
      </div>
    </div>
    
    <!-- Status Summary -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #d4edda;">
        <h4>Dispon√≠vel</h4>
        <p id="totalDisponivel" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
      </div>
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Parcialmente Dispon√≠vel</h4>
        <p id="totalParcial" style="font-size: 1.5rem; font-weight: bold; color: #856404;">0</p>
      </div>
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Indispon√≠vel</h4>
        <p id="totalIndisponivel" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">0</p>
      </div>
    </div>
    
    <!-- Tabela de Disponibilidade -->
    <div class="table-container">
      <table class="tabela-disponibilidade" style="width: 100%;">
        <thead>
          <tr>
            <th>Personagem</th>
            <th>Figurino</th>
            <th>Tema</th>
            <th>Quantidade Total</th>
            <th>Reservas no Dia</th>
            <th>Hor√°rios Reservados</th>
            <th>Pr√≥xima Disponibilidade</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaDisponibilidade">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Legenda -->
    <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
      <h4>Legenda de Status:</h4>
      <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <div style="width: 20px; height: 20px; background: #d4edda; border-radius: 4px;"></div>
          <span>Dispon√≠vel - Pode ser reservado at√© 3 vezes no mesmo dia</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <div style="width: 20px; height: 20px; background: #fff3cd; border-radius: 4px;"></div>
          <span>Parcial - Dispon√≠vel apenas para certos hor√°rios</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <div style="width: 20px; height: 20px; background: #f8d7da; border-radius: 4px;"></div>
          <span>Indispon√≠vel - J√° tem 3 reservas ou conflito de hor√°rio</span>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
.tabela-disponibilidade {
  border-collapse: collapse;
  width: 100%;
}

.tabela-disponibilidade th {
  background-color: #f8f9fa;
  padding: 12px;
  text-align: left;
  border-bottom: 2px solid #dee2e6;
  font-weight: bold;
}

.tabela-disponibilidade td {
  padding: 12px;
  border-bottom: 1px solid #dee2e6;
}

.status-disponivel {
  background-color: #d4edda;
  color: #155724;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 0.875rem;
}

.status-parcial {
  background-color: #fff3cd;
  color: #856404;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 0.875rem;
}

.status-indisponivel {
  background-color: #f8d7da;
  color: #721c24;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 0.875rem;
}

.reserva-horario {
  display: inline-block;
  background: #e9ecef;
  padding: 4px 8px;
  border-radius: 12px;
  margin: 2px;
  font-size: 0.85rem;
}

.horario-livre {
  background: #d4edda;
  color: #155724;
}

.horario-ocupado {
  background: #f8d7da;
  color: #721c24;
}
</style>

<!-- ==================== CADASTRAR MANUTEN√á√ÉO ==================== -->
<section id="cadastrar_manutencao" class="page">
  <div class="card">
    <h2>üõ†Ô∏è Cadastrar Manuten√ß√£o</h2>
    
    <form id="formManutencao" onsubmit="return false;">
      <!-- Sele√ß√£o do Personagem -->
      <div class="form-row">
        <div class="form-group" style="flex: 1;">
          <label for="personagem_manutencao">Personagem *</label>
          <select id="personagem_manutencao" required onchange="carregarFotoPersonagem()">
            <option value="">‚Äî Selecione o personagem ‚Äî</option>
          </select>
        </div>
        
        <div class="form-group" style="width: 150px;">
          <label for="data_registro">Data Registro</label>
          <input type="date" id="data_registro" value="<?php echo date('Y-m-d'); ?>" readonly>
        </div>
      </div>
      
      <!-- Pr√©-visualiza√ß√£o do Personagem -->
      <div id="previewPersonagem" style="display: none; margin-bottom: 1rem;">
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
          <h4 style="margin-top: 0;">üì∏ Personagem Selecionado</h4>
          <div style="display: flex; gap: 1.5rem; align-items: center;">
            <div id="fotoPersonagemContainer" style="width: 150px; height: 150px; border: 2px solid #dee2e6; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
              <img id="fotoPersonagem" src="" alt="Foto do Personagem" style="max-width: 100%; max-height: 100%;">
              <span id="semFoto" style="color: #6c757d;">Sem foto</span>
            </div>
            <div>
              <p><strong>Nome:</strong> <span id="nomePersonagem">-</span></p>
              <p><strong>Figurino:</strong> <span id="figurinoPersonagem">-</span></p>
              <p><strong>Tema:</strong> <span id="temaPersonagem">-</span></p>
              <p><strong>Status Atual:</strong> <span id="statusPersonagem" style="padding: 2px 8px; border-radius: 12px; background: #28a745; color: white;">Dispon√≠vel</span></p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Descri√ß√£o do Defeito -->
      <div class="form-row">
        <div class="form-group" style="flex: 1;">
          <label for="defeito_descricao">Descri√ß√£o do Defeito *</label>
          <textarea id="defeito_descricao" rows="4" required 
                    placeholder="Descreva detalhadamente o defeito encontrado..." 
                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"></textarea>
        </div>
      </div>
      
      <!-- Local do Defeito -->
      <div class="form-row">
        <div class="form-group" style="flex: 1;">
          <label for="local_defeito">Local do Defeito no Personagem *</label>
          <select id="local_defeito" required style="width: 100%; padding: 8px;">
            <option value="">‚Äî Selecione o local ‚Äî</option>
            <option value="cabeca">Cabe√ßa/Capacete</option>
            <option value="rosto">Rosto/M√°scara</option>
            <option value="corpo">Corpo (Parte Principal)</option>
            <option value="bra√ßos">Bra√ßos/M√£os</option>
            <option value="pernas">Pernas/P√©s</option>
            <option value="costas">Costas</option>
            <option value="acessorios">Acess√≥rios</option>
            <option value="costura">Costura/Fechos</option>
            <option value="material">Material/Tecido</option>
            <option value="eletronico">Componente Eletr√¥nico</option>
            <option value="outro">Outro Local</option>
          </select>
        </div>
        
        <div class="form-group" style="width: 200px;">
          <label for="severidade">Severidade do Defeito</label>
          <select id="severidade" required>
            <option value="baixa">Baixa (Uso imediato)</option>
            <option value="media" selected>M√©dia (Necessita reparo)</option>
            <option value="alta">Alta (Inutiliz√°vel)</option>
            <option value="critica">Cr√≠tica (Urgente)</option>
          </select>
        </div>
      </div>
      
      <!-- Fotografia do Defeito -->
      <div class="form-row">
        <div class="form-group" style="flex: 1;">
          <label for="foto_defeito">Fotografia do Defeito *</label>
          <div style="border: 2px dashed #ccc; border-radius: 8px; padding: 1.5rem; text-align: center; background: #f8f9fa;">
            <div style="font-size: 3rem; color: #6c757d; margin-bottom: 1rem;">üì∑</div>
            <p style="margin-bottom: 1rem; color: #495057;">
              <strong>Arraste e solte ou clique para selecionar uma foto</strong><br>
              <small style="color: #6c757d;">Formatos: JPG, PNG, GIF (M√°x: 5MB)</small>
            </p>
            <input type="file" id="foto_defeito" accept="image/*" required 
                   style="display: block; margin: 0 auto; padding: 10px;"
                   onchange="previewFotoDefeito(event)">
            <button type="button" class="btn" onclick="document.getElementById('foto_defeito').click()" 
                    style="margin-top: 1rem;">
              üìÅ Selecionar Foto
            </button>
          </div>
        </div>
        
        <!-- Pr√©-visualiza√ß√£o da Foto do Defeito -->
        <div class="form-group" style="flex: 1;">
          <label>Pr√©-visualiza√ß√£o</label>
          <div id="previewContainer" style="width: 100%; height: 200px; border: 2px dashed #dee2e6; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
            <div id="previewPlaceholder" style="text-align: center; color: #6c757d;">
              <div style="font-size: 3rem;">üñºÔ∏è</div>
              <p>Pr√©-visualiza√ß√£o da foto</p>
            </div>
            <img id="previewFotoDefeito" src="" alt="Pr√©-visualiza√ß√£o" style="max-width: 100%; max-height: 100%; display: none;">
          </div>
        </div>
      </div>
      
      <!-- Observa√ß√µes Adicionais -->
      <div class="form-row">
        <div class="form-group" style="flex: 1;">
          <label for="observacoes_manutencao">Observa√ß√µes Adicionais</label>
          <textarea id="observacoes_manutencao" rows="3" 
                    placeholder="Observa√ß√µes sobre o defeito, sugest√µes de reparo, etc..."
                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"></textarea>
        </div>
      </div>
      
      <!-- Bot√µes de A√ß√£o -->
      <div class="form-actions" style="margin-top: 2rem;">
        <button type="submit" class="btn primary" onclick="salvarManutencao()">
          üíæ Salvar Manuten√ß√£o
        </button>
        <button type="button" class="btn" onclick="limparFormularioManutencao()">
          üóëÔ∏è Limpar Formul√°rio
        </button>
        <button type="button" class="btn" onclick="showPage('lista_de_manutencao')">
          üìã Ver Lista de Manuten√ß√µes
        </button>
      </div>
    </form>
  </div>
</section>
<!-- ==================== LISTA DE MANUTEN√á√ÉO ==================== -->
<section id="lista_de_manutencao" class="page">
  <div class="card">
    <h2>üìã Lista de Manuten√ß√µes</h2>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="filtroStatusManutencao" onchange="filtrarManutencoes()">
          <option value="todos">Todos</option>
          <option value="analise" selected>Em An√°lise</option>
          <option value="andamento">Em Andamento</option>
          <option value="aguardando">Aguardando Pe√ßas</option>
          <option value="concluida">Conclu√≠da</option>
          <option value="cancelada">Cancelada</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Personagem</label>
        <select id="filtroPersonagemManutencao" onchange="filtrarManutencoes()">
          <option value="todos">Todos os Personagens</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 120px;">
        <label>Data In√≠cio</label>
        <input type="date" id="filtroDataInicioManutencao" onchange="filtrarManutencoes()">
      </div>
      
      <div class="form-group" style="min-width: 120px;">
        <label>Data Fim</label>
        <input type="date" id="filtroDataFimManutencao" onchange="filtrarManutencoes()">
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn primary" onclick="showPage('cadastrar_manutencao')">
          ‚ûï Nova Manuten√ß√£o
        </button>
        <button class="btn" onclick="resetarFiltrosManutencao()">
          ‚Üª Limpar Filtros
        </button>
      </div>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Em An√°lise</h4>
        <p id="totalAnalise" style="font-size: 1.5rem; font-weight: bold; color: #856404;">0</p>
      </div>
      
      <div class="card-mini" style="background: #cce5ff;">
        <h4>Em Andamento</h4>
        <p id="totalAndamento" style="font-size: 1.5rem; font-weight: bold; color: #004085;">0</p>
      </div>
      
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Aguardando Pe√ßas</h4>
        <p id="totalAguardando" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">0</p>
      </div>
      
      <div class="card-mini" style="background: #d4edda;">
        <h4>Conclu√≠das</h4>
        <p id="totalConcluidas" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
      </div>
      
      <div class="card-mini" style="background: #e2e3e5;">
        <h4>Total</h4>
        <p id="totalManutencoes" style="font-size: 1.5rem; font-weight: bold; color: #383d41;">0</p>
      </div>
    </div>
    
    <!-- Tabela de Manuten√ß√µes -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>ID</th>
            <th>Data Registro</th>
            <th>Personagem</th>
            <th>Defeito</th>
            <th>Severidade</th>
            <th>Status</th>
            <th>O Que Foi Feito</th>
            <th>Data Conclus√£o</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaManutencoes">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
    
    <!-- Bot√µes de A√ß√£o em Massa -->
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <button class="btn" onclick="exportarRelatorioManutencao()">
        üì• Exportar Relat√≥rio
      </button>
      <button class="btn" onclick="imprimirRelatorioManutencao()">
        üñ®Ô∏è Imprimir
      </button>
    </div>
  </div>
</section>

<!-- Modal para Detalhes da Manuten√ß√£o -->
<div id="modalDetalhesManutencao" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h3>üõ†Ô∏è Detalhes da Manuten√ß√£o</h3>
      <span class="close" onclick="fecharModalManutencao()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="detalhesManutencaoConteudo"></div>
    </div>
  </div>
</div>

<!-- Modal para Registrar Reparo -->
<div id="modalRegistrarReparo" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h3>üîß Registrar Reparo Realizado</h3>
      <span class="close" onclick="fecharModalReparo()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formReparo" onsubmit="return false;">
        <input type="hidden" id="manutencaoIdReparo">
        
        <div class="form-group">
          <label for="oque_foi_feito">O Que Foi Feito *</label>
          <textarea id="oque_foi_feito" rows="4" required 
                    placeholder="Descreva detalhadamente o reparo realizado..."
                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group" style="flex: 1;">
            <label for="custo_reparo">Custo do Reparo (R$)</label>
            <input type="text" id="custo_reparo" placeholder="0,00" 
                   oninput="formatarMoeda(this)" style="width: 100%;">
          </div>
          
          <div class="form-group" style="flex: 1;">
            <label for="tempo_gasto">Tempo Gasto (horas)</label>
            <input type="number" id="tempo_gasto" min="0" step="0.5" 
                   placeholder="Ex: 2.5" style="width: 100%;">
          </div>
        </div>
        
        <div class="form-group">
          <label for="material_utilizado">Material Utilizado</label>
          <textarea id="material_utilizado" rows="2" 
                    placeholder="Liste os materiais utilizados no reparo..."
                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"></textarea>
        </div>
        
        <div class="form-group">
          <label for="responsavel_reparo">Respons√°vel pelo Reparo</label>
          <input type="text" id="responsavel_reparo" 
                 placeholder="Nome do t√©cnico/respons√°vel" style="width: 100%;">
        </div>
        
        <div class="form-group">
          <label for="status_final">Status Final</label>
          <select id="status_final" style="width: 100%; padding: 8px;">
            <option value="concluida">‚úÖ Conclu√≠da com Sucesso</option>
            <option value="aguardando">‚è≥ Aguardando Teste</option>
            <option value="cancelada">‚ùå Cancelada</option>
            <option value="substituido">üîÑ Personagem Substitu√≠do</option>
          </select>
        </div>
        
        <div class="form-actions" style="margin-top: 1.5rem;">
          <button type="submit" class="btn primary" onclick="salvarReparo()">
            üíæ Registrar Reparo
          </button>
          <button type="button" class="btn" onclick="fecharModalReparo()">
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ==================== RELAT√ìRIOS - EVENTOS (P√ÅGINA √öNICA) ==================== -->
<section id="relatorios_eventos" class="page">
  <div class="card">
    <h2>üìä Relat√≥rio de Eventos</h2>
    <p>Visualize relat√≥rios de eventos realizados, cancelados e finalizados</p>
    
    <!-- Abas de Navega√ß√£o -->
    <div class="tabs" style="display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 1.5rem;">
      <button class="tab-btn active" onclick="abrirTabEvento('realizados')" style="background: #28a745; color: white;">
        ‚úÖ Realizados
      </button>
      <button class="tab-btn" onclick="abrirTabEvento('cancelados')" style="background: #dc3545; color: white;">
        ‚ùå Cancelados
      </button>
      <button class="tab-btn" onclick="abrirTabEvento('finalizados')" style="background: #6c757d; color: white;">
        üìÖ Finalizados
      </button>
    </div>
    
    <!-- Conte√∫do das Abas -->
    <div id="conteudo-relatorios">
      
      <!-- === ABA: EVENTOS REALIZADOS === -->
      <div id="tab-realizados" class="tab-content active">
        <h3>üìÖ Eventos Realizados</h3>
        <p>Eventos que foram reservados e realizados (total ou parcialmente pagos)</p>
        
        <!-- Filtros Realizados -->
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
          <div class="form-group" style="min-width: 150px;">
            <label>Per√≠odo</label>
            <select id="periodoRealizados" onchange="filtrarEventosRealizados()">
              <option value="todos">Todos</option>
              <option value="hoje">Hoje</option>
              <option value="semana">Esta Semana</option>
              <option value="mes">Este M√™s</option>
              <option value="personalizado">Personalizado</option>
            </select>
          </div>
          
          <div class="form-group" style="min-width: 120px; display: none;" id="dataInicioRealizadosDiv">
            <label>De</label>
            <input type="date" id="dataInicioRealizados" onchange="filtrarEventosRealizados()">
          </div>
          
          <div class="form-group" style="min-width: 120px; display: none;" id="dataFimRealizadosDiv">
            <label>At√©</label>
            <input type="date" id="dataFimRealizados" onchange="filtrarEventosRealizados()">
          </div>
          
          <div class="form-group" style="min-width: 150px;">
            <label>Status Pagamento</label>
            <select id="statusPagamentoRealizados" onchange="filtrarEventosRealizados()">
              <option value="todos">Todos</option>
              <option value="total">Totalmente Pago</option>
              <option value="parcial">Parcialmente Pago</option>
              <option value="pendente">Pendente</option>
            </select>
          </div>
          
          <div class="form-group" style="min-width: 150px;">
            <label>Cliente</label>
            <select id="clienteRealizados" onchange="filtrarEventosRealizados()">
              <option value="todos">Todos os clientes</option>
            </select>
          </div>
          
          <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
            <button class="btn" onclick="resetarFiltrosRealizados()">‚Üª Limpar</button>
            <button class="btn primary" onclick="exportarRelatorioRealizados()">üì• Exportar</button>
            <button class="btn" onclick="imprimirRelatorioRealizados()">üñ®Ô∏è Imprimir</button>
          </div>
        </div>
        
        <!-- Totais Realizados -->
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
          <div class="card-mini" style="background: #d4edda;">
            <h4>Total de Eventos</h4>
            <p id="totalEventosRealizados" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
          </div>
          <div class="card-mini" style="background: #cce5ff;">
            <h4>Valor Total</h4>
            <p id="valorTotalRealizados" style="font-size: 1.5rem; font-weight: bold; color: #004085;">R$ 0,00</p>
          </div>
          <div class="card-mini" style="background: #d1ecf1;">
            <h4>Receita M√©dia</h4>
            <p id="mediaRealizados" style="font-size: 1.5rem; font-weight: bold; color: #0c5460;">R$ 0,00</p>
          </div>
        </div>
        
        <!-- Tabela de Eventos Realizados -->
        <div class="table-container">
          <table class="tabela-relatorio-eventos" style="width: 100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Data</th>
                <th>Cliente</th>
                <th>Local</th>
                <th>Personagens</th>
                <th>Valor Total</th>
                <th>Pago</th>
                <th>Status Pagamento</th>
                <th>Observa√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tabelaEventosRealizados">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- === ABA: EVENTOS CANCELADOS === -->
      <div id="tab-cancelados" class="tab-content" style="display: none;">
        <h3>‚ùå Eventos Cancelados</h3>
        <p>Eventos cancelados com motivo especificado</p>
        
        <!-- Filtros Cancelados -->
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
          <div class="form-group" style="min-width: 150px;">
            <label>Per√≠odo</label>
            <select id="periodoCancelados" onchange="filtrarEventosCancelados()">
              <option value="todos">Todos</option>
              <option value="hoje">Hoje</option>
              <option value="semana">Esta Semana</option>
              <option value="mes">Este M√™s</option>
              <option value="personalizado">Personalizado</option>
            </select>
          </div>
          
          <div class="form-group" style="min-width: 120px; display: none;" id="dataInicioCanceladosDiv">
            <label>De</label>
            <input type="date" id="dataInicioCancelados" onchange="filtrarEventosCancelados()">
          </div>
          
          <div class="form-group" style="min-width: 120px; display: none;" id="dataFimCanceladosDiv">
            <label>At√©</label>
            <input type="date" id="dataFimCancelados" onchange="filtrarEventosCancelados()">
          </div>
          
          <div class="form-group" style="min-width: 150px;">
            <label>Motivo</label>
            <select id="motivoCancelados" onchange="filtrarEventosCancelados()">
              <option value="todos">Todos os motivos</option>
              <option value="cliente">Cliente cancelou</option>
              <option value="empresa">Empresa cancelou</option>
              <option value="clima">Problemas clim√°ticos</option>
              <option value="logistica">Problemas log√≠sticos</option>
              <option value="outro">Outros</option>
            </select>
          </div>
          
          <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
            <button class="btn" onclick="resetarFiltrosCancelados()">‚Üª Limpar</button>
            <button class="btn primary" onclick="exportarRelatorioCancelados()">üì• Exportar</button>
            <button class="btn" onclick="imprimirRelatorioCancelados()">üñ®Ô∏è Imprimir</button>
          </div>
        </div>
        
        <!-- Totais Cancelados -->
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
          <div class="card-mini" style="background: #f8d7da;">
            <h4>Total Cancelado</h4>
            <p id="totalEventosCancelados" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">0</p>
          </div>
          <div class="card-mini" style="background: #f5c6cb;">
            <h4>Valor Perdido</h4>
            <p id="valorPerdidoCancelados" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
          </div>
          <div class="card-mini" style="background: #e2e3e5;">
            <h4>Sinal Devolvido</h4>
            <p id="sinalDevolvido" style="font-size: 1.5rem; font-weight: bold; color: #383d41;">R$ 0,00</p>
          </div>
        </div>
        
        <!-- Tabela de Eventos Cancelados -->
        <div class="table-container">
          <table class="tabela-relatorio-eventos" style="width: 100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Data Prevista</th>
                <th>Cliente</th>
                <th>Local</th>
                <th>Valor Total</th>
                <th>Sinal Pago</th>
                <th>Motivo</th>
                <th>Data Cancelamento</th>
                <th>Sinal Devolvido</th>
                <th>Respons√°vel</th>
              </tr>
            </thead>
            <tbody id="tabelaEventosCancelados">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- === ABA: EVENTOS FINALIZADOS === -->
      <div id="tab-finalizados" class="tab-content" style="display: none;">
        <h3>üìÖ Todos os Eventos</h3>
        <p>Eventos finalizados com filtro por status</p>
        
        <!-- Filtros Finalizados -->
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
          <div class="form-group" style="min-width: 150px;">
            <label>Per√≠odo</label>
            <select id="periodoFinalizados" onchange="filtrarEventosFinalizados()">
              <option value="todos">Todos</option>
              <option value="hoje">Hoje</option>
              <option value="semana">Esta Semana</option>
              <option value="mes">Este M√™s</option>
              <option value="personalizado">Personalizado</option>
            </select>
          </div>
          
          <div class="form-group" style="min-width: 120px; display: none;" id="dataInicioFinalizadosDiv">
            <label>De</label>
            <input type="date" id="dataInicioFinalizados" onchange="filtrarEventosFinalizados()">
          </div>
          
          <div class="form-group" style="min-width: 120px; display: none;" id="dataFimFinalizadosDiv">
            <label>At√©</label>
            <input type="date" id="dataFimFinalizados" onchange="filtrarEventosFinalizados()">
          </div>
          
          <div class="form-group" style="min-width: 150px;">
            <label>Status</label>
            <select id="statusFinalizados" onchange="filtrarEventosFinalizados()">
              <option value="todos">Todos os status</option>
              <option value="realizado">Realizado</option>
              <option value="cancelado">Cancelado</option>
              <option value="finalizado">Finalizado</option>
            </select>
          </div>
          
          <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
            <button class="btn" onclick="resetarFiltrosFinalizados()">‚Üª Limpar</button>
            <button class="btn primary" onclick="exportarRelatorioFinalizados()">üì• Exportar</button>
            <button class="btn" onclick="imprimirRelatorioFinalizados()">üñ®Ô∏è Imprimir</button>
          </div>
        </div>
        
        <!-- Totais Finalizados -->
        <div id="totaisFinalizados" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
          <!-- Totais ser√£o carregados dinamicamente -->
        </div>
        
        <!-- Tabela de Eventos Finalizados -->
        <div class="table-container">
          <table class="tabela-relatorio-eventos" style="width: 100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Data</th>
                <th>Cliente</th>
                <th>Local</th>
                <th>Status</th>
                <th>Valor Total</th>
                <th>Pago</th>
                <th>Pagamento Pendente</th>
                <th>Observa√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tabelaEventosFinalizados">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
    </div>
  </div>
</section>

<style>
/* Estilos para as abas */
.tabs {
  display: flex;
  border-bottom: 2px solid #dee2e6;
  margin-bottom: 1.5rem;
}

.tab-btn {
  padding: 10px 20px;
  border: none;
  background: #f8f9fa;
  cursor: pointer;
  font-weight: bold;
  border-radius: 8px 8px 0 0;
  margin-right: 5px;
  transition: all 0.3s;
}

.tab-btn:hover {
  background: #e9ecef;
}

.tab-btn.active {
  background: #007bff;
  color: white;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Estilos para as tabelas de relat√≥rios */
.tabela-relatorio-eventos {
  border-collapse: collapse;
  width: 100%;
}

.tabela-relatorio-eventos th {
  background-color: #f8f9fa;
  padding: 12px;
  text-align: left;
  border-bottom: 2px solid #dee2e6;
  font-weight: bold;
  position: sticky;
  top: 0;
}

.tabela-relatorio-eventos td {
  padding: 12px;
  border-bottom: 1px solid #dee2e6;
}

/* Cores para as linhas conforme o status */
.status-realizado {
  background-color: #d4edda !important; /* Verde claro */
}

.status-cancelado {
  background-color: #f8d7da !important; /* Vermelho claro */
}

.status-finalizado {
  background-color: #e2e3e5 !important; /* Cinza */
}

.status-badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.875rem;
  font-weight: bold;
}

.badge-realizado {
  background-color: #28a745;
  color: white;
}

.badge-cancelado {
  background-color: #dc3545;
  color: white;
}

.badge-finalizado {
  background-color: #6c757d;
  color: white;
}

.badge-pago {
  background-color: #28a745;
  color: white;
}

.badge-parcial {
  background-color: #ffc107;
  color: #212529;
}

.badge-pendente {
  background-color: #dc3545;
  color: white;
}

.card-mini {
  padding: 1rem;
  border-radius: 8px;
  flex: 1;
  min-width: 150px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.table-container {
  overflow-x: auto;
  max-height: 500px;
  overflow-y: auto;
  border: 1px solid #dee2e6;
  border-radius: 8px;
}
</style>

<!-- ==================== RELAT√ìRIO CLIENTES ==================== -->
<section id="relatorios_clientes" class="page">
  <div class="card">
    <h2>üë• Relat√≥rio de Clientes</h2>
    <p>An√°lise completa de todos os clientes cadastrados</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 180px;">
        <label>Potencial</label>
        <select id="filtroPotencialCliente" onchange="filtrarRelatorioClientes()">
          <option value="todos">Todos</option>
          <option value="alta">Alta Potencial</option>
          <option value="media">M√©dia Potencial</option>
          <option value="baixa">Baixa Potencial</option>
          <option value="nenhum">Sem Eventos</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Ordem</label>
        <select id="filtroOrdemCliente" onchange="filtrarRelatorioClientes()">
          <option value="nome">Nome A-Z</option>
          <option value="eventos">Mais Eventos</option>
          <option value="valor">Maior Valor</option>
          <option value="recencia">Mais Recente</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Documento</label>
        <select id="filtroDocCliente" onchange="filtrarRelatorioClientes()">
          <option value="todos">Todos</option>
          <option value="cpf">CPF</option>
          <option value="cnpj">CNPJ</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosClientes()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarRelatorioClientes()">üì• Exportar CSV</button>
        <button class="btn" onclick="imprimirRelatorioClientes()">üñ®Ô∏è Imprimir</button>
      </div>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #d4edda;">
        <h4>Total Clientes</h4>
        <p id="totalClientes" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
      </div>
      
      <div class="card-mini" style="background: #cce5ff;">
        <h4>Com Eventos</h4>
        <p id="clientesComEventos" style="font-size: 1.5rem; font-weight: bold; color: #004085;">0</p>
      </div>
      
      <div class="card-mini" style="background: #d1ecf1;">
        <h4>Receita Total</h4>
        <p id="receitaTotalClientes" style="font-size: 1.5rem; font-weight: bold; color: #0c5460;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #e2e3e5;">
        <h4>M√©dia por Cliente</h4>
        <p id="mediaPorCliente" style="font-size: 1.5rem; font-weight: bold; color: #383d41;">R$ 0,00</p>
      </div>
    </div>
    
    <!-- Legenda de Potencial -->
    <div style="display: flex; gap: 2rem; margin-bottom: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; flex-wrap: wrap;">
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <div style="width: 20px; height: 20px; background: #28a745; border-radius: 4px;"></div>
        <span><strong>Alta Potencial:</strong> 3+ eventos ou R$ 5.000+ em compras</span>
      </div>
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <div style="width: 20px; height: 20px; background: #ffc107; border-radius: 4px;"></div>
        <span><strong>M√©dia Potencial:</strong> 1-2 eventos e R$ 1.000-5.000</span>
      </div>
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <div style="width: 20px; height: 20px; background: #dc3545; border-radius: 4px;"></div>
        <span><strong>Baixa Potencial:</strong> 1 evento e menos de R$ 1.000</span>
      </div>
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <div style="width: 20px; height: 20px; background: #6c757d; border-radius: 4px;"></div>
        <span><strong>Sem Eventos:</strong> Cadastrados mas sem reservas</span>
      </div>
    </div>
    
    <!-- Tabela de Clientes -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Documento</th>
            <th>Contato</th>
            <th>Total Eventos</th>
            <th>Valor Total</th>
            <th>Primeiro Evento</th>
            <th>√öltimo Evento</th>
            <th>Potencial</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaRelatorioClientes">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO EQUIPE ==================== -->
<section id="relatorios_equipe" class="page">
  <div class="card">
    <h2>üë• Relat√≥rio Completo da Equipe</h2>
    <p>Lista completa de todos os membros da equipe cadastrados</p>
    
    <!-- Abas para os tipos de equipe -->
    <div class="tabs" style="display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 1.5rem;">
      <button class="tab-btn active" onclick="abrirTabEquipe('elenco')" style="background: #007bff; color: white;">
        üé¨ Elenco
      </button>
      <button class="tab-btn" onclick="abrirTabEquipe('producao')" style="background: #6f42c1; color: white;">
        üë∑ Produ√ß√£o
      </button>
      <button class="tab-btn" onclick="abrirTabEquipe('motoristas')" style="background: #20c997; color: white;">
        üöó Motoristas
      </button>
      <button class="tab-btn" onclick="abrirTabEquipe('funcionarios')" style="background: #fd7e14; color: white;">
        üßæ Funcion√°rios
      </button>
    </div>
    
    <!-- Conte√∫do das Abas -->
    <div id="conteudo-equipe">
      
      <!-- === ABA: ELENCO === -->
      <div id="tab-elenco" class="tab-content active">
        <h3>üé¨ Lista do Elenco</h3>
        <p>Todos os membros do elenco cadastrados no sistema</p>
        
        <!-- Filtros Elenco -->
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
          <div class="form-group" style="min-width: 150px;">
            <label>Buscar por Nome</label>
            <input type="text" id="buscarElenco" placeholder="Digite o nome..." onkeyup="filtrarElenco()" style="width: 200px;">
          </div>
          
          <div class="form-group" style="min-width: 150px;">
            <label>Idade</label>
            <select id="filtroIdadeElenco" onchange="filtrarElenco()">
              <option value="todos">Todas</option>
              <option value="18-25">18-25 anos</option>
              <option value="26-35">26-35 anos</option>
              <option value="36-45">36-45 anos</option>
              <option value="45+">45+ anos</option>
            </select>
          </div>
          
          <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
            <button class="btn" onclick="resetarFiltrosElenco()">‚Üª Limpar</button>
            <button class="btn primary" onclick="exportarRelatorioElenco()">üì• Exportar</button>
            <button class="btn" onclick="imprimirRelatorioElenco()">üñ®Ô∏è Imprimir</button>
          </div>
        </div>
        
        <!-- Tabela Elenco -->
        <div class="table-container">
          <table class="tabela-relatorio" style="width: 100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Documento</th>
                <th>Idade</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Cidade</th>
                <th>Eventos Participados</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tabelaElenco">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- === ABA: PRODU√á√ÉO === -->
      <div id="tab-producao" class="tab-content" style="display: none;">
        <h3>üë∑ Lista da Produ√ß√£o</h3>
        <p>Equipe de produ√ß√£o e funcion√°rios t√©cnicos</p>
        
        <!-- Tabela Produ√ß√£o -->
        <div class="table-container">
          <table class="tabela-relatorio" style="width: 100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Cargo</th>
                <th>Documento</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Eventos Participados</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tabelaProducao">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- === ABA: MOTORISTAS === -->
      <div id="tab-motoristas" class="tab-content" style="display: none;">
        <h3>üöó Lista de Motoristas</h3>
        <p>Motoristas cadastrados e seus ve√≠culos</p>
        
        <!-- Filtros Motoristas -->
        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
          <div class="form-group" style="min-width: 150px;">
            <label>Tipo de Ve√≠culo</label>
            <select id="filtroVeiculo" onchange="filtrarMotoristas()">
              <option value="todos">Todos</option>
              <option value="carro">Carro</option>
              <option value="van">Van</option>
              <option value="caminhonete">Caminhonete</option>
              <option value="outros">Outros</option>
            </select>
          </div>
        </div>
        
        <!-- Tabela Motoristas -->
        <div class="table-container">
          <table class="tabela-relatorio" style="width: 100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>CNH</th>
                <th>Ve√≠culo</th>
                <th>Telefone</th>
                <th>Chave PIX</th>
                <th>Eventos Participados</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tabelaMotoristas">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- === ABA: FUNCION√ÅRIOS === -->
      <div id="tab-funcionarios" class="tab-content" style="display: none;">
        <h3>üßæ Lista de Funcion√°rios</h3>
        <p>Funcion√°rios fixos da empresa</p>
        
        <!-- Tabela Funcion√°rios -->
        <div class="table-container">
          <table class="tabela-relatorio" style="width: 100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Cargo</th>
                <th>Documento</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Data Admiss√£o</th>
                <th>Sal√°rio</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="tabelaFuncionarios">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO FINANCEIRO ==================== -->
<section id="relatorios_financeiro" class="page">
  <div class="card">
    <h2>üí∞ Relat√≥rio Financeiro Completo</h2>
    <p>An√°lise completa de receitas, despesas e lucros</p>
    
    <!-- Per√≠odo -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Per√≠odo</label>
        <select id="periodoFinanceiro" onchange="carregarRelatorioFinanceiro()">
          <option value="mes_atual">Este M√™s</option>
          <option value="mes_anterior">M√™s Anterior</option>
          <option value="trimestre">Este Trimestre</option>
          <option value="semestre">Este Semestre</option>
          <option value="ano">Este Ano</option>
          <option value="personalizado">Personalizado</option>
          <option value="todos">Todo Per√≠odo</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 120px; display: none;" id="dataInicioFinanceiroDiv">
        <label>De</label>
        <input type="date" id="dataInicioFinanceiro" onchange="carregarRelatorioFinanceiro()">
      </div>
      
      <div class="form-group" style="min-width: 120px; display: none;" id="dataFimFinanceiroDiv">
        <label>At√©</label>
        <input type="date" id="dataFimFinanceiro" onchange="carregarRelatorioFinanceiro()">
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn primary" onclick="exportarRelatorioFinanceiro()">üì• Exportar</button>
        <button class="btn" onclick="imprimirRelatorioFinanceiro()">üñ®Ô∏è Imprimir</button>
        <button class="btn" onclick="gerarDemonstrativo()">üìä Demonstrativo</button>
      </div>
    </div>
    
    <!-- Resumo Financeiro -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
      
      <!-- RECEITAS -->
      <div style="background: linear-gradient(135deg, #d4edda, #c3e6cb); padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h3 style="color: #155724; margin-top: 0;">üìà Receitas</h3>
        <div style="font-size: 2rem; font-weight: bold; color: #155724; margin: 1rem 0;" id="totalReceitas">R$ 0,00</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
          <div>
            <div style="color: #155724;">Eventos Realizados</div>
            <div style="font-weight: bold;" id="receitaEventos">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #155724;">Sinais</div>
            <div style="font-weight: bold;" id="receitaSinais">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #155724;">Pagamentos Avulsos</div>
            <div style="font-weight: bold;" id="receitaAvulsos">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #155724;">Restante Recebido</div>
            <div style="font-weight: bold;" id="receitaRestante">R$ 0,00</div>
          </div>
        </div>
      </div>
      
      <!-- DESPESAS -->
      <div style="background: linear-gradient(135deg, #f8d7da, #f5c6cb); padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h3 style="color: #721c24; margin-top: 0;">üìâ Despesas</h3>
        <div style="font-size: 2rem; font-weight: bold; color: #721c24; margin: 1rem 0;" id="totalDespesas">R$ 0,00</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
          <div>
            <div style="color: #721c24;">Cache Elenco</div>
            <div style="font-weight: bold;" id="despesaElenco">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #721c24;">Cache Produ√ß√£o</div>
            <div style="font-weight: bold;" id="despesaProducao">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #721c24;">Motoristas</div>
            <div style="font-weight: bold;" id="despesaMotoristas">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #721c24;">Funcion√°rios</div>
            <div style="font-weight: bold;" id="despesaFuncionarios">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #721c24;">Fornecedores</div>
            <div style="font-weight: bold;" id="despesaFornecedores">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #721c24;">Cancelamentos</div>
            <div style="font-weight: bold;" id="despesaCancelamentos">R$ 0,00</div>
          </div>
        </div>
      </div>
      
      <!-- LUCRO -->
      <div style="background: linear-gradient(135deg, #cce5ff, #b8daff); padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <h3 style="color: #004085; margin-top: 0;">üíπ Lucro L√≠quido</h3>
        <div style="font-size: 2.5rem; font-weight: bold; color: #004085; margin: 1rem 0;" id="lucroLiquido">R$ 0,00</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
          <div>
            <div style="color: #004085;">Margem de Lucro</div>
            <div style="font-weight: bold;" id="margemLucro">0%</div>
          </div>
          <div>
            <div style="color: #004085;">Ticket M√©dio</div>
            <div style="font-weight: bold;" id="ticketMedio">R$ 0,00</div>
          </div>
          <div>
            <div style="color: #004085;">Eventos/M√™s</div>
            <div style="font-weight: bold;" id="eventosPorMes">0</div>
          </div>
          <div>
            <div style="color: #004085;">Lucro/Evento</div>
            <div style="font-weight: bold;" id="lucroPorEvento">R$ 0,00</div>
          </div>
        </div>
      </div>
      
    </div>
    
    <!-- Abas Detalhadas -->
    <div class="tabs" style="display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 1.5rem;">
      <button class="tab-btn active" onclick="abrirTabFinanceiro('receitas')" style="background: #28a745; color: white;">
        üìà Receitas Detalhadas
      </button>
      <button class="tab-btn" onclick="abrirTabFinanceiro('despesas')" style="background: #dc3545; color: white;">
        üìâ Despesas Detalhadas
      </button>
      <button class="tab-btn" onclick="abrirTabFinanceiro('lucros')" style="background: #007bff; color: white;">
        üíπ An√°lise de Lucros
      </button>
    </div>
    <!-- ==================== RELAT√ìRIO RECEITAS ==================== -->
<section id="relatorio_receitas" class="page">
  <div class="card">
    <h2>üìà Relat√≥rio de Receitas</h2>
    <p>Receitas provenientes de eventos realizados</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Per√≠odo</label>
        <select id="periodoReceitas" onchange="filtrarReceitas()">
          <option value="todos">Todos</option>
          <option value="mes_atual">Este M√™s</option>
          <option value="mes_anterior">M√™s Anterior</option>
          <option value="trimestre">√öltimos 3 Meses</option>
          <option value="ano">Este Ano</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="statusReceitas" onchange="filtrarReceitas()">
          <option value="todos">Todos</option>
          <option value="pago">Pago</option>
          <option value="parcial">Parcial</option>
          <option value="pendente">Pendente</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosReceitas()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarReceitas()">üì• Exportar</button>
      </div>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #d4edda;">
        <h4>Total Receita</h4>
        <p id="totalReceita" style="font-size: 1.5rem; font-weight: bold; color: #155724;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #cce5ff;">
        <h4>Recebido</h4>
        <p id="totalRecebido" style="font-size: 1.5rem; font-weight: bold; color: #004085;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Pendente</h4>
        <p id="totalPendenteReceita" style="font-size: 1.5rem; font-weight: bold; color: #856404;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #f8d7da;">
        <h4>M√©dia por Evento</h4>
        <p id="mediaReceita" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
    </div>
    
    <!-- Tabela de Receitas -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Evento</th>
            <th>Data</th>
            <th>Cliente</th>
            <th>Local</th>
            <th>Valor Total</th>
            <th>Recebido</th>
            <th>Pendente</th>
            <th>Status</th>
            <th>Forma Pagamento</th>
          </tr>
        </thead>
        <tbody id="tabelaReceitas">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO DESPESAS ==================== -->
<section id="relatorio_despesas" class="page">
  <div class="card">
    <h2>üìâ Relat√≥rio de Despesas</h2>
    <p>Despesas com equipe, fornecedores e custos operacionais</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Tipo de Despesa</label>
        <select id="tipoDespesa" onchange="filtrarDespesas()">
          <option value="todos">Todos</option>
          <option value="elenco">Elenco</option>
          <option value="motoristas">Motoristas</option>
          <option value="funcionarios">Funcion√°rios</option>
          <option value="fornecedores">Fornecedores</option>
          <option value="outros">Outros</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Status</label>
        <select id="statusDespesas" onchange="filtrarDespesas()">
          <option value="todos">Todos</option>
          <option value="pago">Pago</option>
          <option value="pendente">Pendente</option>
          <option value="atrasado">Atrasado</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosDespesas()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarDespesas()">üì• Exportar</button>
      </div>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Total Despesas</h4>
        <p id="totalDespesas" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #d4edda;">
        <h4>Pago</h4>
        <p id="totalPagoDespesas" style="font-size: 1.5rem; font-weight: bold; color: #155724;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Pendente</h4>
        <p id="totalPendenteDespesas" style="font-size: 1.5rem; font-weight: bold; color: #856404;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #e2e3e5;">
        <h4>M√©dia por Despesa</h4>
        <p id="mediaDespesa" style="font-size: 1.5rem; font-weight: bold; color: #383d41;">R$ 0,00</p>
      </div>
    </div>
    
    <!-- Distribui√ß√£o -->
    <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
      <h4>Distribui√ß√£o por Tipo</h4>
      <div id="distribuicaoDespesas" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <!-- Distribui√ß√£o ser√° carregada aqui -->
      </div>
    </div>
    
    <!-- Tabela de Despesas -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Descri√ß√£o</th>
            <th>Fornecedor/Benefici√°rio</th>
            <th>Data Vencimento</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Data Pagamento</th>
            <th>Forma Pagamento</th>
          </tr>
        </thead>
        <tbody id="tabelaDespesas">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO LUCROS ==================== -->
<section id="relatorio_lucros" class="page">
  <div class="card">
    <h2>üíπ Relat√≥rio de Lucros</h2>
    <p>An√°lise de lucratividade e margens</p>
    
    <!-- Per√≠odo -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Per√≠odo</label>
        <select id="periodoLucros" onchange="calcularLucros()">
          <option value="mes_atual">Este M√™s</option>
          <option value="mes_anterior">M√™s Anterior</option>
          <option value="trimestre">√öltimos 3 Meses</option>
          <option value="semestre">√öltimos 6 Meses</option>
          <option value="ano">Este Ano</option>
          <option value="todos">Todo Per√≠odo</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn primary" onclick="exportarLucros()">üì• Exportar</button>
      </div>
    </div>
    
    <!-- Resumo Financeiro -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
      <div style="background: linear-gradient(135deg, #d4edda, #c3e6cb); padding: 1.5rem; border-radius: 10px;">
        <h4 style="color: #155724;">üìà Receitas</h4>
        <div style="font-size: 2rem; font-weight: bold; color: #155724; margin: 1rem 0;" id="resumoReceitas">R$ 0,00</div>
        <div style="font-size: 0.9rem; color: #155724;">Total de receitas no per√≠odo</div>
      </div>
      
      <div style="background: linear-gradient(135deg, #f8d7da, #f5c6cb); padding: 1.5rem; border-radius: 10px;">
        <h4 style="color: #721c24;">üìâ Despesas</h4>
        <div style="font-size: 2rem; font-weight: bold; color: #721c24; margin: 1rem 0;" id="resumoDespesas">R$ 0,00</div>
        <div style="font-size: 0.9rem; color: #721c24;">Total de despesas no per√≠odo</div>
      </div>
      
      <div style="background: linear-gradient(135deg, #cce5ff, #b8daff); padding: 1.5rem; border-radius: 10px;">
        <h4 style="color: #004085;">üíπ Lucro L√≠quido</h4>
        <div style="font-size: 2rem; font-weight: bold; color: #004085; margin: 1rem 0;" id="resumoLucro">R$ 0,00</div>
        <div style="font-size: 0.9rem; color: #004085;">Receitas - Despesas</div>
      </div>
      
      <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: 1.5rem; border-radius: 10px;">
        <h4 style="color: #856404;">üìä Margem de Lucro</h4>
        <div style="font-size: 2rem; font-weight: bold; color: #856404; margin: 1rem 0;" id="resumoMargem">0%</div>
        <div style="font-size: 0.9rem; color: #856404;">Lucro / Receitas √ó 100</div>
      </div>
    </div>
    
    <!-- Gr√°fico de Barras -->
    <div style="background: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h4>Evolu√ß√£o Mensal</h4>
      <div style="height: 300px; display: flex; align-items: flex-end; justify-content: space-around; margin-top: 1rem; padding: 1rem; border: 1px solid #dee2e6; border-radius: 8px;">
        <div id="graficoLucros" style="display: flex; width: 100%; height: 250px; align-items: flex-end; justify-content: space-around;">
          <!-- Gr√°fico ser√° gerado aqui -->
        </div>
      </div>
    </div>
    
    <!-- An√°lise Detalhada -->
    <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h4>An√°lise por Tipo de Despesa</h4>
      <div class="table-container">
        <table class="tabela-relatorio" style="width: 100%;">
          <thead>
            <tr>
              <th>Tipo de Despesa</th>
              <th>Valor Total</th>
              <th>% das Despesas</th>
              <th>% das Receitas</th>
              <th>Recomenda√ß√£o</th>
            </tr>
          </thead>
          <tbody id="tabelaAnaliseLucros">
            <!-- An√°lise ser√° carregada aqui -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
<!-- ==================== RELAT√ìRIO ELENCO ==================== -->
<section id="relatorio_elenco" class="page">
  <div class="card">
    <h2>üé¨ Relat√≥rio do Elenco</h2>
    <p>Lista completa de todos os membros do elenco cadastrados</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 200px;">
        <label>Buscar por Nome</label>
        <input type="text" id="buscarElenco" placeholder="Digite o nome..." onkeyup="filtrarElenco()" style="width: 100%;">
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Cidade</label>
        <select id="cidadeElenco" onchange="filtrarElenco()">
          <option value="todos">Todas</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosElenco()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarRelatorioEquipe('elenco')">üì• Exportar</button>
        <button class="btn" onclick="imprimirRelatorioEquipe('elenco')">üñ®Ô∏è Imprimir</button>
      </div>
    </div>
    
    <!-- Estat√≠sticas -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total Elenco</h4>
        <p id="totalElenco" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">0</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Idade M√©dia</h4>
        <p id="idadeMediaElenco" style="font-size: 1.5rem; font-weight: bold; color: #856404;">0 anos</p>
      </div>
      
      <div class="card-mini" style="background: #d4edda;">
        <h4>Com Eventos</h4>
        <p id="elencoComEventos" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
      </div>
      
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Sem Eventos</h4>
        <p id="elencoSemEventos" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">0</p>
      </div>
    </div>
    
    <!-- Tabela do Elenco -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Documento</th>
            <th>Idade</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Cidade</th>
            <th>Eventos</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaElenco">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO MOTORISTAS ==================== -->
<section id="relatorio_motoristas" class="page">
  <div class="card">
    <h2>üöó Relat√≥rio de Motoristas</h2>
    <p>Lista completa de todos os motoristas cadastrados</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Tipo de Ve√≠culo</label>
        <select id="tipoVeiculo" onchange="filtrarMotoristas()">
          <option value="todos">Todos</option>
          <option value="carro">Carro</option>
          <option value="van">Van</option>
          <option value="caminhonete">Caminhonete</option>
          <option value="outros">Outros</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosMotoristas()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarRelatorioEquipe('motoristas')">üì• Exportar</button>
      </div>
    </div>
    
    <!-- Estat√≠sticas -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total Motoristas</h4>
        <p id="totalMotoristas" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">0</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Ve√≠culos Diferentes</h4>
        <p id="tiposVeiculos" style="font-size: 1.5rem; font-weight: bold; color: #856404;">0</p>
      </div>
      
      <div class="card-mini" style="background: #d4edda;">
        <h4>Com Eventos</h4>
        <p id="motoristasComEventos" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
      </div>
    </div>
    
    <!-- Tabela de Motoristas -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Nome</th>
            <th>CNH</th>
            <th>Ve√≠culo</th>
            <th>Telefone</th>
            <th>Chave PIX</th>
            <th>Eventos</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaMotoristas">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO PRODU√á√ÉO ==================== -->
<section id="relatorio_producao" class="page">
  <div class="card">
    <h2>üë∑ Relat√≥rio de Produ√ß√£o</h2>
    <p>Lista da equipe de produ√ß√£o cadastrada</p>
    
    <!-- Estat√≠sticas -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total Produ√ß√£o</h4>
        <p id="totalProducao" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">0</p>
      </div>
      
      <div class="card-mini" style="background: #d4edda;">
        <h4>Ativos</h4>
        <p id="producaoAtivos" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
      </div>
    </div>
    
    <!-- Tabela de Produ√ß√£o -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Cargo</th>
            <th>Documento</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Eventos</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaProducao">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO FUNCION√ÅRIOS ==================== -->
<section id="relatorio_funcionarios" class="page">
  <div class="card">
    <h2>üßæ Relat√≥rio de Funcion√°rios</h2>
    <p>Lista de funcion√°rios fixos da empresa</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Cargo</label>
        <select id="cargoFuncionarios" onchange="filtrarFuncionarios()">
          <option value="todos">Todos</option>
          <option value="administrativo">Administrativo</option>
          <option value="producao">Produ√ß√£o</option>
          <option value="coordena√ß√£o">Coordena√ß√£o</option>
          <option value="outros">Outros</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosFuncionarios()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarRelatorioEquipe('funcionarios')">üì• Exportar</button>
      </div>
    </div>
    
    <!-- Estat√≠sticas -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total Funcion√°rios</h4>
        <p id="totalFuncionarios" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">0</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Idade M√©dia</h4>
        <p id="idadeMediaFuncionarios" style="font-size: 1.5rem; font-weight: bold; color: #856404;">0 anos</p>
      </div>
      
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Folha Mensal</h4>
        <p id="folhaMensal" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
    </div>
    
    <!-- Tabela de Funcion√°rios -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Cargo</th>
            <th>Documento</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Sal√°rio</th>
            <th>Data Admiss√£o</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaFuncionarios">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO FORNECEDORES ==================== -->
<section id="relatorio_fornecedores" class="page">
  <div class="card">
    <h2>üì¶ Relat√≥rio de Fornecedores</h2>
    <p>Lista de todos os fornecedores cadastrados</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 150px;">
        <label>Tipo</label>
        <select id="tipoFornecedor" onchange="filtrarFornecedores()">
          <option value="todos">Todos</option>
          <option value="figurino">Figurino</option>
          <option value="alimentacao">Alimenta√ß√£o</option>
          <option value="transporte">Transporte</option>
          <option value="equipamento">Equipamento</option>
          <option value="outros">Outros</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Cidade</label>
        <select id="cidadeFornecedores" onchange="filtrarFornecedores()">
          <option value="todos">Todas</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosFornecedores()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarRelatorioEquipe('fornecedores')">üì• Exportar</button>
      </div>
    </div>
    
    <!-- Estat√≠sticas -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total Fornecedores</h4>
        <p id="totalFornecedores" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">0</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Tempo M√©dio</h4>
        <p id="tempoMedioFornecedores" style="font-size: 1.5rem; font-weight: bold; color: #856404;">0 anos</p>
      </div>
      
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Gasto Total</h4>
        <p id="gastoTotalFornecedores" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">R$ 0,00</p>
      </div>
    </div>
    
    <!-- Tabela de Fornecedores -->
    <div class="table-container">
      <table class="tabela-relatorio" style="width: 100%;">
        <thead>
          <tr>
            <th>Empresa</th>
            <th>CNPJ</th>
            <th>Tipo</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Cidade</th>
            <th>Tempo Empresa</th>
            <th>Status</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaFornecedores">
          <!-- Dados ser√£o carregados aqui -->
        </tbody>
      </table>
    </div>
  </div>
</section>
    <!-- Conte√∫do das Abas Financeiro -->
    <div id="conteudo-financeiro">
      
      <!-- RECEITAS DETALHADAS -->
      <div id="tab-receitas" class="tab-content active">
        <h3>üìà Detalhamento de Receitas</h3>
        
        <!-- Tabela Receitas -->
        <div class="table-container">
          <table class="tabela-relatorio" style="width: 100%;">
            <thead>
              <tr>
                <th>Data</th>
                <th>Evento</th>
                <th>Cliente</th>
                <th>Sinal</th>
                <th>Avulso</th>
                <th>Restante</th>
                <th>Total</th>
                <th>Status</th>
                <th>Forma Pagamento</th>
              </tr>
            </thead>
            <tbody id="tabelaReceitas">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- DESPESAS DETALHADAS -->
      <div id="tab-despesas" class="tab-content" style="display: none;">
        <h3>üìâ Detalhamento de Despesas</h3>
        
        <!-- Tabela Despesas -->
        <div class="table-container">
          <table class="tabela-relatorio" style="width: 100%;">
            <thead>
              <tr>
                <th>Data</th>
                <th>Tipo</th>
                <th>Descri√ß√£o</th>
                <th>Benefici√°rio</th>
                <th>Valor</th>
                <th>Forma Pagamento</th>
                <th>Status</th>
                <th>Comprovante</th>
              </tr>
            </thead>
            <tbody id="tabelaDespesas">
              <!-- Dados ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- AN√ÅLISE DE LUCROS -->
      <div id="tab-lucros" class="tab-content" style="display: none;">
        <h3>üíπ An√°lise de Lucratividade</h3>
        
        <!-- Gr√°fico de Compara√ß√£o -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
          <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h4>Evolu√ß√£o Mensal</h4>
            <div style="height: 300px; display: flex; align-items: flex-end; justify-content: space-around; margin-top: 1rem; border-bottom: 2px solid #dee2e6; padding-bottom: 1rem;">
              <!-- Gr√°fico ser√° gerado aqui -->
              <div id="graficoBarras" style="display: flex; width: 100%; height: 250px; align-items: flex-end; justify-content: space-around;">
                <!-- Barras ser√£o adicionadas dinamicamente -->
              </div>
            </div>
          </div>
          
          <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h4>Distribui√ß√£o</h4>
            <div style="height: 300px; display: flex; flex-direction: column; justify-content: center; gap: 1rem;">
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>Receitas</span>
                  <span id="percentReceitas">0%</span>
                </div>
                <div style="height: 20px; background: #e2e3e5; border-radius: 10px; overflow: hidden;">
                  <div id="barraReceitas" style="height: 100%; background: #28a745; width: 0%;"></div>
                </div>
              </div>
              
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>Despesas</span>
                  <span id="percentDespesas">0%</span>
                </div>
                <div style="height: 20px; background: #e2e3e5; border-radius: 10px; overflow: hidden;">
                  <div id="barraDespesas" style="height: 100%; background: #dc3545; width: 0%;"></div>
                </div>
              </div>
              
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>Lucro</span>
                  <span id="percentLucro">0%</span>
                </div>
                <div style="height: 20px; background: #e2e3e5; border-radius: 10px; overflow: hidden;">
                  <div id="barraLucro" style="height: 100%; background: #007bff; width: 0%;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- An√°lise por Tipo -->
        <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 1.5rem;">
          <h4>An√°lise por Tipo de Despesa</h4>
          <div class="table-container">
            <table class="tabela-relatorio" style="width: 100%;">
              <thead>
                <tr>
                  <th>Tipo de Despesa</th>
                  <th>Quantidade</th>
                  <th>Valor Total</th>
                  <th>% das Despesas</th>
                  <th>M√©dia por Evento</th>
                  <th>Recomenda√ß√£o</th>
                </tr>
              </thead>
              <tbody id="tabelaAnaliseDespesas">
                <!-- Dados ser√£o carregados aqui -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO PERSONAGENS ==================== -->
<section id="relatorios_personagens" class="page">
  <div class="card">
    <h2>üé≠ Cat√°logo de Personagens</h2>
    <p>Lista completa de todos os personagens cadastrados</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 200px;">
        <label>Buscar Personagem</label>
        <input type="text" id="buscarPersonagem" placeholder="Nome do personagem..." onkeyup="filtrarPersonagens()" style="width: 100%;">
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Tema</label>
        <select id="filtroTemaPersonagem" onchange="filtrarPersonagens()">
          <option value="todos">Todos os Temas</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Figurino</label>
        <select id="filtroFigurinoPersonagem" onchange="filtrarPersonagens()">
          <option value="todos">Todos os Figurinos</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosPersonagens()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarCatalogoPersonagens()">üì• Exportar Cat√°logo</button>
        <button class="btn" onclick="imprimirCatalogoPersonagens()">üñ®Ô∏è Imprimir</button>
      </div>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total Personagens</h4>
        <p id="totalPersonagens" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">0</p>
      </div>
      
      <div class="card-mini" style="background: #d4edda;">
        <h4>Valor Total em Personagens</h4>
        <p id="valorTotalPersonagens" style="font-size: 1.5rem; font-weight: bold; color: #155724;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Personagem Mais Caro</h4>
        <p id="personagemMaisCaro" style="font-size: 1.5rem; font-weight: bold; color: #856404;">-</p>
      </div>
      
      <div class="card-mini" style="background: #f8d7da;">
        <h4>Personagem Mais Reservado</h4>
        <p id="personagemMaisReservado" style="font-size: 1.5rem; font-weight: bold; color: #721c24;">-</p>
      </div>
    </div>
    
    <!-- Cat√°logo em Grid -->
    <div id="catalogoPersonagens" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
      <!-- Cards de personagens ser√£o gerados aqui -->
    </div>
    
    <!-- Alternar para Visualiza√ß√£o em Tabela -->
    <div style="text-align: center; margin: 2rem 0;">
      <button class="btn" onclick="alternarVisualizacaoPersonagens()" id="btnAlternarVisualizacao">
        üìã Ver em Tabela
      </button>
    </div>
    
    <!-- Tabela (inicialmente oculta) -->
    <div id="tabelaPersonagensContainer" style="display: none;">
      <div class="table-container">
        <table class="tabela-relatorio" style="width: 100%;">
          <thead>
            <tr>
              <th>Foto</th>
              <th>Nome</th>
              <th>Figurino</th>
              <th>Tema</th>
              <th>Quantidade</th>
              <th>Valor</th>
              <th>Reservas</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tabelaPersonagens">
            <!-- Dados ser√£o carregados aqui -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- ==================== RELAT√ìRIO CASAS DE FESTA ==================== -->
<section id="relatorios_casas_de_festa" class="page">
  <div class="card">
    <h2>üè∞ Relat√≥rio de Casas de Festa</h2>
    <p>An√°lise de todas as casas de festa e seus eventos realizados</p>
    
    <!-- Filtros -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: flex-end;">
      <div class="form-group" style="min-width: 200px;">
        <label>Buscar Casa</label>
        <input type="text" id="buscarCasaFesta" placeholder="Nome da casa..." onkeyup="filtrarCasasFesta()" style="width: 100%;">
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Cidade</label>
        <select id="filtroCidadeCasa" onchange="filtrarCasasFesta()">
          <option value="todos">Todas as Cidades</option>
        </select>
      </div>
      
      <div class="form-group" style="min-width: 150px;">
        <label>Ordenar por</label>
        <select id="filtroOrdemCasa" onchange="filtrarCasasFesta()">
          <option value="nome">Nome A-Z</option>
          <option value="eventos">Mais Eventos</option>
          <option value="receita">Maior Receita</option>
          <option value="avaliacao">Melhor Avalia√ß√£o</option>
        </select>
      </div>
      
      <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
        <button class="btn" onclick="resetarFiltrosCasasFesta()">‚Üª Limpar</button>
        <button class="btn primary" onclick="exportarRelatorioCasasFesta()">üì• Exportar</button>
        <button class="btn" onclick="imprimirRelatorioCasasFesta()">üñ®Ô∏è Imprimir</button>
      </div>
    </div>
    
    <!-- Totais -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h4>Total Casas</h4>
        <p id="totalCasasFesta" style="font-size: 1.5rem; font-weight: bold; color: #0056b3;">0</p>
      </div>
      
      <div class="card-mini" style="background: #d4edda;">
        <h4>Eventos Realizados</h4>
        <p id="totalEventosCasas" style="font-size: 1.5rem; font-weight: bold; color: #155724;">0</p>
      </div>
      
      <div class="card-mini" style="background: #cce5ff;">
        <h4>Receita Gerada</h4>
        <p id="receitaCasasFesta" style="font-size: 1.5rem; font-weight: bold; color: #004085;">R$ 0,00</p>
      </div>
      
      <div class="card-mini" style="background: #fff3cd;">
        <h4>Casa Mais Utilizada</h4>
        <p id="casaMaisUtilizada" style="font-size: 1.5rem; font-weight: bold; color: #856404;">-</p>
      </div>
    </div>
    
    <!-- Lista de Casas de Festa -->
    <div id="listaCasasFesta" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;">
      <!-- Cards das casas de festa ser√£o gerados aqui -->
    </div>
  </div>
</section>
<!-- ==================== RELAT√ìRIO RECEITAS ==================== -->
<section id="relatorios_receitas" class="page">
  <div class="card">
    <h2>üìà Relat√≥rio de Receitas</h2>
    <!-- Conte√∫do din√¢mico ser√° carregado aqui -->
    <div id="conteudoReceitas"></div>
  </div>
</section>

<section id="relatorios_despesas" class="page">
  <div class="card">
    <h2>üìâ Relat√≥rio de Despesas</h2>
    <div id="conteudoDespesas"></div>
  </div>
</section>

<section id="relatorios_lucros" class="page">
  <div class="card">
    <h2>üíπ Relat√≥rio de Lucros</h2>
    <div id="conteudoLucros"></div>
  </div>
</section>

<!-- ==================== CADASTRAR USU√ÅRIOS ==================== -->
<section id="usuarios_sistema" class="page">
  <div class="card">
    <h2>üë§ Cadastro de Usu√°rios do Sistema</h2>
    
    <!-- Formul√°rio de Cadastro -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
      
      <!-- Coluna 1: Formul√°rio -->
      <div>
        <h3>‚ûï Novo Usu√°rio</h3>
        <form id="formUsuario" onsubmit="return false;">
          
          <div class="form-row">
            <div class="form-group" style="width: 100px;">
              <label>ID</label>
              <input type="text" id="ID_usuario" readonly style="width:100%; background:#f0f0f0;">
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label>CPF *</label>
              <input type="text" id="cpf_usuario" placeholder="000.000.000-00" required
                     maxlength="14" oninput="formatarCPF(this)" style="width:100%;">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label>Nome Completo *</label>
              <input type="text" id="nome_usuario" required style="width:100%;">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label>Login/Usu√°rio *</label>
              <input type="text" id="login_usuario" required 
                     placeholder="Ex: joao.silva" style="width:100%;">
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label>Senha *</label>
              <div style="display: flex; gap: 0.5rem;">
                <input type="password" id="senha_usuario" required style="flex: 1;">
                <button type="button" class="btn" onclick="toggleSenha()" style="width: 40px;">
                  üëÅÔ∏è
                </button>
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label>Email</label>
              <input type="email" id="email_usuario" style="width:100%;">
            </div>
            
            <div class="form-group" style="width: 150px;">
              <label>Telefone</label>
              <input type="text" id="telefone_usuario" placeholder="(00) 00000-0000" 
                     oninput="formatarTelefone(this)" style="width:100%;">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label>Cargo/Fun√ß√£o</label>
              <select id="cargo_usuario" style="width:100%;">
                <option value="">‚Äî Selecione ‚Äî</option>
                <option value="administrador">Administrador</option>
                <option value="gerente">Gerente</option>
                <option value="coordenador">Coordenador</option>
                <option value="atendente">Atendente</option>
                <option value="producao">Produ√ß√£o</option>
                <option value="financeiro">Financeiro</option>
                <option value="estoque">Estoque</option>
                <option value="outro">Outro</option>
              </select>
            </div>
            
            <div class="form-group" style="width: 150px;">
              <label>Data Admiss√£o</label>
              <input type="date" id="data_admissao" style="width:100%;">
            </div>
          </div>
          
          <div class="form-actions" style="margin-top: 1.5rem;">
            <button type="submit" class="btn primary" onclick="salvarUsuario()">
              üíæ Salvar Usu√°rio
            </button>
            <button type="button" class="btn" onclick="limparFormularioUsuario()">
              üóëÔ∏è Limpar
            </button>
          </div>
          
        </form>
      </div>
      
      <!-- Coluna 2: Lista de Usu√°rios -->
      <div>
        <h3>üìã Usu√°rios Cadastrados</h3>
        <div style="margin-bottom: 1rem;">
          <input type="text" id="buscarUsuario" placeholder="Buscar por nome ou login..." 
                 onkeyup="filtrarUsuarios()" style="width:100%; padding: 8px;">
        </div>
        
        <div class="table-container" style="max-height: 400px; overflow-y: auto;">
          <table class="tabela-relatorio" style="width:100%;">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Login</th>
                <th>Cargo</th>
                <th>Status</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="listaUsuarios">
              <!-- Usu√°rios ser√£o carregados aqui -->
            </tbody>
          </table>
        </div>
        
        <div style="margin-top: 1rem; text-align: center;">
          <button class="btn" onclick="exportarUsuarios()">
            üì• Exportar Lista
          </button>
        </div>
      </div>
      
    </div>
  </div>
</section>

<!-- Modal para Editar Usu√°rio -->
<div id="modalEditarUsuario" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h3>‚úèÔ∏è Editar Usu√°rio</h3>
      <span class="close" onclick="fecharModalUsuario()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formEditarUsuario" onsubmit="return false;">
        <input type="hidden" id="editar_id">
        
        <div class="form-row">
          <div class="form-group" style="flex: 1;">
            <label>Nome</label>
            <input type="text" id="editar_nome" required style="width:100%;">
          </div>
          
          <div class="form-group" style="flex: 1;">
            <label>Login</label>
            <input type="text" id="editar_login" required style="width:100%;">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group" style="flex: 1;">
            <label>Email</label>
            <input type="email" id="editar_email" style="width:100%;">
          </div>
          
          <div class="form-group" style="width: 150px;">
            <label>Cargo</label>
            <select id="editar_cargo" style="width:100%;">
              <option value="administrador">Administrador</option>
              <option value="gerente">Gerente</option>
              <option value="coordenador">Coordenador</option>
              <option value="atendente">Atendente</option>
              <option value="producao">Produ√ß√£o</option>
              <option value="financeiro">Financeiro</option>
              <option value="estoque">Estoque</option>
              <option value="outro">Outro</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group" style="flex: 1;">
            <label>Nova Senha (deixe em branco para manter)</label>
            <input type="password" id="editar_senha" style="width:100%;">
          </div>
          
          <div class="form-group" style="width: 120px;">
            <label>Status</label>
            <select id="editar_status" style="width:100%;">
              <option value="ativo">Ativo</option>
              <option value="inativo">Inativo</option>
            </select>
          </div>
        </div>
        
        <div class="form-actions" style="margin-top: 1.5rem;">
          <button type="submit" class="btn primary" onclick="atualizarUsuario()">
            üíæ Atualizar
          </button>
          <button type="button" class="btn" onclick="fecharModalUsuario()">
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- ==================== GERENCIAR PERMISS√ïES ==================== -->
<section id="permissoes_sistema" class="page">
  <div class="card">
    <h2>üîí Gerenciar Permiss√µes de Usu√°rios</h2>
    
    <!-- Seletor de Usu√°rio -->
    <div style="background: #e8f4fd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
      <div class="form-row" style="align-items: center;">
        <div class="form-group" style="flex: 1;">
          <label>Selecione o Usu√°rio para Configurar Permiss√µes:</label>
          <select id="selectUsuarioPermissao" onchange="carregarPermissoesUsuario()" style="width: 100%;">
            <option value="">‚Äî Selecione um usu√°rio ‚Äî</option>
          </select>
        </div>
        
        <div style="margin-left: 1rem;">
          <span id="infoUsuarioSelecionado" style="display: none; background: white; padding: 0.5rem 1rem; border-radius: 6px;">
            <strong id="nomeUsuarioSelecionado"></strong> | 
            <span id="cargoUsuarioSelecionado"></span> | 
            Status: <span id="statusUsuarioSelecionado" class="status-ativo"></span>
          </span>
        </div>
      </div>
    </div>
    
    <!-- Painel de Permiss√µes -->
    <div id="painelPermissoes" style="display: none;">
      
      <!-- Bot√µes de A√ß√£o R√°pida -->
      <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
        <button class="btn" onclick="selecionarTudo()">
          ‚úÖ Selecionar Tudo
        </button>
        <button class="btn" onclick="limparTudo()">
          ‚ùå Limpar Tudo
        </button>
        <button class="btn" onclick="permissaoAdministrador()">
          üëë Permiss√£o Admin
        </button>
        <button class="btn" onclick="permissaoAtendente()">
          üìû Permiss√£o Atendente
        </button>
        <button class="btn" onclick="permissaoProducao()">
          üë∑ Permiss√£o Produ√ß√£o
        </button>
        <button class="btn" onclick="permissaoFinanceiro()">
          üí∞ Permiss√£o Financeiro
        </button>
      </div>
      
      <!-- Grid de Permiss√µes por M√≥dulo -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
        
        <!-- M√≥dulo: EVENTOS -->
        <div class="card-modulo">
          <h3>üìÖ EVENTOS</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="reservar_evento">
              <span>Reservar Evento</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="todos_eventos">
              <span>Todos os Eventos</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="eventos_futuros">
              <span>Eventos Futuros</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="confirmar_dados">
              <span>Confirmar Dados</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="eventos_finalizados">
              <span>Eventos Finalizados</span>
            </label>
          </div>
        </div>
        
        <!-- M√≥dulo: CADASTROS -->
        <div class="card-modulo">
          <h3>üìá CADASTROS</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="clientes">
              <span>Clientes</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="casa_de_festas">
              <span>Casa de Festas</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="elenco">
              <span>Elenco</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="personagens">
              <span>Personagens</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="motoristas">
              <span>Motoristas</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="fornecedores">
              <span>Fornecedores</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="funcionarios">
              <span>Funcion√°rios</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="criar_checklist">
              <span>Criar Check List</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="lista_checklists">
              <span>Lista de Check Lists</span>
            </label>
          </div>
        </div>
        
        <!-- M√≥dulo: ESCALAS -->
        <div class="card-modulo">
          <h3>üìã ESCALAS</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="escalas">
              <span>Escalar Equipe</span>
            </label>
          </div>
        </div>
        
        <!-- M√≥dulo: FINANCEIRO -->
        <div class="card-modulo">
          <h3>üí∞ FINANCEIRO</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="contas_receber_eventos">
              <span>Contas a Receber</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="contas_pagar_fornecedores">
              <span>Contas a Pagar - Fornecedores</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="contas_pagar_elenco">
              <span>Contas a Pagar - Elenco</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="contas_pagar_motoristas">
              <span>Contas a Pagar - Motoristas</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="contas_pagar_producao">
              <span>Contas a Pagar - Produ√ß√£o</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="contas_pagar_funcionarios">
              <span>Contas a Pagar - Funcion√°rios</span>
            </label>
          </div>
        </div>
        
        <!-- M√≥dulo: DISPONIBILIDADE -->
        <div class="card-modulo">
          <h3>üé≠ DISPONIBILIDADE</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="lista_disponibilidade_personagens">
              <span>Lista de Disponibilidade</span>
            </label>
          </div>
        </div>
        
        <!-- M√≥dulo: MANUTEN√á√ÉO -->
        <div class="card-modulo">
          <h3>üîß MANUTEN√á√ÉO</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="cadastrar_manutencao">
              <span>Cadastrar Manuten√ß√£o</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="lista_de_manutencao">
              <span>Lista de Manuten√ß√£o</span>
            </label>
          </div>
        </div>
        
        <!-- M√≥dulo: RELAT√ìRIOS -->
        <div class="card-modulo">
          <h3>üìä RELAT√ìRIOS</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="relatorios_eventos">
              <span>Relat√≥rios - Eventos</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="relatorios_receitas">
              <span>Relat√≥rios - Receitas</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="relatorios_despesas">
              <span>Relat√≥rios - Despesas</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="relatorios_lucros">
              <span>Relat√≥rios - Lucros</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="relatorios_clientes">
              <span>Relat√≥rios - Clientes</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="lista_elenco">
              <span>Relat√≥rios - Lista Elenco</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="lista_motoristas">
              <span>Relat√≥rios - Lista Motoristas</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="lista_producao">
              <span>Relat√≥rios - Lista Produ√ß√£o</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="lista_funcionarios">
              <span>Relat√≥rios - Lista Funcion√°rios</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="relatorios_personagens">
              <span>Relat√≥rios - Personagens</span>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="relatorios_casas_de_festa">
              <span>Relat√≥rios - Casas de Festa</span>
            </label>
          </div>
        </div>
        
        <!-- M√≥dulo: CONFIGURA√á√ïES (acesso restrito) -->
        <div class="card-modulo" style="background: #fff3cd;">
          <h3>‚öôÔ∏è CONFIGURA√á√ïES</h3>
          <div class="lista-permissoes">
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="usuarios_sistema" data-restrito="true">
              <span>Cadastrar Usu√°rios</span>
              <small style="color: #856404;">(Apenas Administradores)</small>
            </label>
            <label class="permissao-item">
              <input type="checkbox" class="permissao-check" data-page="permissoes_sistema" data-restrito="true">
              <span>Gerenciar Permiss√µes</span>
              <small style="color: #856404;">(Apenas Administradores)</small>
            </label>
          </div>
        </div>
        
      </div>
      
      <!-- Bot√µes de Salvar -->
      <div style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid #dee2e6;">
        <button class="btn primary" onclick="salvarPermissoes()" style="padding: 10px 30px;">
          üíæ Salvar Permiss√µes
        </button>
        <button class="btn" onclick="testarPermissoes()" style="padding: 10px 30px;">
          üß™ Testar Permiss√µes
        </button>
      </div>
      
    </div>
    
  </div>
</div>
<!-- Adicione este modal de login no in√≠cio do body (antes do header) -->
<div id="modalLogin" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 400px;">
    <div class="modal-header">
      <h3>üîê Login do Sistema</h3>
    </div>
    <div class="modal-body">
      <form id="formLogin" onsubmit="return false;">
        <div class="form-group">
          <label>Login/Usu√°rio</label>
          <input type="text" id="loginInput" required placeholder="Digite seu login">
        </div>
        
        <div class="form-group">
          <label>Senha</label>
          <input type="password" id="senhaInput" required placeholder="Digite sua senha">
        </div>
        
        <div class="form-actions" style="margin-top: 1.5rem;">
          <button type="submit" class="btn primary" onclick="validarLogin()">
            üîì Entrar
          </button>
        </div>
        
        <div style="margin-top: 1rem; text-align: center; font-size: 0.9rem; color: #6c757d;">
          <p>Usu√°rio padr√£o: admin | Senha: admin123</p>
        </div>
      </form>
    </div>
  </div>
</div>
        <!-- Adicione outras p√°ginas conforme seus bot√µes -->

</main>
    
  </div>
  <section id="pagina_em_construcao" class="page" style="display:none;">
  <div class="card">
    <h2>P√°gina em constru√ß√£o</h2>
    <p>Esta funcionalidade estar√° dispon√≠vel em breve.</p>
  </div>
</section>

<!-- Modal de Detalhes da Disponibilidade -->
<div id="modalDetalhesDisponibilidade" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 800px;">
    <div class="modal-header">
      <h3>üìÖ Detalhes de Disponibilidade</h3>
      <span class="close" onclick="fecharModalDisponibilidade()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="detalhesPersonagem"></div>
      <div id="reservasDoDia" style="margin-top: 1.5rem;"></div>
      <div id="calculoDisponibilidade" style="margin-top: 1.5rem;"></div>
    </div>
  </div>
</div>

<!-- Modal para visualizar detalhes do cliente -->
<div id="modalDetalhesCliente" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h3>üë§ Detalhes do Cliente</h3>
      <span class="close" onclick="fecharModalCliente()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="detalhesClienteConteudo"></div>
    </div>
  </div>
</div>

<!-- Modal para visualizar detalhes do personagem -->
<div id="modalDetalhesPersonagem" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 800px;">
    <div class="modal-header">
      <h3>üé≠ Detalhes do Personagem</h3>
      <span class="close" onclick="fecharModalPersonagem()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="detalhesPersonagemConteudo"></div>
    </div>
  </div>
</div>

<!-- Modal para visualizar detalhes da casa de festa -->
<div id="modalDetalhesCasaFesta" class="modal" style="display:none;">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h3>üè∞ Detalhes da Casa de Festa</h3>
      <span class="close" onclick="fecharModalCasaFesta()">&times;</span>
    </div>
    <div class="modal-body">
      <div id="detalhesCasaFestaConteudo"></div>
    </div>
  </div>
</div>

<script>
// ==================== FUN√á√ïES PARA ESCALAR EQUIPE ====================

// 1. Abrir modal com eventos para escalar
function abrirModalEventosParaEscalar() {
  // Mostrar lista de eventos
  document.getElementById('listaEventosEscalar').style.display = 'block';
  document.getElementById('listaEventosEscalados').style.display = 'none';
  document.getElementById('areaEscala').style.display = 'none';
  
  // Carregar eventos do localStorage
  carregarEventosParaEscalar();
}

// 2. Mostrar eventos j√° escalados
function mostrarEventosEscalados() {
  document.getElementById('listaEventosEscalar').style.display = 'none';
  document.getElementById('listaEventosEscalados').style.display = 'block';
  document.getElementById('areaEscala').style.display = 'none';
  
  // Carregar eventos escalados
  carregarEventosEscalados();
}

// 3. Carregar eventos do localStorage
function carregarEventosParaEscalar() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const hoje = new Date().toISOString().split('T')[0];
  
  // Filtrar apenas eventos futuros ou do dia atual
  const eventosFuturos = eventos.filter(evento => evento.data >= hoje);
  
  let html = `
    <table class="tabela-relatorio" style="width:100%">
      <thead>
        <tr>
          <th>ID</th>
          <th>Data</th>
          <th>Cliente</th>
          <th>Local</th>
          <th>Status</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>`;
  
  eventosFuturos.forEach(evento => {
    // Verificar se j√° tem escala
    const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
    const temEscala = escalas.some(e => e.eventoId === evento.id);
    
    html += `
      <tr>
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td>${evento.cliente || 'N/A'}</td>
        <td>${evento.local || 'N/A'}</td>
        <td>
          <span style="padding: 4px 8px; border-radius: 12px; background: ${temEscala ? '#d4edda' : '#fff3cd'}; color: ${temEscala ? '#155724' : '#856404'}">
            ${temEscala ? '‚úÖ Escalado' : '‚è±Ô∏è Pendente'}
          </span>
        </td>
        <td>
          <button class="btn small" onclick="selecionarEventoParaEscalar('${evento.id}')">
            ${temEscala ? '‚úèÔ∏è Editar Escala' : '‚ûï Escalar'}
          </button>
        </td>
      </tr>
    `;
  });
  
  html += `</tbody></table>`;
  
  document.getElementById('tabelaEventosParaEscalar').innerHTML = html;
}

// 4. Carregar eventos j√° escalados
function carregarEventosEscalados() {
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  if (escalas.length === 0) {
    document.getElementById('tabelaEventosEscalados').innerHTML = `
      <div style="text-align:center; padding: 2rem; background: #f8f9fa; border-radius: 8px;">
        <p style="color: #6c757d;">Nenhum evento escalado ainda.</p>
      </div>
    `;
    return;
  }
  
  let html = `
    <table class="tabela-relatorio" style="width:100%">
      <thead>
        <tr>
          <th>Evento</th>
          <th>Data</th>
          <th>Elenco</th>
          <th>Motorista</th>
          <th>Produ√ß√£o</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>`;
  
  escalas.forEach(escala => {
    const evento = eventos.find(e => e.id === escala.eventoId);
    
    html += `
      <tr>
        <td>${evento ? evento.cliente : 'Evento n√£o encontrado'}</td>
        <td>${evento ? formatarData(evento.data) : 'N/A'}</td>
        <td>${escala.elenco ? escala.elenco.length + ' pessoas' : '0'}</td>
        <td>${escala.motorista || 'N√£o definido'}</td>
        <td>${escala.producao ? escala.producao.length + ' pessoas' : '0'}</td>
        <td>
          <button class="btn small" onclick="visualizarEscala('${escala.id}')">üëÅÔ∏è Ver</button>
          <button class="btn small" onclick="editarEscala('${escala.id}')">‚úèÔ∏è Editar</button>
          <button class="btn small danger" onclick="excluirEscala('${escala.id}')">üóëÔ∏è Excluir</button>
        </td>
      </tr>
    `;
  });
  
  html += `</tbody></table>`;
  
  document.getElementById('tabelaEventosEscalados').innerHTML = html;
}

// 5. Fun√ß√£o utilit√°ria para formatar data
function formatarData(dataString) {
  if (!dataString) return 'N/A';
  const [ano, mes, dia] = dataString.split('-');
  return `${dia}/${mes}/${ano}`;
}

// 6. Selecionar evento para escalar
function selecionarEventoParaEscalar(eventoId) {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const evento = eventos.find(e => e.id === eventoId);
  
  if (!evento) {
    alert('Evento n√£o encontrado!');
    return;
  }
  
  // Mostrar √°rea de escala
  document.getElementById('listaEventosEscalar').style.display = 'none';
  document.getElementById('listaEventosEscalados').style.display = 'none';
  document.getElementById('areaEscala').style.display = 'block';
  
  // Mostrar detalhes do evento
  document.getElementById('detalhesEventoEscala').innerHTML = `
    <div style="background: #e8f4fd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
      <p><strong>Cliente:</strong> ${evento.cliente || 'N/A'}</p>
      <p><strong>Data:</strong> ${formatarData(evento.data)}</p>
      <p><strong>Hor√°rio:</strong> ${evento.hora || 'N/A'}</p>
      <p><strong>Local:</strong> ${evento.local || 'N/A'}</p>
      <p><strong>Personagens:</strong> ${evento.personagens ? evento.personagens.length : '0'}</p>
    </div>
  `;
  
  // Carregar op√ß√µes para escala√ß√£o
  carregarOpcoesEscala();
  
  // Carregar escala existente se houver
  carregarEscalaExistente(eventoId);
}

// 7. Carregar op√ß√µes de equipe
function carregarOpcoesEscala() {
  // Carregar elenco
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const selectElenco = document.getElementById('selectElenco');
  selectElenco.innerHTML = '';
  elenco.forEach(pessoa => {
    const option = document.createElement('option');
    option.value = pessoa.id;
    option.textContent = pessoa.nome || pessoa.nome_elenco || 'N/A';
    selectElenco.appendChild(option);
  });
  
  // Carregar motoristas
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const selectMotoristas = document.getElementById('selectMotoristas');
  selectMotoristas.innerHTML = '<option value="">Selecione um motorista</option>';
  motoristas.forEach(motorista => {
    const option = document.createElement('option');
    option.value = motorista.id;
    option.textContent = motorista.nome || motorista.nome_motoristas || 'N/A';
    selectMotoristas.appendChild(option);
  });
  
  // Carregar funcion√°rios/produ√ß√£o
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  const selectProducao = document.getElementById('selectProducao');
  selectProducao.innerHTML = '';
  funcionarios.forEach(funcionario => {
    const option = document.createElement('option');
    option.value = funcionario.id;
    option.textContent = funcionario.nome || funcionario.nome_funcionarios || 'N/A';
    selectProducao.appendChild(option);
  });
}

// 8. Salvar escala
function salvarEscala() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const eventoSelecionado = eventos[0]; // Ajuste conforme sua l√≥gica
  
  if (!eventoSelecionado) {
    alert('Selecione um evento primeiro!');
    return;
  }
  
  // Capturar equipe selecionada
  const elencoSelecionado = Array.from(document.getElementById('selectElenco').selectedOptions)
    .map(option => option.value);
  const motoristaSelecionado = document.getElementById('selectMotoristas').value;
  const producaoSelecionada = Array.from(document.getElementById('selectProducao').selectedOptions)
    .map(option => option.value);
  
  // Criar objeto da escala
  const novaEscala = {
    id: Date.now().toString(),
    eventoId: eventoSelecionado.id,
    dataCriacao: new Date().toISOString(),
    elenco: elencoSelecionado,
    motorista: motoristaSelecionado,
    producao: producaoSelecionada,
    status: 'agendada'
  };
  
  // Salvar no localStorage
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  escalas.push(novaEscala);
  localStorage.setItem('escalas', JSON.stringify(escalas));
  
  alert('Escala salva com sucesso!');
  mostrarEventosEscalados(); // Voltar para lista de escalados
}

// Fun√ß√µes auxiliares
function exportarEscalas() {
  alert('Funcionalidade de exporta√ß√£o em desenvolvimento...');
}

function cancelarEscala() {
  mostrarEventosEscalados();
}
// ==================== FUN√á√ïES PARA CONTAS A RECEBER ====================

function carregarContasReceber() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
  
  // Filtrar apenas eventos finalizados
  const eventosFinalizados = eventos.filter(evento => 
    evento.status === 'finalizado' || 
    new Date(evento.data) < new Date()
  );
  
  // Gerar contas a receber
  const contasReceber = [];
  
  eventosFinalizados.forEach(evento => {
    // Buscar informa√ß√µes do cliente
    const cliente = clientes.find(c => 
      c.id === evento.clienteId || 
      c.nome === evento.cliente
    );
    
    // Calcular valores (assumindo que os dados est√£o no evento)
    const valorTotal = parseFloat(evento.valor_total || 0);
    const valorRecebido = parseFloat(evento.valor_recebido || 0);
    const valorPendente = valorTotal - valorRecebido;
    
    // Determinar status
    let status = 'pendente';
    if (valorPendente <= 0) status = 'recebido';
    else if (new Date(evento.data) < new Date()) status = 'atrasado';
    
    contasReceber.push({
      eventoId: evento.id,
      dataEvento: evento.data,
      cliente: evento.cliente || cliente?.nome || 'Cliente n√£o identificado',
      clienteId: evento.clienteId,
      valorTotal: valorTotal,
      valorRecebido: valorRecebido,
      valorPendente: valorPendente,
      status: status,
      vencimento: evento.data, // Usar data do evento como vencimento
      formaPagamento: evento.forma_pagamento_restante || 'N√£o definido'
    });
  });
  
  // Salvar no localStorage
  localStorage.setItem('contasReceber', JSON.stringify(contasReceber));
  
  // Atualizar filtro de clientes
  atualizarFiltroClientes(contasReceber);
  
  // Atualizar interface
  atualizarTabelaContasReceber(contasReceber);
  calcularTotaisContasReceber(contasReceber);
}

function atualizarTabelaContasReceber(contas) {
  const tabela = document.getElementById('tabelaContasReceber');
  let html = '';
  
  contas.forEach(conta => {
    const dataFormatada = formatarData(conta.dataEvento);
    const vencimentoFormatado = formatarData(conta.vencimento);
    
    html += `
      <tr>
        <td>${conta.eventoId || 'N/A'}</td>
        <td>${dataFormatada}</td>
        <td><strong>${conta.cliente}</strong></td>
        <td>R$ ${conta.valorTotal.toFixed(2).replace('.', ',')}</td>
        <td>R$ ${conta.valorRecebido.toFixed(2).replace('.', ',')}</td>
        <td style="color: ${conta.valorPendente > 0 ? '#dc3545' : '#28a745'}; font-weight: bold;">
          R$ ${conta.valorPendente.toFixed(2).replace('.', ',')}
        </td>
        <td>
          <span class="status-${conta.status}">${getStatusText(conta.status)}</span>
        </td>
        <td>${vencimentoFormatado}</td>
        <td>
          <button class="btn small" onclick="registrarRecebimento('${conta.eventoId}')">
            üí∞ Receber
          </button>
          <button class="btn small" onclick="detalhesContaReceber('${conta.eventoId}')">
            üëÅÔ∏è Detalhes
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
}

function calcularTotaisContasReceber(contas) {
  let totalReceber = 0;
  let totalRecebido = 0;
  let totalPendente = 0;
  let totalAtrasado = 0;
  
  contas.forEach(conta => {
    totalReceber += conta.valorTotal;
    totalRecebido += conta.valorRecebido;
    totalPendente += conta.valorPendente;
    
    if (conta.status === 'atrasado') {
      totalAtrasado += conta.valorPendente;
    }
  });
  
  document.getElementById('totalReceber').textContent = 
    `R$ ${totalReceber.toFixed(2).replace('.', ',')}`;
  document.getElementById('totalRecebido').textContent = 
    `R$ ${totalRecebido.toFixed(2).replace('.', ',')}`;
  document.getElementById('totalPendente').textContent = 
    `R$ ${totalPendente.toFixed(2).replace('.', ',')}`;
  document.getElementById('totalAtrasado').textContent = 
    `R$ ${totalAtrasado.toFixed(2).replace('.', ',')}`;
}

function filtrarContasReceber() {
  const status = document.getElementById('filtroStatusReceber').value;
  const cliente = document.getElementById('filtroClienteReceber').value;
  const dataInicio = document.getElementById('filtroDataInicioReceber').value;
  const dataFim = document.getElementById('filtroDataFimReceber').value;
  
  const contas = JSON.parse(localStorage.getItem('contasReceber') || '[]');
  let contasFiltradas = contas;
  
  // Aplicar filtros
  if (status !== 'todos') {
    contasFiltradas = contasFiltradas.filter(conta => conta.status === status);
  }
  
  if (cliente !== 'todos') {
    contasFiltradas = contasFiltradas.filter(conta => conta.clienteId === cliente);
  }
  
  if (dataInicio) {
    contasFiltradas = contasFiltradas.filter(conta => 
      new Date(conta.dataEvento) >= new Date(dataInicio)
    );
  }
  
  if (dataFim) {
    contasFiltradas = contasFiltradas.filter(conta => 
      new Date(conta.dataEvento) <= new Date(dataFim)
    );
  }
  
  atualizarTabelaContasReceber(contasFiltradas);
  calcularTotaisContasReceber(contasFiltradas);
}

function atualizarFiltroClientes(contas) {
  const select = document.getElementById('filtroClienteReceber');
  const clientesUnicos = [];
  
  contas.forEach(conta => {
    if (!clientesUnicos.some(c => c.id === conta.clienteId)) {
      clientesUnicos.push({
        id: conta.clienteId,
        nome: conta.cliente
      });
    }
  });
  
  let options = '<option value="todos">Todos os clientes</option>';
  clientesUnicos.forEach(cliente => {
    options += `<option value="${cliente.id}">${cliente.nome}</option>`;
  });
  
  select.innerHTML = options;
}

// ==================== FUN√á√ïES PARA CONTAS A PAGAR ====================

// ==================== FUN√á√ïES GERAIS ====================

function formatarData(dataString) {
  if (!dataString) return 'N/A';
  const [ano, mes, dia] = dataString.split('-');
  return `${dia}/${mes}/${ano}`;
}

function formatarMoeda(valor) {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(valor);
}

function calcularVencimento(dataEvento, dias = 7) {
  const data = new Date(dataEvento);
  data.setDate(data.getDate() + dias);
  return data.toISOString().split('T')[0];
}

// ==================== CONTAS A PAGAR - ELENCO ====================

function carregarContasPagarElenco() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  
  let contasElenco = JSON.parse(localStorage.getItem('contasPagarElenco') || '[]');
  
  // Se n√£o existir contas, criar a partir dos eventos e escalas
  if (contasElenco.length === 0) {
    contasElenco = [];
    
    escalas.forEach(escala => {
      const evento = eventos.find(e => e.id === escala.eventoId);
      
      if (evento && escala.elenco && Array.isArray(escala.elenco)) {
        escala.elenco.forEach(membroId => {
          const membro = elenco.find(e => e.id === membroId);
          
          if (membro) {
            // Valor por evento (ajustar conforme sua l√≥gica)
            const valorPagar = 150.00; // Valor exemplo por evento
            
            contasElenco.push({
              id: `elenco-${Date.now()}-${membroId}`,
              eventoId: evento.id,
              eventoNome: evento.cliente || `Evento ${evento.id}`,
              dataEvento: evento.data,
              membroId: membro.id,
              membroNome: membro.nome || membro.nome_elenco || 'Nome n√£o encontrado',
              valorPagar: valorPagar,
              formaPagamento: 'PIX', // Forma padr√£o
              status: 'pendente',
              vencimento: calcularVencimento(evento.data),
              dataPagamento: null,
              comprovante: null,
              criadoEm: new Date().toISOString()
            });
          }
        });
      }
    });
    
    localStorage.setItem('contasPagarElenco', JSON.stringify(contasElenco));
  }
  
  // Atualizar filtros
  atualizarFiltrosElenco(contasElenco);
  
  // Exibir dados
  filtrarContasPagarElenco();
}

function atualizarFiltrosElenco(contas) {
  // Eventos √∫nicos
  const eventosUnicos = [...new Set(contas.map(c => c.eventoId))];
  const selectEventos = document.getElementById('filtroEventoElenco');
  selectEventos.innerHTML = '<option value="todos">Todos os eventos</option>';
  
  eventosUnicos.forEach(eventoId => {
    const conta = contas.find(c => c.eventoId === eventoId);
    if (conta) {
      const option = document.createElement('option');
      option.value = eventoId;
      option.textContent = conta.eventoNome;
      selectEventos.appendChild(option);
    }
  });
  
  // Membros √∫nicos
  const membrosUnicos = [...new Set(contas.map(c => c.membroId))];
  const selectMembros = document.getElementById('filtroElenco');
  selectMembros.innerHTML = '<option value="todos">Todos</option>';
  
  membrosUnicos.forEach(membroId => {
    const conta = contas.find(c => c.membroId === membroId);
    if (conta) {
      const option = document.createElement('option');
      option.value = membroId;
      option.textContent = conta.membroNome;
      selectMembros.appendChild(option);
    }
  });
}

function filtrarContasPagarElenco() {
  const status = document.getElementById('filtroStatusElenco').value;
  const evento = document.getElementById('filtroEventoElenco').value;
  const membro = document.getElementById('filtroElenco').value;
  const formaPagamento = document.getElementById('filtroFormaPagamentoElenco').value;
  
  const contas = JSON.parse(localStorage.getItem('contasPagarElenco') || '[]');
  let contasFiltradas = contas;
  
  // Aplicar filtros
  if (status !== 'todos') {
    contasFiltradas = contasFiltradas.filter(conta => conta.status === status);
  }
  
  if (evento !== 'todos') {
    contasFiltradas = contasFiltradas.filter(conta => conta.eventoId === evento);
  }
  
  if (membro !== 'todos') {
    contasFiltradas = contasFiltradas.filter(conta => conta.membroId === membro);
  }
  
  if (formaPagamento !== 'todos') {
    contasFiltradas = contasFiltradas.filter(conta => conta.formaPagamento === formaPagamento);
  }
  
  atualizarTabelaContasPagarElenco(contasFiltradas);
}

function atualizarTabelaContasPagarElenco(contas) {
  const tabela = document.getElementById('tabelaContasPagarElenco');
  let html = '';
  let totalPagar = 0;
  let totalPago = 0;
  
  contas.forEach(conta => {
    totalPagar += conta.valorPagar;
    if (conta.status === 'pago') {
      totalPago += conta.valorPagar;
    }
    
    html += `
      <tr>
        <td>${conta.eventoNome}</td>
        <td>${formatarData(conta.dataEvento)}</td>
        <td><strong>${conta.membroNome}</strong></td>
        <td style="font-weight: bold;">${formatarMoeda(conta.valorPagar)}</td>
        <td>${conta.formaPagamento}</td>
        <td><span class="status-badge status-${conta.status}">${conta.status === 'pago' ? 'Pago' : conta.status === 'atrasado' ? 'Atrasado' : 'Pendente'}</span></td>
        <td>${formatarData(conta.vencimento)}</td>
        <td>${conta.dataPagamento ? formatarData(conta.dataPagamento) : 'N/A'}</td>
        <td>
          <button class="btn-small" onclick="pagarContaElenco('${conta.id}')" ${conta.status === 'pago' ? 'disabled style="opacity:0.5;"' : ''}>
            üí≥ Pagar
          </button>
          <button class="btn-small" onclick="editarContaElenco('${conta.id}')">
            ‚úèÔ∏è Editar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
  document.getElementById('totalPagarElenco').textContent = formatarMoeda(totalPagar);
  document.getElementById('totalPagoElenco').textContent = formatarMoeda(totalPago);
}

function resetarFiltrosElenco() {
  document.getElementById('filtroStatusElenco').value = 'todos';
  document.getElementById('filtroEventoElenco').value = 'todos';
  document.getElementById('filtroElenco').value = 'todos';
  document.getElementById('filtroFormaPagamentoElenco').value = 'todos';
  filtrarContasPagarElenco();
}

// ==================== CONTAS A PAGAR - MOTORISTAS ====================

function carregarContasPagarMotoristas() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  
  let contasMotoristas = JSON.parse(localStorage.getItem('contasPagarMotoristas') || '[]');
  
  if (contasMotoristas.length === 0) {
    contasMotoristas = [];
    
    escalas.forEach(escala => {
      const evento = eventos.find(e => e.id === escala.eventoId);
      
      if (evento && escala.motorista) {
        const motorista = motoristas.find(m => m.id === escala.motorista);
        
        if (motorista) {
          // Valor por evento para motorista
          const valorPagar = 200.00; // Valor exemplo
          
          contasMotoristas.push({
            id: `motorista-${Date.now()}-${escala.motorista}`,
            eventoId: evento.id,
            eventoNome: evento.cliente || `Evento ${evento.id}`,
            dataEvento: evento.data,
            motoristaId: motorista.id,
            motoristaNome: motorista.nome || motorista.nome_motoristas,
            veiculo: motorista.veiculo || 'N√£o informado',
            valorPagar: valorPagar,
            formaPagamento: 'PIX',
            status: 'pendente',
            vencimento: calcularVencimento(evento.data),
            dataPagamento: null
          });
        }
      }
    });
    
    localStorage.setItem('contasPagarMotoristas', JSON.stringify(contasMotoristas));
  }
  
  filtrarContasPagarMotoristas();
}

function filtrarContasPagarMotoristas() {
  const contas = JSON.parse(localStorage.getItem('contasPagarMotoristas') || '[]');
  atualizarTabelaContasPagarMotoristas(contas);
}

function atualizarTabelaContasPagarMotoristas(contas) {
  const tabela = document.getElementById('tabelaContasPagarMotoristas');
  let html = '';
  let total = 0;
  
  contas.forEach(conta => {
    total += conta.valorPagar;
    
    html += `
      <tr>
        <td>${conta.eventoNome}</td>
        <td>${formatarData(conta.dataEvento)}</td>
        <td><strong>${conta.motoristaNome}</strong></td>
        <td>${conta.veiculo}</td>
        <td style="font-weight: bold;">${formatarMoeda(conta.valorPagar)}</td>
        <td>${conta.formaPagamento}</td>
        <td><span class="status-badge status-${conta.status}">${conta.status === 'pago' ? 'Pago' : 'Pendente'}</span></td>
        <td>${formatarData(conta.vencimento)}</td>
        <td>${conta.dataPagamento ? formatarData(conta.dataPagamento) : 'N/A'}</td>
        <td>
          <button class="btn-small" onclick="pagarContaMotorista('${conta.id}')">
            üí≥ Pagar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
  document.getElementById('totalPagarMotoristas').textContent = formatarMoeda(total);
}

// ==================== CONTAS A PAGAR - PRODUCAO ====================

function carregarContasPagarProducao() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  
  let contasProducao = JSON.parse(localStorage.getItem('contasPagarProducao') || '[]');
  
  if (contasProducao.length === 0) {
    contasProducao = [];
    
    escalas.forEach(escala => {
      const evento = eventos.find(e => e.id === escala.eventoId);
      
      if (evento && escala.producao && Array.isArray(escala.producao)) {
        escala.producao.forEach(funcionarioId => {
          const funcionario = funcionarios.find(f => f.id === funcionarioId);
          
          if (funcionario) {
            // Valor por evento para produ√ß√£o
            const valorPagar = 120.00; // Valor exemplo
            
            contasProducao.push({
              id: `producao-${Date.now()}-${funcionarioId}`,
              eventoId: evento.id,
              eventoNome: evento.cliente || `Evento ${evento.id}`,
              dataEvento: evento.data,
              funcionarioId: funcionario.id,
              funcionarioNome: funcionario.nome || funcionario.nome_funcionarios,
              cargo: 'Auxiliar de Produ√ß√£o',
              valorPagar: valorPagar,
              formaPagamento: 'PIX',
              status: 'pendente',
              vencimento: calcularVencimento(evento.data)
            });
          }
        });
      }
    });
    
    localStorage.setItem('contasPagarProducao', JSON.stringify(contasProducao));
  }
  
  filtrarContasPagarProducao();
}

function atualizarTabelaContasPagarProducao(contas) {
  const tabela = document.getElementById('tabelaContasPagarProducao');
  let html = '';
  let total = 0;
  
  contas.forEach(conta => {
    total += conta.valorPagar;
    
    html += `
      <tr>
        <td>${conta.eventoNome}</td>
        <td>${formatarData(conta.dataEvento)}</td>
        <td><strong>${conta.funcionarioNome}</strong></td>
        <td>${conta.cargo}</td>
        <td style="font-weight: bold;">${formatarMoeda(conta.valorPagar)}</td>
        <td>${conta.formaPagamento}</td>
        <td><span class="status-badge status-${conta.status}">Pendente</span></td>
        <td>${formatarData(conta.vencimento)}</td>
        <td>N/A</td>
        <td>
          <button class="btn-small" onclick="pagarContaProducao('${conta.id}')">
            üí≥ Pagar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
  document.getElementById('totalPagarProducao').textContent = formatarMoeda(total);
}

// ==================== CONTAS A PAGAR - FORNECEDORES ====================

function carregarContasFornecedores() {
  let contasFornecedores = JSON.parse(localStorage.getItem('contasFornecedores') || '[]');
  
  // Se n√£o existir contas, criar exemplos
  if (contasFornecedores.length === 0) {
    contasFornecedores = [
      {
        id: 'forn-001',
        fornecedor: 'Sabesp',
        tipo: 'agua',
        descricao: 'Conta de √°gua - M√™s 11/2024',
        vencimento: '2024-12-10',
        valor: 250.50,
        formaPagamento: 'D√©bito Autom√°tico',
        status: 'pendente',
        dataPagamento: null
      },
      {
        id: 'forn-002',
        fornecedor: 'Enel',
        tipo: 'luz',
        descricao: 'Conta de luz - M√™s 11/2024',
        vencimento: '2024-12-05',
        valor: 480.75,
        formaPagamento: 'Transfer√™ncia',
        status: 'pendente',
        dataPagamento: null
      },
      {
        id: 'forn-003',
        fornecedor: 'Lopes Figurinos',
        tipo: 'figurino',
        descricao: 'Aluguel de figurinos - Evento Ana Clara',
        vencimento: '2024-12-15',
        valor: 1200.00,
        formaPagamento: 'PIX',
        status: 'pendente',
        dataPagamento: null
      },
      {
        id: 'forn-004',
        fornecedor: 'Imobili√°ria ABC',
        tipo: 'aluguel',
        descricao: 'Aluguel do escrit√≥rio',
        vencimento: '2024-12-01',
        valor: 3500.00,
        formaPagamento: 'Transfer√™ncia',
        status: 'pago',
        dataPagamento: '2024-11-30'
      }
    ];
    
    localStorage.setItem('contasFornecedores', JSON.stringify(contasFornecedores));
  }
  
  filtrarContasFornecedores();
}

function atualizarTabelaContasFornecedores(contas) {
  const tabela = document.getElementById('tabelaContasFornecedores');
  let html = '';
  let total = 0;
  
  contas.forEach(conta => {
    if (conta.status !== 'pago') {
      total += conta.valor;
    }
    
    const tipoClass = `tipo-${conta.tipo}`;
    const tipoTexto = conta.tipo === 'agua' ? '√Ågua' : 
                     conta.tipo === 'luz' ? 'Luz' : 
                     conta.tipo === 'figurino' ? 'Figurino' : 
                     conta.tipo === 'aluguel' ? 'Aluguel' : 'Outros';
    
    html += `
      <tr>
        <td><strong>${conta.fornecedor}</strong></td>
        <td><span class="tipo-fornecedor ${tipoClass}">${tipoTexto}</span></td>
        <td>${conta.descricao}</td>
        <td>${formatarData(conta.vencimento)}</td>
        <td style="font-weight: bold;">${formatarMoeda(conta.valor)}</td>
        <td>${conta.formaPagamento}</td>
        <td><span class="status-badge status-${conta.status}">${conta.status === 'pago' ? 'Pago' : 'Pendente'}</span></td>
        <td>${conta.dataPagamento ? formatarData(conta.dataPagamento) : 'N/A'}</td>
        <td>${conta.comprovante ? 'üìé' : 'N/A'}</td>
        <td>
          <button class="btn-small" onclick="pagarContaFornecedor('${conta.id}')" ${conta.status === 'pago' ? 'disabled' : ''}>
            üí≥ Pagar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
  document.getElementById('totalPagarFornecedores').textContent = formatarMoeda(total);
}

// ==================== CONTAS A PAGAR - FUNCIONARIOS ====================

function carregarContasPagarFuncionarios() {
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  const mes = parseInt(document.getElementById('filtroMesFuncionarios').value);
  const ano = parseInt(document.getElementById('filtroAnoFuncionarios').value);
  
  // Configurar anos no filtro
  const anoSelect = document.getElementById('filtroAnoFuncionarios');
  const anoAtual = new Date().getFullYear();
  anoSelect.innerHTML = '';
  
  for (let y = anoAtual - 1; y <= anoAtual + 1; y++) {
    const option = document.createElement('option');
    option.value = y;
    option.textContent = y;
    if (y === anoAtual) option.selected = true;
    anoSelect.appendChild(option);
  }
  
  let contasFuncionarios = JSON.parse(localStorage.getItem('contasPagarFuncionarios') || '[]');
  
  // Filtrar contas do m√™s/ano selecionado
  const contasMes = contasFuncionarios.filter(conta => {
    const data = new Date(conta.mesAno);
    return data.getMonth() + 1 === mes && data.getFullYear() === ano;
  });
  
  // Se n√£o existir contas para este m√™s, gerar novas
  if (contasMes.length === 0 && funcionarios.length > 0) {
    contasMes = funcionarios.map(funcionario => {
      // Valores exemplo (ajustar conforme sua l√≥gica)
      const salarioBase = 2500.00;
      const comissoes = Math.random() * 500; // Valor aleat√≥rio para exemplo
      const descontos = Math.random() * 200; // Valor aleat√≥rio para exemplo
      const valorLiquido = salarioBase + comissoes - descontos;
      
      const formasPagamento = ['PIX', 'Transfer√™ncia', 'Dinheiro'];
      const formaPagamento = formasPagamento[Math.floor(Math.random() * formasPagamento.length)];
      
      return {
        id: `func-${funcionario.id}-${mes}-${ano}`,
        funcionarioId: funcionario.id,
        nome: funcionario.nome || funcionario.nome_funcionarios,
        cargo: 'Funcion√°rio',
        salarioBase: salarioBase,
        comissoes: parseFloat(comissoes.toFixed(2)),
        descontos: parseFloat(descontos.toFixed(2)),
        valorLiquido: parseFloat(valorLiquido.toFixed(2)),
        formaPagamento: formaPagamento,
        status: 'pendente',
        dataPagamento: null,
        mesAno: `${ano}-${mes.toString().padStart(2, '0')}-01`,
        criadoEm: new Date().toISOString()
      };
    });
    
    // Adicionar ao array principal e salvar
    contasFuncionarios = contasFuncionarios.concat(contasMes);
    localStorage.setItem('contasPagarFuncionarios', JSON.stringify(contasFuncionarios));
  }
  
  atualizarTabelaContasPagarFuncionarios(contasMes);
}

function atualizarTabelaContasPagarFuncionarios(contas) {
  const tabela = document.getElementById('tabelaContasPagarFuncionarios');
  let html = '';
  let totalPagar = 0;
  let totalPago = 0;
  let totalDescontos = 0;
  
  contas.forEach(conta => {
    totalPagar += conta.valorLiquido;
    totalDescontos += conta.descontos;
    
    if (conta.status === 'pago') {
      totalPago += conta.valorLiquido;
    }
    
    html += `
      <tr>
        <td><strong>${conta.nome}</strong></td>
        <td>${conta.cargo}</td>
        <td>${formatarMoeda(conta.salarioBase)}</td>
        <td>${formatarMoeda(conta.comissoes)}</td>
        <td style="color: #dc3545;">${formatarMoeda(conta.descontos)}</td>
        <td style="font-weight: bold;">${formatarMoeda(conta.valorLiquido)}</td>
        <td>${conta.formaPagamento}</td>
        <td><span class="status-badge status-${conta.status}">${conta.status === 'pago' ? 'Pago' : 'Pendente'}</span></td>
        <td>${conta.dataPagamento ? formatarData(conta.dataPagamento) : 'N/A'}</td>
        <td>${conta.comprovante ? 'üìé' : 'N/A'}</td>
        <td>
          <button class="btn-small" onclick="pagarFuncionario('${conta.id}')" ${conta.status === 'pago' ? 'disabled style="opacity:0.5;"' : ''}>
            üí≥ Pagar
          </button>
          <button class="btn-small" onclick="emitirComprovante('${conta.id}')">
            üßæ Comprovante
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
  document.getElementById('totalPagarFuncionarios').textContent = formatarMoeda(totalPagar);
  document.getElementById('totalPagoFuncionarios').textContent = formatarMoeda(totalPago);
  document.getElementById('totalDescontosFuncionarios').textContent = formatarMoeda(totalDescontos);
}

// ==================== FUN√á√ïES DE PAGAMENTO ====================

function pagarContaElenco(contaId) {
  const contas = JSON.parse(localStorage.getItem('contasPagarElenco') || '[]');
  const contaIndex = contas.findIndex(c => c.id === contaId);
  
  if (contaIndex !== -1) {
    contas[contaIndex].status = 'pago';
    contas[contaIndex].dataPagamento = new Date().toISOString().split('T')[0];
    contas[contaIndex].formaPagamento = prompt('Forma de pagamento:', contas[contaIndex].formaPagamento) || contas[contaIndex].formaPagamento;
    
    localStorage.setItem('contasPagarElenco', JSON.stringify(contas));
    alert('Pagamento registrado com sucesso!');
    filtrarContasPagarElenco();
  }
}

function pagarContaMotorista(contaId) {
  const contas = JSON.parse(localStorage.getItem('contasPagarMotoristas') || '[]');
  const contaIndex = contas.findIndex(c => c.id === contaId);
  
  if (contaIndex !== -1) {
    contas[contaIndex].status = 'pago';
    contas[contaIndex].dataPagamento = new Date().toISOString().split('T')[0];
    localStorage.setItem('contasPagarMotoristas', JSON.stringify(contas));
    alert('Pagamento ao motorista registrado!');
    filtrarContasPagarMotoristas();
  }
}

function pagarContaProducao(contaId) {
  const contas = JSON.parse(localStorage.getItem('contasPagarProducao') || '[]');
  const contaIndex = contas.findIndex(c => c.id === contaId);
  
  if (contaIndex !== -1) {
    contas[contaIndex].status = 'pago';
    contas[contaIndex].dataPagamento = new Date().toISOString().split('T')[0];
    localStorage.setItem('contasPagarProducao', JSON.stringify(contas));
    alert('Pagamento √† produ√ß√£o registrado!');
    filtrarContasPagarProducao();
  }
}

function pagarContaFornecedor(contaId) {
  const contas = JSON.parse(localStorage.getItem('contasFornecedores') || '[]');
  const contaIndex = contas.findIndex(c => c.id === contaId);
  
  if (contaIndex !== -1) {
    contas[contaIndex].status = 'pago';
    contas[contaIndex].dataPagamento = new Date().toISOString().split('T')[0];
    localStorage.setItem('contasFornecedores', JSON.stringify(contas));
    alert('Conta do fornecedor paga!');
    filtrarContasFornecedores();
  }
}

function pagarFuncionario(contaId) {
  const contas = JSON.parse(localStorage.getItem('contasPagarFuncionarios') || '[]');
  const contaIndex = contas.findIndex(c => c.id === contaId);
  
  if (contaIndex !== -1) {
    contas[contaIndex].status = 'pago';
    contas[contaIndex].dataPagamento = new Date().toISOString().split('T')[0];
    localStorage.setItem('contasPagarFuncionarios', JSON.stringify(contas));
    alert('Pagamento ao funcion√°rio registrado!');
    carregarContasPagarFuncionarios();
  }
}

function pagarTodosFuncionarios() {
  if (confirm('Deseja registrar o pagamento de TODOS os funcion√°rios deste m√™s?')) {
    const mes = parseInt(document.getElementById('filtroMesFuncionarios').value);
    const ano = parseInt(document.getElementById('filtroAnoFuncionarios').value);
    
    let contas = JSON.parse(localStorage.getItem('contasPagarFuncionarios') || '[]');
    
    contas = contas.map(conta => {
      const data = new Date(conta.mesAno);
      if (data.getMonth() + 1 === mes && data.getFullYear() === ano) {
        return {
          ...conta,
          status: 'pago',
          dataPagamento: new Date().toISOString().split('T')[0]
        };
      }
      return conta;
    });
    
    localStorage.setItem('contasPagarFuncionarios', JSON.stringify(contas));
    alert('Pagamentos registrados para todos os funcion√°rios!');
    carregarContasPagarFuncionarios();
  }
}

// ==================== INICIALIZA√á√ÉO ====================

document.addEventListener('DOMContentLoaded', function() {
  // Carregar dados quando a p√°gina for aberta
  if (document.getElementById('contas_pagar_elenco')) {
    carregarContasPagarElenco();
  }
  
  if (document.getElementById('contas_pagar_motoristas')) {
    carregarContasPagarMotoristas();
  }
  
  if (document.getElementById('contas_pagar_producao')) {
    carregarContasPagarProducao();
  }
  
  if (document.getElementById('contas_pagar_fornecedores')) {
    carregarContasFornecedores();
  }
  
  if (document.getElementById('contas_pagar_funcionarios')) {
    carregarContasPagarFuncionarios();
  }
});
// ==================== FUN√á√ïES PARA DISPONIBILIDADE DE PERSONAGENS ====================

// Vari√°vel global para armazenar os hor√°rios do dia
const HORARIOS_DIA = [];
for (let hora = 8; hora <= 22; hora++) {
  for (let minuto = 0; minuto < 60; minuto += 30) {
    const horaFormatada = `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;
    HORARIOS_DIA.push(horaFormatada);
  }
}

// Fun√ß√£o principal para carregar disponibilidade
function carregarDisponibilidade() {
  const dataSelecionada = document.getElementById('filtroDataDisponibilidade').value;
  const personagemSelecionado = document.getElementById('filtroPersonagemDisponibilidade').value;
  const horaInicio = document.getElementById('filtroHoraInicio').value;
  const horaFim = document.getElementById('filtroHoraFim').value;
  
  // Carregar personagens
  const personagens = JSON.parse(localStorage.getItem('personagens') || '[]');
  
  // Carregar eventos
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Atualizar filtro de personagens
  atualizarFiltroPersonagens(personagens);
  
  // Filtrar eventos da data selecionada
  const eventosDoDia = eventos.filter(evento => evento.data === dataSelecionada);
  
  // Contadores para o resumo
  let totalDisponivel = 0;
  let totalParcial = 0;
  let totalIndisponivel = 0;
  
  let html = '';
  
  // Para cada personagem, verificar disponibilidade
  personagens.forEach(personagem => {
    // Aplicar filtro de personagem
    if (personagemSelecionado !== 'todos' && personagem.id !== personagemSelecionado) {
      return;
    }
    
    // Encontrar eventos que usam este personagem
    const eventosDoPersonagem = eventosDoDia.filter(evento => {
      if (evento.personagens && Array.isArray(evento.personagens)) {
        return evento.personagens.some(p => p.id === personagem.id || p.nome === personagem.nome_personagens);
      }
      return false;
    });
    
    // Calcular quantidade de reservas
    const quantidadeReservas = eventosDoPersonagem.length;
    const quantidadeMaxima = 3; // M√°ximo de 3 reservas por dia
    const quantidadeDisponivel = personagem.quantidade || 1;
    
    // Analisar hor√°rios ocupados
    const horariosOcupados = [];
    eventosDoPersonagem.forEach(evento => {
      if (evento.hora_evento && evento.hora_saida) {
        const inicio = evento.hora_evento;
        const fim = evento.hora_saida;
        horariosOcupados.push({ inicio, fim, eventoId: evento.id });
      }
    });
    
    // Determinar status
    let status = 'disponivel';
    let statusText = 'Dispon√≠vel';
    let statusClass = 'status-disponivel';
    let proximaDisponibilidade = 'Imediata';
    
    if (quantidadeReservas >= quantidadeMaxima) {
      status = 'indisponivel';
      statusText = 'Indispon√≠vel';
      statusClass = 'status-indisponivel';
      totalIndisponivel++;
      
      // Calcular pr√≥xima disponibilidade baseada no √∫ltimo evento
      if (horariosOcupados.length > 0) {
        const ultimoEvento = horariosOcupados.reduce((prev, current) => {
          return (prev.fim > current.fim) ? prev : current;
        });
        
        // Adicionar 3 horas ao hor√°rio de sa√≠da
        const [hora, minuto] = ultimoEvento.fim.split(':').map(Number);
        const proximaHora = hora + 3;
        proximaDisponibilidade = `${proximaHora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;
      }
    } else if (quantidadeReservas > 0) {
      status = 'parcial';
      statusText = 'Parcialmente Dispon√≠vel';
      statusClass = 'status-parcial';
      totalParcial++;
      
      // Verificar se h√° hor√°rios livres
      if (horaInicio && horaFim) {
        // Verificar disponibilidade no hor√°rio espec√≠fico
        const disponivelNoHorario = verificarDisponibilidadeHorario(
          horaInicio, 
          horaFim, 
          horariosOcupados
        );
        
        if (!disponivelNoHorario) {
          statusText = 'Indispon√≠vel neste hor√°rio';
          statusClass = 'status-indisponivel';
        }
      }
    } else {
      totalDisponivel++;
    }
    
    // Formatar hor√°rios reservados para exibi√ß√£o
    let horariosReservadosHTML = '';
    if (horariosOcupados.length > 0) {
      horariosOcupados.forEach(horario => {
        horariosReservadosHTML += `
          <div class="reserva-horario horario-ocupado">
            ${horario.inicio} - ${horario.fim}
          </div>
        `;
      });
    } else {
      horariosReservadosHTML = '<span style="color: #28a745;">Nenhuma reserva</span>';
    }
    
    // Gerar linha da tabela
    html += `
      <tr>
        <td><strong>${personagem.nome_personagens || 'N/A'}</strong></td>
        <td>${personagem.figurino || 'N/A'}</td>
        <td>${personagem.tema || 'N/A'}</td>
        <td>${quantidadeDisponivel}</td>
        <td>${quantidadeReservas} / ${quantidadeMaxima}</td>
        <td>${horariosReservadosHTML}</td>
        <td>${proximaDisponibilidade}</td>
        <td><span class="${statusClass}">${statusText}</span></td>
        <td>
          <button class="btn-small" onclick="verDetalhesDisponibilidade('${personagem.id}', '${dataSelecionada}')">
            üëÅÔ∏è Detalhes
          </button>
          <button class="btn-small" onclick="verificarHorarioEspecifico('${personagem.id}', '${dataSelecionada}')">
            ‚è∞ Verificar Hor√°rio
          </button>
        </td>
      </tr>
    `;
  });
  
  // Atualizar tabela
  document.getElementById('tabelaDisponibilidade').innerHTML = html;
  
  // Atualizar contadores
  document.getElementById('totalDisponivel').textContent = totalDisponivel;
  document.getElementById('totalParcial').textContent = totalParcial;
  document.getElementById('totalIndisponivel').textContent = totalIndisponivel;
}

// Verificar disponibilidade em um hor√°rio espec√≠fico
function verificarDisponibilidadeHorario(horaInicio, horaFim, horariosOcupados) {
  // Converter hor√°rios para minutos para facilitar compara√ß√£o
  const inicioMinutos = converterParaMinutos(horaInicio);
  const fimMinutos = converterParaMinutos(horaFim);
  
  // Verificar cada hor√°rio ocupado
  for (const horario of horariosOcupados) {
    const ocupadoInicio = converterParaMinutos(horario.inicio);
    const ocupadoFim = converterParaMinutos(horario.fim);
    
    // Verificar se h√° sobreposi√ß√£o
    if (inicioMinutos < ocupadoFim && fimMinutos > ocupadoInicio) {
      return false; // H√° conflito
    }
    
    // Verificar se h√° menos de 3 horas entre eventos
    const intervaloAnterior = inicioMinutos - ocupadoFim;
    const intervaloSeguinte = ocupadoInicio - fimMinutos;
    
    // Se o novo evento come√ßar dentro de 3 horas ap√≥s um evento existente
    if (intervaloAnterior > 0 && intervaloAnterior < 180) { // 180 minutos = 3 horas
      return false;
    }
    
    // Se um evento existente come√ßar dentro de 3 horas ap√≥s o novo evento
    if (intervaloSeguinte > 0 && intervaloSeguinte < 180) {
      return false;
    }
  }
  
  return true; // Dispon√≠vel
}

// Fun√ß√£o auxiliar para converter hor√°rio para minutos
function converterParaMinutos(horario) {
  const [horas, minutos] = horario.split(':').map(Number);
  return horas * 60 + minutos;
}

// Fun√ß√£o para converter minutos para hor√°rio
function converterParaHorario(minutos) {
  const horas = Math.floor(minutos / 60);
  const mins = minutos % 60;
  return `${horas.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
}

// Atualizar filtro de personagens
function atualizarFiltroPersonagens(personagens) {
  const select = document.getElementById('filtroPersonagemDisponibilidade');
  
  // Verificar se j√° tem op√ß√µes al√©m do "todos"
  if (select.options.length <= 1) {
    let options = '<option value="todos">Todos os personagens</option>';
    personagens.forEach(personagem => {
      options += `<option value="${personagem.id}">${personagem.nome_personagens || 'Personagem sem nome'}</option>`;
    });
    select.innerHTML = options;
  }
}

// Resetar filtros
function resetarFiltrosDisponibilidade() {
  document.getElementById('filtroDataDisponibilidade').value = new Date().toISOString().split('T')[0];
  document.getElementById('filtroPersonagemDisponibilidade').value = 'todos';
  document.getElementById('filtroHoraInicio').value = '';
  document.getElementById('filtroHoraFim').value = '';
  carregarDisponibilidade();
}

// Ver detalhes da disponibilidade
function verDetalhesDisponibilidade(personagemId, data) {
  const personagens = JSON.parse(localStorage.getItem('personagens') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  const personagem = personagens.find(p => p.id === personagemId);
  const eventosDoDia = eventos.filter(evento => evento.data === data);
  
  const eventosDoPersonagem = eventosDoDia.filter(evento => {
    if (evento.personagens && Array.isArray(evento.personagens)) {
      return evento.personagens.some(p => p.id === personagemId || p.nome === personagem.nome_personagens);
    }
    return false;
  });
  
  // Calcular hor√°rios ocupados
  const horariosOcupados = eventosDoPersonagem.map(evento => ({
    inicio: evento.hora_evento,
    fim: evento.hora_saida,
    eventoId: evento.id,
    cliente: evento.cliente
  }));
  
  // Calcular hor√°rios livres
  const horariosLivres = calcularHorariosLivres(horariosOcupados);
  
  // Exibir modal com detalhes
  document.getElementById('detalhesPersonagem').innerHTML = `
    <div style="background: #e8f4fd; padding: 1rem; border-radius: 8px;">
      <h4>${personagem.nome_personagens || 'Personagem'}</h4>
      <p><strong>Figurino:</strong> ${personagem.figurino || 'N/A'}</p>
      <p><strong>Tema:</strong> ${personagem.tema || 'N/A'}</p>
      <p><strong>Quantidade Dispon√≠vel:</strong> ${personagem.quantidade || 1}</p>
      <p><strong>Reservas no dia ${formatarData(data)}:</strong> ${eventosDoPersonagem.length} / 3</p>
    </div>
  `;
  
  // Exibir reservas do dia
  let reservasHTML = '<h5>üìÖ Reservas Agendadas:</h5>';
  if (horariosOcupados.length > 0) {
    reservasHTML += '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">';
    horariosOcupados.forEach(reserva => {
      reservasHTML += `
        <div style="background: #f8d7da; padding: 0.75rem; border-radius: 8px; flex: 1; min-width: 200px;">
          <p><strong>Hor√°rio:</strong> ${reserva.inicio} - ${reserva.fim}</p>
          <p><strong>Cliente:</strong> ${reserva.cliente || 'N/A'}</p>
          <p><strong>Dura√ß√£o:</strong> ${calcularDuracao(reserva.inicio, reserva.fim)}</p>
        </div>
      `;
    });
    reservasHTML += '</div>';
  } else {
    reservasHTML += '<p style="color: #28a745;">‚úÖ Nenhuma reserva agendada para este dia</p>';
  }
  
  document.getElementById('reservasDoDia').innerHTML = reservasHTML;
  
  // Exibir c√°lculo de disponibilidade
  let calculoHTML = '<h5>‚è∞ Hor√°rios Livres para Reserva:</h5>';
  
  if (horariosLivres.length > 0) {
    calculoHTML += `
      <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
        <p>Este personagem pode ser reservado nos seguintes hor√°rios (m√≠nimo 3 horas entre eventos):</p>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem;">
    `;
    
    horariosLivres.forEach(intervalo => {
      calculoHTML += `
        <div class="reserva-horario horario-livre">
          ${intervalo.inicio} - ${intervalo.fim}
        </div>
      `;
    });
    
    calculoHTML += '</div></div>';
    
    // Adicionar c√°lculo de pr√≥xima reserva dispon√≠vel
    if (horariosOcupados.length > 0) {
      const ultimaReserva = horariosOcupados.reduce((prev, current) => 
        converterParaMinutos(current.fim) > converterParaMinutos(prev.fim) ? current : prev
      );
      
      const horaSaidaUltima = converterParaMinutos(ultimaReserva.fim);
      const proximaDisponivel = horaSaidaUltima + 180; // +3 horas
      
      calculoHTML += `
        <div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-radius: 8px;">
          <p><strong>Pr√≥xima disponibilidade ap√≥s a √∫ltima reserva:</strong></p>
          <p>√öltima reserva termina √†s: ${ultimaReserva.fim}</p>
          <p>Pr√≥xima reserva pode iniciar a partir das: <strong>${converterParaHorario(proximaDisponivel)}</strong></p>
        </div>
      `;
    }
  } else {
    calculoHTML += '<p style="color: #dc3545;">‚ùå Este personagem n√£o est√° dispon√≠vel para novos hor√°rios hoje</p>';
  }
  
  document.getElementById('calculoDisponibilidade').innerHTML = calculoHTML;
  
  // Mostrar modal
  document.getElementById('modalDetalhesDisponibilidade').style.display = 'block';
}

// Calcular hor√°rios livres baseados nas reservas existentes
function calcularHorariosLivres(horariosOcupados) {
  const horariosLivres = [];
  
  // Definir hor√°rio de trabalho (8h √†s 22h)
  const horaInicioTrabalho = converterParaMinutos('08:00');
  const horaFimTrabalho = converterParaMinutos('22:00');
  
  // Ordenar hor√°rios ocupados por in√≠cio
  horariosOcupados.sort((a, b) => converterParaMinutos(a.inicio) - converterParaMinutos(b.inicio));
  
  let horaAtual = horaInicioTrabalho;
  
  for (const reserva of horariosOcupados) {
    const inicioReserva = converterParaMinutos(reserva.inicio);
    const fimReserva = converterParaMinutos(reserva.fim);
    
    // Se houver espa√ßo antes da reserva (m√≠nimo 1 hora para novo evento)
    if (inicioReserva - horaAtual >= 60) {
      horariosLivres.push({
        inicio: converterParaHorario(horaAtual),
        fim: converterParaHorario(inicioReserva)
      });
    }
    
    // Atualizar hora atual para 3 horas ap√≥s o fim da reserva
    horaAtual = fimReserva + 180; // +3 horas
  }
  
  // Verificar espa√ßo ap√≥s a √∫ltima reserva
  if (horaFimTrabalho - horaAtual >= 60) {
    horariosLivres.push({
      inicio: converterParaHorario(horaAtual),
      fim: converterParaHorario(horaFimTrabalho)
    });
  }
  
  return horariosLivres;
}

// Calcular dura√ß√£o entre dois hor√°rios
function calcularDuracao(inicio, fim) {
  const inicioMin = converterParaMinutos(inicio);
  const fimMin = converterParaMinutos(fim);
  const duracaoMin = fimMin - inicioMin;
  
  const horas = Math.floor(duracaoMin / 60);
  const minutos = duracaoMin % 60;
  
  if (horas > 0) {
    return `${horas}h ${minutos}min`;
  }
  return `${minutos}min`;
}

// Verificar hor√°rio espec√≠fico
function verificarHorarioEspecifico(personagemId, data) {
  const horaInicio = prompt('Hor√°rio de in√≠cio desejado (HH:MM):');
  if (!horaInicio || !/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(horaInicio)) {
    alert('Hor√°rio inv√°lido!');
    return;
  }
  
  const duracao = prompt('Dura√ß√£o do evento (em horas):', '1');
  const duracaoHoras = parseInt(duracao);
  
  if (isNaN(duracaoHoras) || duracaoHoras < 1 || duracaoHoras > 8) {
    alert('Dura√ß√£o inv√°lida! Use entre 1 e 8 horas.');
    return;
  }
  
  // Calcular hor√°rio de fim
  const inicioMinutos = converterParaMinutos(horaInicio);
  const fimMinutos = inicioMinutos + (duracaoHoras * 60);
  const horaFim = converterParaHorario(fimMinutos);
  
  // Verificar disponibilidade
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const eventosDoDia = eventos.filter(evento => evento.data === data);
  
  const eventosDoPersonagem = eventosDoDia.filter(evento => {
    if (evento.personagens && Array.isArray(evento.personagens)) {
      return evento.personagens.some(p => p.id === personagemId);
    }
    return false;
  });
  
  const horariosOcupados = eventosDoPersonagem.map(evento => ({
    inicio: evento.hora_evento,
    fim: evento.hora_saida
  }));
  
  const disponivel = verificarDisponibilidadeHorario(horaInicio, horaFim, horariosOcupados);
  
  if (disponivel) {
    alert(`‚úÖ O personagem est√° DISPON√çVEL das ${horaInicio} √†s ${horaFim} (${duracaoHoras}h)\n\nPode ser reservado!`);
  } else {
    alert(`‚ùå O personagem N√ÉO est√° dispon√≠vel das ${horaInicio} √†s ${horaFim}\n\nConflito com reservas existentes ou menos de 3 horas entre eventos.`);
  }
}

// Fechar modal
function fecharModalDisponibilidade() {
  document.getElementById('modalDetalhesDisponibilidade').style.display = 'none';
}

// Exportar disponibilidade
function exportarDisponibilidade() {
  const data = document.getElementById('filtroDataDisponibilidade').value;
  const dataFormatada = formatarData(data);
  
  let csv = 'Personagem;Figurino;Tema;Quantidade Total;Reservas;Status;Pr√≥xima Disponibilidade\n';
  
  const rows = document.querySelectorAll('#tabelaDisponibilidade tr');
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length > 0) {
      const linha = [
        cells[0].innerText,
        cells[1].innerText,
        cells[2].innerText,
        cells[3].innerText,
        cells[4].innerText,
        cells[7].querySelector('span')?.innerText || '',
        cells[6].innerText
      ].join(';');
      csv += linha + '\n';
    }
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `disponibilidade_personagens_${dataFormatada.replace(/\//g, '-')}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

// Carregar disponibilidade quando a p√°gina for aberta
document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('lista_disponibilidade_personagens')) {
    // Configurar data atual
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('filtroDataDisponibilidade').value = hoje;
    
    // Carregar disponibilidade
    carregarDisponibilidade();
    
    // Fechar modal ao clicar fora
    window.onclick = function(event) {
      const modal = document.getElementById('modalDetalhesDisponibilidade');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    };
  }
});

// Fun√ß√£o auxiliar para formatar data
function formatarData(dataString) {
  if (!dataString) return 'N/A';
  const [ano, mes, dia] = dataString.split('-');
  return `${dia}/${mes}/${ano}`;
}
// ==================== FUN√á√ïES PARA RELAT√ìRIOS DE EVENTOS ====================

// Vari√°veis globais
let eventosRelatorios = [];
let relatorioAtual = 'finalizados';

// Carregar relat√≥rio espec√≠fico
function carregarRelatorio(tipo) {
  relatorioAtual = tipo;
  
  // Ocultar todos os relat√≥rios
  document.querySelectorAll('.page').forEach(page => {
    if (page.id.includes('relatorios_eventos')) {
      page.style.display = 'none';
    }
  });
  
  // Mostrar relat√≥rio selecionado
  const relatorioDiv = document.getElementById(`relatorios_eventos_${tipo}`);
  if (relatorioDiv) {
    relatorioDiv.style.display = 'block';
    
    // Carregar dados do relat√≥rio
    switch(tipo) {
      case 'realizados':
        carregarEventosRealizados();
        break;
      case 'cancelados':
        carregarEventosCancelados();
        break;
      case 'finalizados':
        carregarEventosFinalizados();
        break;
    }
  }
}

// ==================== EVENTOS REALIZADOS ====================

function carregarEventosRealizados() {
  eventosRelatorios = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Filtrar apenas eventos realizados (data passada e status 'realizado' ou 'finalizado')
  const hoje = new Date().toISOString().split('T')[0];
  const eventosRealizados = eventosRelatorios.filter(evento => {
    // Verificar se o evento j√° aconteceu (data passada)
    const eventoData = new Date(evento.data);
    const hojeObj = new Date();
    
    // Marcar como realizado se a data j√° passou
    const jaAconteceu = eventoData < hojeObj;
    
    // Ou se tem status 'realizado' ou 'finalizado'
    const statusRealizado = evento.status === 'realizado' || evento.status === 'finalizado';
    
    return jaAconteceu || statusRealizado;
  });
  
  // Atualizar filtro de clientes
  atualizarFiltroClientesRealizados(eventosRealizados);
  
  // Filtrar eventos
  filtrarEventosRealizados();
}

function filtrarEventosRealizados() {
  const periodo = document.getElementById('periodoRealizados').value;
  const statusPagamento = document.getElementById('statusPagamentoRealizados').value;
  const cliente = document.getElementById('clienteRealizados').value;
  const dataInicio = document.getElementById('dataInicioRealizados').value;
  const dataFim = document.getElementById('dataFimRealizados').value;
  
  // Mostrar/ocultar datas personalizadas
  const inicioDiv = document.getElementById('dataInicioRealizadosDiv');
  const fimDiv = document.getElementById('dataFimRealizadosDiv');
  
  if (periodo === 'personalizado') {
    inicioDiv.style.display = 'block';
    fimDiv.style.display = 'block';
  } else {
    inicioDiv.style.display = 'none';
    fimDiv.style.display = 'none';
  }
  
  // Filtrar eventos
  const eventosRealizados = eventosRelatorios.filter(evento => {
    const eventoData = new Date(evento.data);
    const hojeObj = new Date();
    const jaAconteceu = eventoData < hojeObj;
    const statusRealizado = evento.status === 'realizado' || evento.status === 'finalizado';
    
    // Aplicar filtros
    if (!jaAconteceu && !statusRealizado) return false;
    
    // Filtrar por per√≠odo
    if (periodo !== 'todos' && periodo !== 'personalizado') {
      const inicioPeriodo = calcularInicioPeriodo(periodo);
      if (eventoData < inicioPeriodo) return false;
    }
    
    // Filtrar por datas personalizadas
    if (periodo === 'personalizado' && dataInicio && dataFim) {
      const dataEvento = new Date(evento.data);
      const inicio = new Date(dataInicio);
      const fim = new Date(dataFim);
      
      if (dataEvento < inicio || dataEvento > fim) return false;
    }
    
    // Filtrar por status de pagamento
    if (statusPagamento !== 'todos') {
      const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
      const valorPago = calcularValorPago(evento);
      
      if (statusPagamento === 'total' && valorPago < valorTotal) return false;
      if (statusPagamento === 'parcial' && (valorPago === 0 || valorPago >= valorTotal)) return false;
      if (statusPagamento === 'pendente' && valorPago > 0) return false;
    }
    
    // Filtrar por cliente
    if (cliente !== 'todos' && evento.cliente !== cliente) return false;
    
    return true;
  });
  
  // Calcular totais
  calcularTotaisRealizados(eventosRealizados);
  
  // Atualizar tabela
  atualizarTabelaRealizados(eventosRealizados);
}

function calcularTotaisRealizados(eventos) {
  let totalEventos = 0;
  let valorTotal = 0;
  let totalPago = 0;
  
  eventos.forEach(evento => {
    totalEventos++;
    valorTotal += parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    totalPago += calcularValorPago(evento);
  });
  
  const media = totalEventos > 0 ? valorTotal / totalEventos : 0;
  
  document.getElementById('totalEventosRealizados').textContent = totalEventos;
  document.getElementById('valorTotalRealizados').textContent = formatarMoeda(valorTotal);
  document.getElementById('mediaRealizados').textContent = formatarMoeda(media);
}

function atualizarTabelaRealizados(eventos) {
  const tabela = document.getElementById('tabelaEventosRealizados');
  let html = '';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    const pendente = valorTotal - valorPago;
    
    // Determinar status de pagamento
    let statusPagamento = 'pendente';
    let statusBadge = 'badge-pendente';
    
    if (valorPago >= valorTotal) {
      statusPagamento = 'pago';
      statusBadge = 'badge-pago';
    } else if (valorPago > 0) {
      statusPagamento = 'parcial';
      statusBadge = 'badge-parcial';
    }
    
    // Formatar personagens
    let personagensHTML = '';
    if (evento.personagens && Array.isArray(evento.personagens)) {
      personagensHTML = evento.personagens.map(p => p.nome || p).join(', ');
    }
    
    html += `
      <tr class="status-realizado">
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td><strong>${evento.cliente || 'N/A'}</strong></td>
        <td>${evento.local || 'N/A'}</td>
        <td>${personagensHTML}</td>
        <td style="font-weight: bold;">${formatarMoeda(valorTotal)}</td>
        <td>${formatarMoeda(valorPago)}</td>
        <td><span class="status-badge ${statusBadge}">${statusPagamento.toUpperCase()}</span></td>
        <td>${evento.observacoes || ''}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
}

function resetarFiltrosRealizados() {
  document.getElementById('periodoRealizados').value = 'todos';
  document.getElementById('statusPagamentoRealizados').value = 'todos';
  document.getElementById('clienteRealizados').value = 'todos';
  document.getElementById('dataInicioRealizados').value = '';
  document.getElementById('dataFimRealizados').value = '';
  filtrarEventosRealizados();
}

// ==================== EVENTOS CANCELADOS ====================

function carregarEventosCancelados() {
  eventosRelatorios = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Filtrar apenas eventos cancelados
  const eventosCancelados = eventosRelatorios.filter(evento => 
    evento.status === 'cancelado' || evento.cancelado === true
  );
  
  filtrarEventosCancelados();
}

function filtrarEventosCancelados() {
  const periodo = document.getElementById('periodoCancelados').value;
  const motivo = document.getElementById('motivoCancelados').value;
  const dataInicio = document.getElementById('dataInicioCancelados').value;
  const dataFim = document.getElementById('dataFimCancelados').value;
  
  // Mostrar/ocultar datas personalizadas
  const inicioDiv = document.getElementById('dataInicioCanceladosDiv');
  const fimDiv = document.getElementById('dataFimCanceladosDiv');
  
  if (periodo === 'personalizado') {
    inicioDiv.style.display = 'block';
    fimDiv.style.display = 'block';
  } else {
    inicioDiv.style.display = 'none';
    fimDiv.style.display = 'none';
  }
  
  // Filtrar eventos cancelados
  const eventosCancelados = eventosRelatorios.filter(evento => {
    if (!evento.status === 'cancelado' && !evento.cancelado) return false;
    
    // Filtrar por per√≠odo
    if (periodo !== 'todos' && periodo !== 'personalizado') {
      const inicioPeriodo = calcularInicioPeriodo(periodo);
      const dataEvento = new Date(evento.data_cancelamento || evento.data);
      if (dataEvento < inicioPeriodo) return false;
    }
    
    // Filtrar por datas personalizadas
    if (periodo === 'personalizado' && dataInicio && dataFim) {
      const dataEvento = new Date(evento.data_cancelamento || evento.data);
      const inicio = new Date(dataInicio);
      const fim = new Date(dataFim);
      
      if (dataEvento < inicio || dataEvento > fim) return false;
    }
    
    // Filtrar por motivo
    if (motivo !== 'todos' && evento.motivo_cancelamento !== motivo) {
      return false;
    }
    
    return true;
  });
  
  // Calcular totais
  calcularTotaisCancelados(eventosCancelados);
  
  // Atualizar tabela
  atualizarTabelaCancelados(eventosCancelados);
}

function calcularTotaisCancelados(eventos) {
  let totalEventos = 0;
  let valorPerdido = 0;
  let sinalDevolvido = 0;
  
  eventos.forEach(evento => {
    totalEventos++;
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const sinalPago = parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    
    valorPerdido += valorTotal;
    
    // Verificar se o sinal foi devolvido (50% √© devolvido por padr√£o)
    if (evento.sinal_devolvido === true) {
      sinalDevolvido += sinalPago * 0.5;
    }
  });
  
  document.getElementById('totalEventosCancelados').textContent = totalEventos;
  document.getElementById('valorPerdidoCancelados').textContent = formatarMoeda(valorPerdido);
  document.getElementById('sinalDevolvido').textContent = formatarMoeda(sinalDevolvido);
}

function atualizarTabelaCancelados(eventos) {
  const tabela = document.getElementById('tabelaEventosCancelados');
  let html = '';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const sinalPago = parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const sinalDevolvido = evento.sinal_devolvido === true ? sinalPago * 0.5 : 0;
    const motivo = evento.motivo_cancelamento || 'N√£o especificado';
    
    html += `
      <tr class="status-cancelado">
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td><strong>${evento.cliente || 'N/A'}</strong></td>
        <td>${evento.local || 'N/A'}</td>
        <td style="font-weight: bold;">${formatarMoeda(valorTotal)}</td>
        <td>${formatarMoeda(sinalPago)}</td>
        <td><span class="badge-cancelado">${traduzirMotivoCancelamento(motivo)}</span></td>
        <td>${formatarData(evento.data_cancelamento || evento.data)}</td>
        <td>${formatarMoeda(sinalDevolvido)}</td>
        <td>${evento.responsavel_cancelamento || 'Sistema'}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
}

function traduzirMotivoCancelamento(motivo) {
  const motivos = {
    'cliente': 'Cliente cancelou',
    'empresa': 'Empresa cancelou',
    'clima': 'Problemas clim√°ticos',
    'logistica': 'Problemas log√≠sticos',
    'outro': 'Outros'
  };
  
  return motivos[motivo] || motivo;
}

function resetarFiltrosCancelados() {
  document.getElementById('periodoCancelados').value = 'todos';
  document.getElementById('motivoCancelados').value = 'todos';
  document.getElementById('dataInicioCancelados').value = '';
  document.getElementById('dataFimCancelados').value = '';
  filtrarEventosCancelados();
}

// ==================== EVENTOS FINALIZADOS ====================

function carregarEventosFinalizados() {
  eventosRelatorios = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Filtrar eventos finalizados
  const eventosFinalizados = eventosRelatorios.filter(evento => 
    evento.status === 'finalizado'
  );
  
  filtrarEventosFinalizados();
}

function filtrarEventosFinalizados() {
  const periodo = document.getElementById('periodoFinalizados').value;
  const status = document.getElementById('statusFinalizados').value;
  const dataInicio = document.getElementById('dataInicioFinalizados').value;
  const dataFim = document.getElementById('dataFimFinalizados').value;
  
  // Mostrar/ocultar datas personalizadas
  const inicioDiv = document.getElementById('dataInicioFinalizadosDiv');
  const fimDiv = document.getElementById('dataFimFinalizadosDiv');
  
  if (periodo === 'personalizado') {
    inicioDiv.style.display = 'block';
    fimDiv.style.display = 'block';
  } else {
    inicioDiv.style.display = 'none';
    fimDiv.style.display = 'none';
  }
  
  // Filtrar eventos
  const eventosFiltrados = eventosRelatorios.filter(evento => {
    // Filtrar por status
    if (status !== 'todos' && evento.status !== status) {
      return false;
    }
    
    // Filtrar por per√≠odo
    if (periodo !== 'todos' && periodo !== 'personalizado') {
      const inicioPeriodo = calcularInicioPeriodo(periodo);
      const dataEvento = new Date(evento.data);
      if (dataEvento < inicioPeriodo) return false;
    }
    
    // Filtrar por datas personalizadas
    if (periodo === 'personalizado' && dataInicio && dataFim) {
      const dataEvento = new Date(evento.data);
      const inicio = new Date(dataInicio);
      const fim = new Date(dataFim);
      
      if (dataEvento < inicio || dataEvento > fim) return false;
    }
    
    return true;
  });
  
  // Atualizar totais
  atualizarTotaisFinalizados(eventosFiltrados);
  
  // Atualizar tabela
  atualizarTabelaFinalizados(eventosFiltrados);
}

function atualizarTotaisFinalizados(eventos) {
  let totalEventos = 0;
  let totalRealizados = 0;
  let totalCancelados = 0;
  let totalFinalizados = 0;
  let valorTotal = 0;
  
  eventos.forEach(evento => {
    totalEventos++;
    
    switch(evento.status) {
      case 'realizado':
        totalRealizados++;
        break;
      case 'cancelado':
        totalCancelados++;
        break;
      case 'finalizado':
        totalFinalizados++;
        break;
    }
    
    valorTotal += parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  });
  
  const totaisHTML = `
    <div class="card-mini" style="background: #e2e3e5;">
      <h4>Total de Eventos</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #383d41;">${totalEventos}</p>
    </div>
    <div class="card-mini" style="background: #d4edda;">
      <h4>Realizados</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #155724;">${totalRealizados}</p>
    </div>
    <div class="card-mini" style="background: #f8d7da;">
      <h4>Cancelados</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #721c24;">${totalCancelados}</p>
    </div>
    <div class="card-mini" style="background: #cce5ff;">
      <h4>Valor Total</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #004085;">${formatarMoeda(valorTotal)}</p>
    </div>
  `;
  
  document.getElementById('totaisFinalizados').innerHTML = totaisHTML;
}

function atualizarTabelaFinalizados(eventos) {
  const tabela = document.getElementById('tabelaEventosFinalizados');
  let html = '';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    const pendente = valorTotal - valorPago;
    
    // Determinar classe CSS baseada no status
    let statusClass = '';
    let statusBadge = '';
    
    switch(evento.status) {
      case 'realizado':
        statusClass = 'status-realizado';
        statusBadge = 'badge-realizado';
        break;
      case 'cancelado':
        statusClass = 'status-cancelado';
        statusBadge = 'badge-cancelado';
        break;
      case 'finalizado':
        statusClass = 'status-finalizado';
        statusBadge = 'badge-finalizado';
        break;
      default:
        statusClass = '';
        statusBadge = '';
    }
    
    // Status de pagamento
    let statusPagamento = 'pendente';
    let pagamentoBadge = 'badge-pendente';
    
    if (valorPago >= valorTotal) {
      statusPagamento = 'pago';
      pagamentoBadge = 'badge-pago';
    } else if (valorPago > 0) {
      statusPagamento = 'parcial';
      pagamentoBadge = 'badge-parcial';
    }
    
    html += `
      <tr class="${statusClass}">
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td><strong>${evento.cliente || 'N/A'}</strong></td>
        <td>${evento.local || 'N/A'}</td>
        <td><span class="status-badge ${statusBadge}">${evento.status?.toUpperCase() || 'N/A'}</span></td>
        <td style="font-weight: bold;">${formatarMoeda(valorTotal)}</td>
        <td>${formatarMoeda(valorPago)}</td>
        <td><span class="status-badge ${pagamentoBadge}">${formatarMoeda(pendente)}</span></td>
        <td>${evento.observacoes || ''}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
}

function resetarFiltrosFinalizados() {
  document.getElementById('periodoFinalizados').value = 'todos';
  document.getElementById('statusFinalizados').value = 'todos';
  document.getElementById('dataInicioFinalizados').value = '';
  document.getElementById('dataFimFinalizados').value = '';
  filtrarEventosFinalizados();
}

// ==================== FUN√á√ïES AUXILIARES ====================

function calcularInicioPeriodo(periodo) {
  const hoje = new Date();
  
  switch(periodo) {
    case 'hoje':
      return new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
    case 'semana':
      const inicioSemana = new Date(hoje);
      inicioSemana.setDate(hoje.getDate() - hoje.getDay());
      return inicioSemana;
    case 'mes':
      return new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    default:
      return new Date(0); // Data muito antiga
  }
}

function calcularValorPago(evento) {
  let valorPago = 0;
  
  // Verificar sinal pago
  if (evento.sinal_pago_status === 'true') {
    valorPago += parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  // Verificar valor avulso pago
  if (evento.valor_avulso_pago === 'true') {
    valorPago += parseFloat(evento.valor_avulso?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  // Verificar valor restante pago
  if (evento.valor_restante_recebido === 'true') {
    valorPago += parseFloat(evento.valor_falta_receber?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  return valorPago;
}

function formatarMoeda(valor) {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(valor);
}

function formatarData(dataString) {
  if (!dataString) return 'N/A';
  const [ano, mes, dia] = dataString.split('-');
  return `${dia}/${mes}/${ano}`;
}

function atualizarFiltroClientesRealizados(eventos) {
  const select = document.getElementById('clienteRealizados');
  const clientesUnicos = [...new Set(eventos.map(e => e.cliente))];
  
  let options = '<option value="todos">Todos os clientes</option>';
  clientesUnicos.forEach(cliente => {
    if (cliente) {
      options += `<option value="${cliente}">${cliente}</option>`;
    }
  });
  
  select.innerHTML = options;
}

// Fun√ß√µes de exporta√ß√£o
function exportarRelatorioRealizados() {
  exportarParaCSV('tabelaEventosRealizados', 'eventos_realizados');
}

function exportarRelatorioCancelados() {
  exportarParaCSV('tabelaEventosCancelados', 'eventos_cancelados');
}

function exportarRelatorioFinalizados() {
  exportarParaCSV('tabelaEventosFinalizados', 'eventos_finalizados');
}

function exportarParaCSV(tabelaId, nomeArquivo) {
  const table = document.getElementById(tabelaId);
  const rows = table.querySelectorAll('tr');
  
  let csv = [];
  
  // Cabe√ßalho
  const headers = [];
  table.querySelectorAll('th').forEach(th => {
    headers.push(th.innerText);
  });
  csv.push(headers.join(';'));
  
  // Dados
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length > 0) {
      const rowData = [];
      cells.forEach(cell => {
        // Remover HTML dos badges
        let text = cell.innerText;
        rowData.push(text);
      });
      csv.push(rowData.join(';'));
    }
  });
  
  const csvContent = csv.join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${nomeArquivo}_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

// ==================== FUN√á√ïES PARA RELAT√ìRIOS DE EVENTOS (P√ÅGINA √öNICA) ====================

// Vari√°veis globais
let eventosRelatorios = [];

// Fun√ß√£o para alternar entre as abas
function abrirTabEvento(tabName) {
  // Remover classe active de todos os bot√µes
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Remover classe active de todos os conte√∫dos
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
    content.style.display = 'none';
  });
  
  // Adicionar classe active ao bot√£o clicado
  const btnClicado = document.querySelector(`[onclick="abrirTabEvento('${tabName}')"]`);
  if (btnClicado) {
    btnClicado.classList.add('active');
  }
  
  // Mostrar conte√∫do da aba clicada
  const tabContent = document.getElementById(`tab-${tabName}`);
  if (tabContent) {
    tabContent.classList.add('active');
    tabContent.style.display = 'block';
    
    // Carregar dados da aba
    switch(tabName) {
      case 'realizados':
        if (!eventosRelatorios.length) {
          carregarEventosRealizados();
        } else {
          filtrarEventosRealizados();
        }
        break;
      case 'cancelados':
        if (!eventosRelatorios.length) {
          carregarEventosCancelados();
        } else {
          filtrarEventosCancelados();
        }
        break;
      case 'finalizados':
        if (!eventosRelatorios.length) {
          carregarEventosFinalizados();
        } else {
          filtrarEventosFinalizados();
        }
        break;
    }
  }
}

// ==================== EVENTOS REALIZADOS ====================

function carregarEventosRealizados() {
  eventosRelatorios = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Atualizar filtro de clientes
  atualizarFiltroClientesRealizados(eventosRelatorios);
  
  // Filtrar eventos
  filtrarEventosRealizados();
}

function filtrarEventosRealizados() {
  const periodo = document.getElementById('periodoRealizados').value;
  const statusPagamento = document.getElementById('statusPagamentoRealizados').value;
  const cliente = document.getElementById('clienteRealizados').value;
  const dataInicio = document.getElementById('dataInicioRealizados').value;
  const dataFim = document.getElementById('dataFimRealizados').value;
  
  // Mostrar/ocultar datas personalizadas
  const inicioDiv = document.getElementById('dataInicioRealizadosDiv');
  const fimDiv = document.getElementById('dataFimRealizadosDiv');
  
  if (periodo === 'personalizado') {
    inicioDiv.style.display = 'block';
    fimDiv.style.display = 'block';
  } else {
    inicioDiv.style.display = 'none';
    fimDiv.style.display = 'none';
  }
  
  // Filtrar eventos realizados (data passada e status 'realizado' ou 'finalizado')
  const hoje = new Date();
  const eventosFiltrados = eventosRelatorios.filter(evento => {
    const eventoData = new Date(evento.data);
    const jaAconteceu = eventoData < hoje;
    const statusRealizado = evento.status === 'realizado' || evento.status === 'finalizado';
    
    // Se o evento n√£o aconteceu e n√£o tem status realizado, n√£o mostrar
    if (!jaAconteceu && !statusRealizado) return false;
    
    // Filtrar por per√≠odo
    if (periodo !== 'todos' && periodo !== 'personalizado') {
      const inicioPeriodo = calcularInicioPeriodo(periodo);
      if (eventoData < inicioPeriodo) return false;
    }
    
    // Filtrar por datas personalizadas
    if (periodo === 'personalizado' && dataInicio && dataFim) {
      const dataEvento = new Date(evento.data);
      const inicio = new Date(dataInicio);
      const fim = new Date(dataFim);
      
      if (dataEvento < inicio || dataEvento > fim) return false;
    }
    
    // Filtrar por status de pagamento
    if (statusPagamento !== 'todos') {
      const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
      const valorPago = calcularValorPago(evento);
      
      if (statusPagamento === 'total' && valorPago < valorTotal) return false;
      if (statusPagamento === 'parcial' && (valorPago === 0 || valorPago >= valorTotal)) return false;
      if (statusPagamento === 'pendente' && valorPago > 0) return false;
    }
    
    // Filtrar por cliente
    if (cliente !== 'todos' && evento.cliente !== cliente) return false;
    
    return true;
  });
  
  // Calcular totais
  calcularTotaisRealizados(eventosFiltrados);
  
  // Atualizar tabela
  atualizarTabelaRealizados(eventosFiltrados);
}

function calcularTotaisRealizados(eventos) {
  let totalEventos = 0;
  let valorTotal = 0;
  let totalPago = 0;
  
  eventos.forEach(evento => {
    totalEventos++;
    valorTotal += parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    totalPago += calcularValorPago(evento);
  });
  
  const media = totalEventos > 0 ? valorTotal / totalEventos : 0;
  
  document.getElementById('totalEventosRealizados').textContent = totalEventos;
  document.getElementById('valorTotalRealizados').textContent = formatarMoeda(valorTotal);
  document.getElementById('mediaRealizados').textContent = formatarMoeda(media);
}

function atualizarTabelaRealizados(eventos) {
  const tabela = document.getElementById('tabelaEventosRealizados');
  let html = '';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    const pendente = valorTotal - valorPago;
    
    // Determinar status de pagamento
    let statusPagamento = 'pendente';
    let statusBadge = 'badge-pendente';
    
    if (valorPago >= valorTotal) {
      statusPagamento = 'pago';
      statusBadge = 'badge-pago';
    } else if (valorPago > 0) {
      statusPagamento = 'parcial';
      statusBadge = 'badge-parcial';
    }
    
    // Formatar personagens
    let personagensHTML = '';
    if (evento.personagens && Array.isArray(evento.personagens)) {
      personagensHTML = evento.personagens.map(p => p.nome || p).join(', ');
    }
    
    html += `
      <tr class="status-realizado">
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td><strong>${evento.cliente || 'N/A'}</strong></td>
        <td>${evento.local || 'N/A'}</td>
        <td>${personagensHTML}</td>
        <td style="font-weight: bold;">${formatarMoeda(valorTotal)}</td>
        <td>${formatarMoeda(valorPago)}</td>
        <td><span class="status-badge ${statusBadge}">${statusPagamento.toUpperCase()}</span></td>
        <td>${evento.observacoes || ''}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum evento realizado encontrado</td></tr>';
}

function resetarFiltrosRealizados() {
  document.getElementById('periodoRealizados').value = 'todos';
  document.getElementById('statusPagamentoRealizados').value = 'todos';
  document.getElementById('clienteRealizados').value = 'todos';
  document.getElementById('dataInicioRealizados').value = '';
  document.getElementById('dataFimRealizados').value = '';
  filtrarEventosRealizados();
}

// ==================== EVENTOS CANCELADOS ====================

function carregarEventosCancelados() {
  // Os eventos j√° foram carregados na vari√°vel eventosRelatorios
  filtrarEventosCancelados();
}

function filtrarEventosCancelados() {
  const periodo = document.getElementById('periodoCancelados').value;
  const motivo = document.getElementById('motivoCancelados').value;
  const dataInicio = document.getElementById('dataInicioCancelados').value;
  const dataFim = document.getElementById('dataFimCancelados').value;
  
  // Mostrar/ocultar datas personalizadas
  const inicioDiv = document.getElementById('dataInicioCanceladosDiv');
  const fimDiv = document.getElementById('dataFimCanceladosDiv');
  
  if (periodo === 'personalizado') {
    inicioDiv.style.display = 'block';
    fimDiv.style.display = 'block';
  } else {
    inicioDiv.style.display = 'none';
    fimDiv.style.display = 'none';
  }
  
  // Filtrar eventos cancelados
  const eventosCancelados = eventosRelatorios.filter(evento => {
    if (evento.status !== 'cancelado' && !evento.cancelado) return false;
    
    // Filtrar por per√≠odo
    if (periodo !== 'todos' && periodo !== 'personalizado') {
      const inicioPeriodo = calcularInicioPeriodo(periodo);
      const dataEvento = new Date(evento.data_cancelamento || evento.data);
      if (dataEvento < inicioPeriodo) return false;
    }
    
    // Filtrar por datas personalizadas
    if (periodo === 'personalizado' && dataInicio && dataFim) {
      const dataEvento = new Date(evento.data_cancelamento || evento.data);
      const inicio = new Date(dataInicio);
      const fim = new Date(dataFim);
      
      if (dataEvento < inicio || dataEvento > fim) return false;
    }
    
    // Filtrar por motivo
    if (motivo !== 'todos' && evento.motivo_cancelamento !== motivo) {
      return false;
    }
    
    return true;
  });
  
  // Calcular totais
  calcularTotaisCancelados(eventosCancelados);
  
  // Atualizar tabela
  atualizarTabelaCancelados(eventosCancelados);
}

function calcularTotaisCancelados(eventos) {
  let totalEventos = 0;
  let valorPerdido = 0;
  let sinalDevolvido = 0;
  
  eventos.forEach(evento => {
    totalEventos++;
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const sinalPago = parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    
    valorPerdido += valorTotal;
    
    // Verificar se o sinal foi devolvido (50% √© devolvido por padr√£o)
    if (evento.sinal_devolvido === true) {
      sinalDevolvido += sinalPago * 0.5;
    }
  });
  
  document.getElementById('totalEventosCancelados').textContent = totalEventos;
  document.getElementById('valorPerdidoCancelados').textContent = formatarMoeda(valorPerdido);
  document.getElementById('sinalDevolvido').textContent = formatarMoeda(sinalDevolvido);
}

function atualizarTabelaCancelados(eventos) {
  const tabela = document.getElementById('tabelaEventosCancelados');
  let html = '';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const sinalPago = parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const sinalDevolvido = evento.sinal_devolvido === true ? sinalPago * 0.5 : 0;
    const motivo = evento.motivo_cancelamento || 'N√£o especificado';
    
    html += `
      <tr class="status-cancelado">
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td><strong>${evento.cliente || 'N/A'}</strong></td>
        <td>${evento.local || 'N/A'}</td>
        <td style="font-weight: bold;">${formatarMoeda(valorTotal)}</td>
        <td>${formatarMoeda(sinalPago)}</td>
        <td><span class="badge-cancelado">${traduzirMotivoCancelamento(motivo)}</span></td>
        <td>${formatarData(evento.data_cancelamento || evento.data)}</td>
        <td>${formatarMoeda(sinalDevolvido)}</td>
        <td>${evento.responsavel_cancelamento || 'Sistema'}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="10" style="text-align: center; padding: 2rem;">Nenhum evento cancelado encontrado</td></tr>';
}

function traduzirMotivoCancelamento(motivo) {
  const motivos = {
    'cliente': 'Cliente cancelou',
    'empresa': 'Empresa cancelou',
    'clima': 'Problemas clim√°ticos',
    'logistica': 'Problemas log√≠sticos',
    'outro': 'Outros'
  };
  
  return motivos[motivo] || motivo;
}

function resetarFiltrosCancelados() {
  document.getElementById('periodoCancelados').value = 'todos';
  document.getElementById('motivoCancelados').value = 'todos';
  document.getElementById('dataInicioCancelados').value = '';
  document.getElementById('dataFimCancelados').value = '';
  filtrarEventosCancelados();
}

// ==================== EVENTOS FINALIZADOS ====================

function carregarEventosFinalizados() {
  // Os eventos j√° foram carregados na vari√°vel eventosRelatorios
  filtrarEventosFinalizados();
}

function filtrarEventosFinalizados() {
  const periodo = document.getElementById('periodoFinalizados').value;
  const status = document.getElementById('statusFinalizados').value;
  const dataInicio = document.getElementById('dataInicioFinalizados').value;
  const dataFim = document.getElementById('dataFimFinalizados').value;
  
  // Mostrar/ocultar datas personalizadas
  const inicioDiv = document.getElementById('dataInicioFinalizadosDiv');
  const fimDiv = document.getElementById('dataFimFinalizadosDiv');
  
  if (periodo === 'personalizado') {
    inicioDiv.style.display = 'block';
    fimDiv.style.display = 'block';
  } else {
    inicioDiv.style.display = 'none';
    fimDiv.style.display = 'none';
  }
  
  // Filtrar eventos
  const eventosFiltrados = eventosRelatorios.filter(evento => {
    // Filtrar por status
    if (status !== 'todos' && evento.status !== status) {
      return false;
    }
    
    // Filtrar por per√≠odo
    if (periodo !== 'todos' && periodo !== 'personalizado') {
      const inicioPeriodo = calcularInicioPeriodo(periodo);
      const dataEvento = new Date(evento.data);
      if (dataEvento < inicioPeriodo) return false;
    }
    
    // Filtrar por datas personalizadas
    if (periodo === 'personalizado' && dataInicio && dataFim) {
      const dataEvento = new Date(evento.data);
      const inicio = new Date(dataInicio);
      const fim = new Date(dataFim);
      
      if (dataEvento < inicio || dataEvento > fim) return false;
    }
    
    return true;
  });
  
  // Atualizar totais
  atualizarTotaisFinalizados(eventosFiltrados);
  
  // Atualizar tabela
  atualizarTabelaFinalizados(eventosFiltrados);
}

function atualizarTotaisFinalizados(eventos) {
  let totalEventos = 0;
  let totalRealizados = 0;
  let totalCancelados = 0;
  let totalFinalizados = 0;
  let valorTotal = 0;
  
  eventos.forEach(evento => {
    totalEventos++;
    
    switch(evento.status) {
      case 'realizado':
        totalRealizados++;
        break;
      case 'cancelado':
        totalCancelados++;
        break;
      case 'finalizado':
        totalFinalizados++;
        break;
      default:
        if (!evento.status) {
          totalFinalizados++; // Considerar sem status como finalizado
        }
    }
    
    valorTotal += parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  });
  
  const totaisHTML = `
    <div class="card-mini" style="background: #e2e3e5;">
      <h4>Total de Eventos</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #383d41;">${totalEventos}</p>
    </div>
    <div class="card-mini" style="background: #d4edda;">
      <h4>Realizados</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #155724;">${totalRealizados}</p>
    </div>
    <div class="card-mini" style="background: #f8d7da;">
      <h4>Cancelados</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #721c24;">${totalCancelados}</p>
    </div>
    <div class="card-mini" style="background: #cce5ff;">
      <h4>Valor Total</h4>
      <p style="font-size: 1.5rem; font-weight: bold; color: #004085;">${formatarMoeda(valorTotal)}</p>
    </div>
  `;
  
  document.getElementById('totaisFinalizados').innerHTML = totaisHTML;
}

function atualizarTabelaFinalizados(eventos) {
  const tabela = document.getElementById('tabelaEventosFinalizados');
  let html = '';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    const pendente = valorTotal - valorPago;
    
    // Determinar classe CSS baseada no status
    let statusClass = '';
    let statusBadge = '';
    let statusTexto = evento.status || 'finalizado';
    
    switch(statusTexto) {
      case 'realizado':
        statusClass = 'status-realizado';
        statusBadge = 'badge-realizado';
        break;
      case 'cancelado':
        statusClass = 'status-cancelado';
        statusBadge = 'badge-cancelado';
        break;
      case 'finalizado':
      default:
        statusClass = 'status-finalizado';
        statusBadge = 'badge-finalizado';
        statusTexto = 'finalizado';
        break;
    }
    
    // Status de pagamento
    let statusPagamento = 'pendente';
    let pagamentoBadge = 'badge-pendente';
    
    if (valorPago >= valorTotal) {
      statusPagamento = 'pago';
      pagamentoBadge = 'badge-pago';
    } else if (valorPago > 0) {
      statusPagamento = 'parcial';
      pagamentoBadge = 'badge-parcial';
    }
    
    html += `
      <tr class="${statusClass}">
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td><strong>${evento.cliente || 'N/A'}</strong></td>
        <td>${evento.local || 'N/A'}</td>
        <td><span class="status-badge ${statusBadge}">${statusTexto.toUpperCase()}</span></td>
        <td style="font-weight: bold;">${formatarMoeda(valorTotal)}</td>
        <td>${formatarMoeda(valorPago)}</td>
        <td><span class="status-badge ${pagamentoBadge}">${formatarMoeda(pendente)}</span></td>
        <td>${evento.observacoes || ''}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum evento encontrado</td></tr>';
}

function resetarFiltrosFinalizados() {
  document.getElementById('periodoFinalizados').value = 'todos';
  document.getElementById('statusFinalizados').value = 'todos';
  document.getElementById('dataInicioFinalizados').value = '';
  document.getElementById('dataFimFinalizados').value = '';
  filtrarEventosFinalizados();
}

// ==================== FUN√á√ïES AUXILIARES ====================

function calcularInicioPeriodo(periodo) {
  const hoje = new Date();
  
  switch(periodo) {
    case 'hoje':
      return new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
    case 'semana':
      const inicioSemana = new Date(hoje);
      inicioSemana.setDate(hoje.getDate() - hoje.getDay());
      return inicioSemana;
    case 'mes':
      return new Date(hoje.getFullYear(), hoje.getMonth(), 1);
    default:
      return new Date(0); // Data muito antiga
  }
}

function calcularValorPago(evento) {
  let valorPago = 0;
  
  // Verificar sinal pago
  if (evento.sinal_pago_status === 'true') {
    valorPago += parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  // Verificar valor avulso pago
  if (evento.valor_avulso_pago === 'true') {
    valorPago += parseFloat(evento.valor_avulso?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  // Verificar valor restante pago
  if (evento.valor_restante_recebido === 'true') {
    valorPago += parseFloat(evento.valor_falta_receber?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  return valorPago;
}

function formatarMoeda(valor) {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(valor);
}

function formatarData(dataString) {
  if (!dataString) return 'N/A';
  const [ano, mes, dia] = dataString.split('-');
  return `${dia}/${mes}/${ano}`;
}

function atualizarFiltroClientesRealizados(eventos) {
  const select = document.getElementById('clienteRealizados');
  const clientesUnicos = [...new Set(eventos.map(e => e.cliente))];
  
  let options = '<option value="todos">Todos os clientes</option>';
  clientesUnicos.forEach(cliente => {
    if (cliente) {
      options += `<option value="${cliente}">${cliente}</option>`;
    }
  });
  
  select.innerHTML = options;
}

// Fun√ß√µes de exporta√ß√£o
function exportarRelatorioRealizados() {
  exportarParaCSV('tabelaEventosRealizados', 'eventos_realizados');
}

function exportarRelatorioCancelados() {
  exportarParaCSV('tabelaEventosCancelados', 'eventos_cancelados');
}

function exportarRelatorioFinalizados() {
  exportarParaCSV('tabelaEventosFinalizados', 'eventos_finalizados');
}

function exportarParaCSV(tabelaId, nomeArquivo) {
  const table = document.getElementById(tabelaId);
  const rows = table.querySelectorAll('tr');
  
  let csv = [];
  
  // Cabe√ßalho
  const headers = [];
  table.querySelectorAll('th').forEach(th => {
    headers.push(th.innerText);
  });
  csv.push(headers.join(';'));
  
  // Dados
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length > 0) {
      const rowData = [];
      cells.forEach(cell => {
        // Remover HTML dos badges
        let text = cell.innerText;
        rowData.push(text);
      });
      csv.push(rowData.join(';'));
    }
  });
  
  if (csv.length <= 1) {
    alert('N√£o h√° dados para exportar!');
    return;
  }
  
  const csvContent = csv.join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${nomeArquivo}_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

// Fun√ß√µes de impress√£o
function imprimirRelatorioRealizados() {
  imprimirTabela('tabelaEventosRealizados', 'Relat√≥rio de Eventos Realizados');
}

function imprimirRelatorioCancelados() {
  imprimirTabela('tabelaEventosCancelados', 'Relat√≥rio de Eventos Cancelados');
}

function imprimirRelatorioFinalizados() {
  imprimirTabela('tabelaEventosFinalizados', 'Relat√≥rio de Eventos Finalizados');
}

function imprimirTabela(tabelaId, titulo) {
  const tabela = document.getElementById(tabelaId).cloneNode(true);
  
  if (!tabela.querySelector('tr td')) {
    alert('N√£o h√° dados para imprimir!');
    return;
  }
  
  // Criar nova janela para impress√£o
  const janelaImpressao = window.open('', '_blank');
  janelaImpressao.document.write(`
    <html>
      <head>
        <title>${titulo}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1 { color: #333; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th { background-color: #f8f9fa; padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6; }
          td { padding: 10px; border-bottom: 1px solid #dee2e6; }
          .status-realizado { background-color: #d4edda; }
          .status-cancelado { background-color: #f8d7da; }
          .status-finalizado { background-color: #e2e3e5; }
          @media print {
            body { margin: 0; }
            table { font-size: 11px; }
          }
        </style>
      </head>
      <body>
        <h1>${titulo}</h1>
        <p>Data do relat√≥rio: ${new Date().toLocaleDateString('pt-BR')}</p>
        ${tabela.outerHTML}
      </body>
    </html>
  `);
  
  janelaImpressao.document.close();
  janelaImpressao.focus();
  setTimeout(() => {
    janelaImpressao.print();
    janelaImpressao.close();
  }, 500);
}

// Inicializar quando a p√°gina carregar
document.addEventListener('DOMContentLoaded', function() {
  // Configurar datas iniciais
  const hoje = new Date().toISOString().split('T')[0];
  
  // Configurar eventos nos selects de per√≠odo
  document.querySelectorAll('select[id^="periodo"]').forEach(select => {
    select.addEventListener('change', function() {
      const isPersonalizado = this.value === 'personalizado';
      const idBase = this.id.replace('periodo', '');
      
      const inicioDiv = document.getElementById(`dataInicio${idBase}Div`);
      const fimDiv = document.getElementById(`dataFim${idBase}Div`);
      
      if (inicioDiv && fimDiv) {
        inicioDiv.style.display = isPersonalizado ? 'block' : 'none';
        fimDiv.style.display = isPersonalizado ? 'block' : 'none';
      }
    });
  });
  
  // Se estiver na p√°gina de relat√≥rios de eventos, carregar os dados
  if (document.getElementById('relatorios_eventos')) {
    // Carregar todos os eventos
    eventosRelatorios = JSON.parse(localStorage.getItem('eventos') || '[]');
    
    // Carregar primeira aba por padr√£o
    abrirTabEvento('realizados');
  }
});
// ==================== FUN√á√ïES PARA RELAT√ìRIO DE CLIENTES ====================

function carregarRelatorioClientes() {
  // Carregar dados
  const clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Processar cada cliente
  const clientesProcessados = clientes.map(cliente => {
    // Encontrar eventos deste cliente
    const eventosDoCliente = eventos.filter(evento => 
      evento.cliente === cliente.nome || 
      evento.clienteId === cliente.id ||
      evento.doc_cliente === cliente.doc_cliente_cadastro
    );
    
    // Calcular valores
    let valorTotal = 0;
    let primeiroEvento = null;
    let ultimoEvento = null;
    
    eventosDoCliente.forEach(evento => {
      const valor = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
      valorTotal += valor;
      
      // Determinar primeiro e √∫ltimo evento
      if (!primeiroEvento || new Date(evento.data) < new Date(primeiroEvento.data)) {
        primeiroEvento = evento;
      }
      if (!ultimoEvento || new Date(evento.data) > new Date(ultimoEvento.data)) {
        ultimoEvento = evento;
      }
    });
    
    // Determinar potencial
    let potencial = 'nenhum';
    if (eventosDoCliente.length > 0) {
      if (eventosDoCliente.length >= 3 || valorTotal >= 5000) {
        potencial = 'alta';
      } else if (eventosDoCliente.length >= 2 || valorTotal >= 1000) {
        potencial = 'media';
      } else {
        potencial = 'baixa';
      }
    }
    
    return {
      ...cliente,
      totalEventos: eventosDoCliente.length,
      valorTotal: valorTotal,
      primeiroEvento: primeiroEvento?.data,
      ultimoEvento: ultimoEvento?.data,
      potencial: potencial
    };
  });
  
  // Atualizar totais
  atualizarTotaisClientes(clientesProcessados);
  
  // Filtrar clientes
  filtrarRelatorioClientes(clientesProcessados);
}

function atualizarTotaisClientes(clientes) {
  const totalClientes = clientes.length;
  const clientesComEventos = clientes.filter(c => c.totalEventos > 0).length;
  const receitaTotal = clientes.reduce((total, cliente) => total + cliente.valorTotal, 0);
  const mediaPorCliente = totalClientes > 0 ? receitaTotal / totalClientes : 0;
  
  document.getElementById('totalClientes').textContent = totalClientes;
  document.getElementById('clientesComEventos').textContent = clientesComEventos;
  document.getElementById('receitaTotalClientes').textContent = formatarMoeda(receitaTotal);
  document.getElementById('mediaPorCliente').textContent = formatarMoeda(mediaPorCliente);
}

function filtrarRelatorioClientes(clientesProcessados) {
  const potencial = document.getElementById('filtroPotencialCliente').value;
  const ordem = document.getElementById('filtroOrdemCliente').value;
  const documento = document.getElementById('filtroDocCliente').value;
  
  // Filtrar por potencial
  let clientesFiltrados = clientesProcessados;
  if (potencial !== 'todos') {
    clientesFiltrados = clientesFiltrados.filter(cliente => cliente.potencial === potencial);
  }
  
  // Filtrar por tipo de documento
  if (documento !== 'todos') {
    clientesFiltrados = clientesFiltrados.filter(cliente => {
      const doc = cliente.doc_cliente_cadastro || '';
      if (documento === 'cpf') return doc.length === 14; // CPF formatado
      if (documento === 'cnpj') return doc.length === 18; // CNPJ formatado
      return true;
    });
  }
  
  // Ordenar
  clientesFiltrados.sort((a, b) => {
    switch(ordem) {
      case 'nome':
        return (a.nome || a.nome_cliente || '').localeCompare(b.nome || b.nome_cliente || '');
      case 'eventos':
        return b.totalEventos - a.totalEventos;
      case 'valor':
        return b.valorTotal - a.valorTotal;
      case 'recencia':
        if (!a.ultimoEvento && !b.ultimoEvento) return 0;
        if (!a.ultimoEvento) return 1;
        if (!b.ultimoEvento) return -1;
        return new Date(b.ultimoEvento) - new Date(a.ultimoEvento);
      default:
        return 0;
    }
  });
  
  // Atualizar tabela
  atualizarTabelaClientes(clientesFiltrados);
}

function atualizarTabelaClientes(clientes) {
  const tabela = document.getElementById('tabelaRelatorioClientes');
  let html = '';
  
  clientes.forEach(cliente => {
    const nome = cliente.nome || cliente.nome_cliente || 'N√£o informado';
    const documento = cliente.doc_cliente_cadastro || 'N√£o informado';
    const telefone = cliente.telefone_cliente || 'N√£o informado';
    const email = cliente.email_cliente || 'N√£o informado';
    
    // Badge de potencial
    const badgeClass = `badge-potencial badge-${cliente.potencial}`;
    const potencialText = {
      'alta': 'Alta Potencial',
      'media': 'M√©dia Potencial',
      'baixa': 'Baixa Potencial',
      'nenhum': 'Sem Eventos'
    }[cliente.potencial];
    
    html += `
      <tr>
        <td><strong>${nome}</strong></td>
        <td>${documento}</td>
        <td>
          <div>${telefone}</div>
          <div style="font-size: 0.875rem; color: #666;">${email}</div>
        </td>
        <td style="text-align: center; font-weight: bold;">${cliente.totalEventos}</td>
        <td style="font-weight: bold; color: #28a745;">${formatarMoeda(cliente.valorTotal)}</td>
        <td>${cliente.primeiroEvento ? formatarData(cliente.primeiroEvento) : 'N/A'}</td>
        <td>${cliente.ultimoEvento ? formatarData(cliente.ultimoEvento) : 'N/A'}</td>
        <td><span class="${badgeClass}">${potencialText}</span></td>
        <td>
          <button class="btn-small" onclick="verDetalhesCliente('${cliente.id}')">
            üëÅÔ∏è Ver
          </button>
          <button class="btn-small" onclick="exportarHistoricoCliente('${cliente.id}')">
            üìã Hist√≥rico
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum cliente encontrado</td></tr>';
}

function resetarFiltrosClientes() {
  document.getElementById('filtroPotencialCliente').value = 'todos';
  document.getElementById('filtroOrdemCliente').value = 'nome';
  document.getElementById('filtroDocCliente').value = 'todos';
  carregarRelatorioClientes();
}

function verDetalhesCliente(clienteId) {
  const clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  const cliente = clientes.find(c => c.id === clienteId);
  if (!cliente) {
    alert('Cliente n√£o encontrado!');
    return;
  }
  
  // Encontrar eventos deste cliente
  const eventosDoCliente = eventos.filter(evento => 
    evento.cliente === cliente.nome || 
    evento.clienteId === cliente.id
  );
  
  let html = `
    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
      <h4 style="margin-top: 0;">${cliente.nome || cliente.nome_cliente}</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div>
          <strong>Documento:</strong><br>
          ${cliente.doc_cliente_cadastro || 'N√£o informado'}
        </div>
        <div>
          <strong>Telefone:</strong><br>
          ${cliente.telefone_cliente || 'N√£o informado'}
        </div>
        <div>
          <strong>Email:</strong><br>
          ${cliente.email_cliente || 'N√£o informado'}
        </div>
        <div>
          <strong>Endere√ßo:</strong><br>
          ${cliente.logradouro_cliente || ''} ${cliente.numero_cliente || ''}<br>
          ${cliente.bairro_cliente || ''} - ${cliente.cidade_cliente || ''}/${cliente.estado_cliente || ''}
        </div>
      </div>
    </div>
    
    <h5>üìä Estat√≠sticas</h5>
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
      <div class="card-mini" style="background: #e8f4fd;">
        <h6>Total de Eventos</h6>
        <p style="font-size: 1.25rem; font-weight: bold;">${eventosDoCliente.length}</p>
      </div>
      <div class="card-mini" style="background: #d4edda;">
        <h6>Valor Total Gasto</h6>
        <p style="font-size: 1.25rem; font-weight: bold;">${formatarMoeda(eventosDoCliente.reduce((total, evento) => total + parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0), 0))}</p>
      </div>
      <div class="card-mini" style="background: #fff3cd;">
        <h6>Ticket M√©dio</h6>
        <p style="font-size: 1.25rem; font-weight: bold;">${eventosDoCliente.length > 0 ? formatarMoeda(eventosDoCliente.reduce((total, evento) => total + parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0), 0) / eventosDoCliente.length) : 'R$ 0,00'}</p>
      </div>
    </div>
    
    <h5>üìÖ Hist√≥rico de Eventos</h5>
  `;
  
  if (eventosDoCliente.length > 0) {
    html += `
      <div class="table-container">
        <table class="tabela-relatorio" style="width: 100%; font-size: 0.9rem;">
          <thead>
            <tr>
              <th>Data</th>
              <th>Local</th>
              <th>Personagens</th>
              <th>Valor Total</th>
              <th>Status</th>
              <th>Pagamento</th>
            </tr>
          </thead>
          <tbody>
    `;
    
    eventosDoCliente.forEach(evento => {
      const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
      const valorPago = calcularValorPago(evento);
      
      let statusPagamento = 'Pendente';
      if (valorPago >= valorTotal) statusPagamento = 'Pago';
      else if (valorPago > 0) statusPagamento = 'Parcial';
      
      html += `
        <tr>
          <td>${formatarData(evento.data)}</td>
          <td>${evento.local || 'N/A'}</td>
          <td>${evento.personagens ? evento.personagens.length : 0}</td>
          <td>${formatarMoeda(valorTotal)}</td>
          <td><span class="status-badge status-${evento.status || 'finalizado'}">${evento.status || 'Finalizado'}</span></td>
          <td><span class="status-badge ${valorPago >= valorTotal ? 'badge-pago' : valorPago > 0 ? 'badge-parcial' : 'badge-pendente'}">${statusPagamento}</span></td>
        </tr>
      `;
    });
    
    html += `
          </tbody>
        </table>
      </div>
    `;
  } else {
    html += '<p style="color: #6c757d; text-align: center; padding: 2rem;">Nenhum evento realizado por este cliente.</p>';
  }
  
  document.getElementById('detalhesClienteConteudo').innerHTML = html;
  document.getElementById('modalDetalhesCliente').style.display = 'block';
}

function exportarHistoricoCliente(clienteId) {
  const clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  const cliente = clientes.find(c => c.id === clienteId);
  const eventosDoCliente = eventos.filter(evento => 
    evento.cliente === cliente.nome || 
    evento.clienteId === cliente.id
  );
  
  let csv = `Cliente: ${cliente.nome || cliente.nome_cliente}\n`;
  csv += `Documento: ${cliente.doc_cliente_cadastro || ''}\n`;
  csv += `Telefone: ${cliente.telefone_cliente || ''}\n`;
  csv += `Email: ${cliente.email_cliente || ''}\n\n`;
  csv += 'Data;Local;Personagens;Valor Total;Status;Pagamento\n';
  
  eventosDoCliente.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    let statusPagamento = 'Pendente';
    if (valorPago >= valorTotal) statusPagamento = 'Pago';
    else if (valorPago > 0) statusPagamento = 'Parcial';
    
    csv += `${formatarData(evento.data)};`;
    csv += `${evento.local || 'N/A'};`;
    csv += `${evento.personagens ? evento.personagens.length : 0};`;
    csv += `${valorTotal.toFixed(2)};`;
    csv += `${evento.status || 'Finalizado'};`;
    csv += `${statusPagamento}\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `historico_${cliente.nome || cliente.nome_cliente}_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

function fecharModalCliente() {
  document.getElementById('modalDetalhesCliente').style.display = 'none';
}

// ==================== FUN√á√ïES PARA RELAT√ìRIO DE EQUIPE ====================

function abrirTabEquipe(tabName) {
  // Remover classe active de todos os bot√µes
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Remover classe active de todos os conte√∫dos
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
    content.style.display = 'none';
  });
  
  // Adicionar classe active ao bot√£o clicado
  const btnClicado = document.querySelector(`[onclick="abrirTabEquipe('${tabName}')"]`);
  if (btnClicado) {
    btnClicado.classList.add('active');
  }
  
  // Mostrar conte√∫do da aba clicada
  const tabContent = document.getElementById(`tab-${tabName}`);
  if (tabContent) {
    tabContent.classList.add('active');
    tabContent.style.display = 'block';
    
    // Carregar dados da aba
    switch(tabName) {
      case 'elenco':
        carregarRelatorioElenco();
        break;
      case 'producao':
        carregarRelatorioProducao();
        break;
      case 'motoristas':
        carregarRelatorioMotoristas();
        break;
      case 'funcionarios':
        carregarRelatorioFuncionarios();
        break;
    }
  }
}

function carregarRelatorioElenco() {
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  
  const elencoProcessado = elenco.map(membro => {
    // Contar eventos participados
    let eventosParticipados = 0;
    escalas.forEach(escala => {
      if (escala.elenco && escala.elenco.includes(membro.id)) {
        eventosParticipados++;
      }
    });
    
    // Calcular idade
    let idade = 'N/A';
    if (membro.data_nascimento_elenco) {
      const nascimento = new Date(membro.data_nascimento_elenco);
      const hoje = new Date();
      idade = hoje.getFullYear() - nascimento.getFullYear();
      const mes = hoje.getMonth() - nascimento.getMonth();
      if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
      }
    }
    
    return {
      ...membro,
      idade: idade,
      eventosParticipados: eventosParticipados,
      status: eventosParticipados > 0 ? 'Ativo' : 'Inativo'
    };
  });
  
  atualizarTabelaElenco(elencoProcessado);
}

function atualizarTabelaElenco(elenco) {
  const tabela = document.getElementById('tabelaElenco');
  let html = '';
  
  elenco.forEach(membro => {
    html += `
      <tr>
        <td>${membro.id || 'N/A'}</td>
        <td><strong>${membro.nome || membro.nome_elenco || 'N√£o informado'}</strong></td>
        <td>${membro.doc_elenco_cadastro || 'N√£o informado'}</td>
        <td>${membro.idade}</td>
        <td>${membro.telefone_elenco || 'N√£o informado'}</td>
        <td>${membro.email_elenco || 'N√£o informado'}</td>
        <td>${membro.cidade_elenco || 'N√£o informado'}</td>
        <td style="text-align: center; font-weight: bold;">${membro.eventosParticipados}</td>
        <td><span class="status-badge status-${membro.eventosParticipados > 0 ? 'ativo' : 'inativo'}">${membro.status}</span></td>
        <td>
          <button class="btn-small" onclick="verDetalhesMembro('${membro.id}', 'elenco')">
            üëÅÔ∏è Ver
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="10" style="text-align: center; padding: 2rem;">Nenhum membro do elenco encontrado</td></tr>';
}

function carregarRelatorioProducao() {
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  
  const producaoProcessada = funcionarios.map(funcionario => {
    // Contar eventos participados (assumindo que produ√ß√£o est√° em escalas.producao)
    let eventosParticipados = 0;
    escalas.forEach(escala => {
      if (escala.producao && escala.producao.includes(funcionario.id)) {
        eventosParticipados++;
      }
    });
    
    return {
      ...funcionario,
      eventosParticipados: eventosParticipados,
      cargo: 'Produ√ß√£o',
      status: eventosParticipados > 0 ? 'Ativo' : 'Inativo'
    };
  });
  
  atualizarTabelaProducao(producaoProcessada);
}

function atualizarTabelaProducao(producao) {
  const tabela = document.getElementById('tabelaProducao');
  let html = '';
  
  producao.forEach(membro => {
    html += `
      <tr>
        <td>${membro.id || 'N/A'}</td>
        <td><strong>${membro.nome || membro.nome_funcionarios || 'N√£o informado'}</strong></td>
        <td>${membro.cargo}</td>
        <td>${membro.doc_funcionarios_cadastro || 'N√£o informado'}</td>
        <td>${membro.telefone_funcionarios || 'N√£o informado'}</td>
        <td>${membro.email_funcionarios || 'N√£o informado'}</td>
        <td style="text-align: center; font-weight: bold;">${membro.eventosParticipados}</td>
        <td><span class="status-badge status-${membro.eventosParticipados > 0 ? 'ativo' : 'inativo'}">${membro.status}</span></td>
        <td>
          <button class="btn-small" onclick="verDetalhesMembro('${membro.id}', 'funcionarios')">
            üëÅÔ∏è Ver
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum membro da produ√ß√£o encontrado</td></tr>';
}

function carregarRelatorioMotoristas() {
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  
  const motoristasProcessados = motoristas.map(motorista => {
    // Contar eventos participados
    let eventosParticipados = 0;
    escalas.forEach(escala => {
      if (escala.motorista === motorista.id) {
        eventosParticipados++;
      }
    });
    
    return {
      ...motorista,
      eventosParticipados: eventosParticipados,
      status: eventosParticipados > 0 ? 'Ativo' : 'Inativo'
    };
  });
  
  atualizarTabelaMotoristas(motoristasProcessados);
}

function atualizarTabelaMotoristas(motoristas) {
  const tabela = document.getElementById('tabelaMotoristas');
  let html = '';
  
  motoristas.forEach(motorista => {
    html += `
      <tr>
        <td>${motorista.id || 'N/A'}</td>
        <td><strong>${motorista.nome || motorista.nome_motoristas || 'N√£o informado'}</strong></td>
        <td>${motorista.cnh_motoristas || 'N√£o informado'}</td>
        <td>${motorista.veiculo_motoristas || 'N√£o informado'}</td>
        <td>${motorista.telefone_motoristas || 'N√£o informado'}</td>
        <td>${motorista.chave_pix_motoristas || 'N√£o informado'}</td>
        <td style="text-align: center; font-weight: bold;">${motorista.eventosParticipados}</td>
        <td><span class="status-badge status-${motorista.eventosParticipados > 0 ? 'ativo' : 'inativo'}">${motorista.status}</span></td>
        <td>
          <button class="btn-small" onclick="verDetalhesMembro('${motorista.id}', 'motoristas')">
            üëÅÔ∏è Ver
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum motorista encontrado</td></tr>';
}

function carregarRelatorioFuncionarios() {
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  
  const funcionariosProcessados = funcionarios.map(funcionario => ({
    ...funcionario,
    cargo: 'Funcion√°rio',
    salario: 'R$ 2.500,00', // Exemplo - ajustar conforme seus dados
    status: 'Ativo'
  }));
  
  atualizarTabelaFuncionarios(funcionariosProcessados);
}

function atualizarTabelaFuncionarios(funcionarios) {
  const tabela = document.getElementById('tabelaFuncionarios');
  let html = '';
  
  funcionarios.forEach(funcionario => {
    html += `
      <tr>
        <td>${funcionario.id || 'N/A'}</td>
        <td><strong>${funcionario.nome || funcionario.nome_funcionarios || 'N√£o informado'}</strong></td>
        <td>${funcionario.cargo}</td>
        <td>${funcionario.doc_funcionarios_cadastro || 'N√£o informado'}</td>
        <td>${funcionario.telefone_funcionarios || 'N√£o informado'}</td>
        <td>${funcionario.email_funcionarios || 'N√£o informado'}</td>
        <td>${funcionario.data_admissao || 'N/A'}</td>
        <td>${funcionario.salario || 'N/A'}</td>
        <td><span class="status-badge status-ativo">${funcionario.status}</span></td>
        <td>
          <button class="btn-small" onclick="verDetalhesMembro('${funcionario.id}', 'funcionarios')">
            üëÅÔ∏è Ver
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="10" style="text-align: center; padding: 2rem;">Nenhum funcion√°rio encontrado</td></tr>';
}

// ==================== FUN√á√ïES PARA RELAT√ìRIO FINANCEIRO ====================

function carregarRelatorioFinanceiro() {
  const periodo = document.getElementById('periodoFinanceiro').value;
  
  // Configurar datas baseadas no per√≠odo
  let dataInicio, dataFim;
  const hoje = new Date();
  
  switch(periodo) {
    case 'mes_atual':
      dataInicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
      dataFim = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
      break;
    case 'mes_anterior':
      dataInicio = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1);
      dataFim = new Date(hoje.getFullYear(), hoje.getMonth(), 0);
      break;
    case 'trimestre':
      dataInicio = new Date(hoje.getFullYear(), hoje.getMonth() - 2, 1);
      dataFim = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
      break;
    case 'semestre':
      dataInicio = new Date(hoje.getFullYear(), hoje.getMonth() - 5, 1);
      dataFim = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
      break;
    case 'ano':
      dataInicio = new Date(hoje.getFullYear(), 0, 1);
      dataFim = new Date(hoje.getFullYear(), 11, 31);
      break;
    case 'personalizado':
      dataInicio = document.getElementById('dataInicioFinanceiro').value ? new Date(document.getElementById('dataInicioFinanceiro').value) : null;
      dataFim = document.getElementById('dataFimFinanceiro').value ? new Date(document.getElementById('dataFimFinanceiro').value) : null;
      break;
    case 'todos':
    default:
      dataInicio = null;
      dataFim = null;
      break;
  }
  
  // Carregar dados
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const contasPagar = JSON.parse(localStorage.getItem('contasPagar') || '[]');
  
  // Filtrar eventos por per√≠odo
  const eventosFiltrados = eventos.filter(evento => {
    if (!dataInicio || !dataFim) return true;
    const dataEvento = new Date(evento.data);
    return dataEvento >= dataInicio && dataEvento <= dataFim;
  });
  
  // Calcular receitas
  calcularReceitas(eventosFiltrados);
  
  // Calcular despesas
  calcularDespesas(eventosFiltrados, contasPagar);
  
  // Calcular lucros
  calcularLucros();
  
  // Carregar abas
  abrirTabFinanceiro('receitas');
}

function calcularReceitas(eventos) {
  let receitaTotal = 0;
  let receitaEventos = 0;
  let receitaSinais = 0;
  let receitaAvulsos = 0;
  let receitaRestante = 0;
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorSinal = parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorAvulso = parseFloat(evento.valor_avulso?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorFaltaReceber = parseFloat(evento.valor_falta_receber?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    
    receitaTotal += valorTotal;
    
    if (evento.sinal_pago_status === 'true') {
      receitaSinais += valorSinal;
      receitaEventos += valorSinal;
    }
    
    if (evento.valor_avulso_pago === 'true') {
      receitaAvulsos += valorAvulso;
      receitaEventos += valorAvulso;
    }
    
    if (evento.valor_restante_recebido === 'true') {
      receitaRestante += valorFaltaReceber;
      receitaEventos += valorFaltaReceber;
    }
  });
  
  document.getElementById('totalReceitas').textContent = formatarMoeda(receitaTotal);
  document.getElementById('receitaEventos').textContent = formatarMoeda(receitaEventos);
  document.getElementById('receitaSinais').textContent = formatarMoeda(receitaSinais);
  document.getElementById('receitaAvulsos').textContent = formatarMoeda(receitaAvulsos);
  document.getElementById('receitaRestante').textContent = formatarMoeda(receitaRestante);
}

function calcularDespesas(eventos, contasPagar) {
  let despesaTotal = 0;
  let despesaElenco = 0;
  let despesaProducao = 0;
  let despesaMotoristas = 0;
  let despesaFuncionarios = 0;
  let despesaFornecedores = 0;
  let despesaCancelamentos = 0;
  
  // Calcular despesas dos eventos (exemplo)
  eventos.forEach(evento => {
    if (evento.status === 'cancelado') {
      const valorSinal = parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
      despesaCancelamentos += valorSinal * 0.5; // 50% do sinal √© devolvido
    }
  });
  
  // Calcular outras despesas (exemplo)
  despesaElenco = 5000; // Exemplo
  despesaProducao = 3000; // Exemplo
  despesaMotoristas = 2000; // Exemplo
  despesaFuncionarios = 15000; // Exemplo
  despesaFornecedores = 8000; // Exemplo
  
  despesaTotal = despesaElenco + despesaProducao + despesaMotoristas + despesaFuncionarios + despesaFornecedores + despesaCancelamentos;
  
  document.getElementById('totalDespesas').textContent = formatarMoeda(despesaTotal);
  document.getElementById('despesaElenco').textContent = formatarMoeda(despesaElenco);
  document.getElementById('despesaProducao').textContent = formatarMoeda(despesaProducao);
  document.getElementById('despesaMotoristas').textContent = formatarMoeda(despesaMotoristas);
  document.getElementById('despesaFuncionarios').textContent = formatarMoeda(despesaFuncionarios);
  document.getElementById('despesaFornecedores').textContent = formatarMoeda(despesaFornecedores);
  document.getElementById('despesaCancelamentos').textContent = formatarMoeda(despesaCancelamentos);
}

function calcularLucros() {
  const receitaTotal = parseFloat(document.getElementById('totalReceitas').textContent.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  const despesaTotal = parseFloat(document.getElementById('totalDespesas').textContent.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  
  const lucroLiquido = receitaTotal - despesaTotal;
  const margemLucro = receitaTotal > 0 ? ((lucroLiquido / receitaTotal) * 100).toFixed(1) : 0;
  
  document.getElementById('lucroLiquido').textContent = formatarMoeda(lucroLiquido);
  document.getElementById('margemLucro').textContent = `${margemLucro}%`;
  
  // Atualizar barras de percentual
  const total = receitaTotal + Math.abs(despesaTotal);
  if (total > 0) {
    const percentReceitas = (receitaTotal / total * 100).toFixed(1);
    const percentDespesas = (Math.abs(despesaTotal) / total * 100).toFixed(1);
    const percentLucro = (Math.abs(lucroLiquido) / total * 100).toFixed(1);
    
    document.getElementById('percentReceitas').textContent = `${percentReceitas}%`;
    document.getElementById('percentDespesas').textContent = `${percentDespesas}%`;
    document.getElementById('percentLucro').textContent = `${percentLucro}%`;
    
    document.getElementById('barraReceitas').style.width = `${percentReceitas}%`;
    document.getElementById('barraDespesas').style.width = `${percentDespesas}%`;
    document.getElementById('barraLucro').style.width = `${percentLucro}%`;
  }
}

function abrirTabFinanceiro(tabName) {
  // Similar √†s outras fun√ß√µes de abas
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
    content.style.display = 'none';
  });
  
  const btnClicado = document.querySelector(`[onclick="abrirTabFinanceiro('${tabName}')"]`);
  if (btnClicado) {
    btnClicado.classList.add('active');
  }
  
  const tabContent = document.getElementById(`tab-${tabName}`);
  if (tabContent) {
    tabContent.classList.add('active');
    tabContent.style.display = 'block';
    
    // Carregar dados espec√≠ficos da aba
    switch(tabName) {
      case 'receitas':
        carregarTabelaReceitas();
        break;
      case 'despesas':
        carregarTabelaDespesas();
        break;
      case 'lucros':
        carregarAnaliseLucros();
        break;
    }
  }
}

// ==================== FUN√á√ïES PARA RELAT√ìRIO DE PERSONAGENS ====================

function carregarRelatorioPersonagens() {
  const personagens = JSON.parse(localStorage.getItem('personagens') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Ordenar por nome
  personagens.sort((a, b) => {
    const nomeA = a.nome_personagens || '';
    const nomeB = b.nome_personagens || '';
    return nomeA.localeCompare(nomeB);
  });
  
  // Processar personagens
  const personagensProcessados = personagens.map(personagem => {
    // Contar reservas
    let reservas = 0;
    eventos.forEach(evento => {
      if (evento.personagens && Array.isArray(evento.personagens)) {
        if (evento.personagens.some(p => p.id === personagem.id || p.nome === personagem.nome_personagens)) {
          reservas++;
        }
      }
    });
    
    return {
      ...personagem,
      reservas: reservas,
      status: reservas > 0 ? 'Ativo' : 'Inativo',
      valorNumerico: parseFloat(personagem.valor_personagens?.replace('R$', '').replace('.', '').replace(',', '.') || 0)
    };
  });
  
  // Atualizar totais
  atualizarTotaisPersonagens(personagensProcessados);
  
  // Atualizar filtros
  atualizarFiltrosPersonagens(personagensProcessados);
  
  // Exibir cat√°logo
  exibirCatalogoPersonagens(personagensProcessados);
}

function atualizarTotaisPersonagens(personagens) {
  const totalPersonagens = personagens.length;
  const valorTotal = personagens.reduce((total, p) => total + p.valorNumerico, 0);
  
  // Encontrar personagem mais caro
  const personagemMaisCaro = personagens.reduce((maisCaro, atual) => {
    return atual.valorNumerico > maisCaro.valorNumerico ? atual : maisCaro;
  }, personagens[0] || {});
  
  // Encontrar personagem mais reservado
  const personagemMaisReservado = personagens.reduce((maisReservado, atual) => {
    return atual.reservas > maisReservado.reservas ? atual : maisReservado;
  }, personagens[0] || {});
  
  document.getElementById('totalPersonagens').textContent = totalPersonagens;
  document.getElementById('valorTotalPersonagens').textContent = formatarMoeda(valorTotal);
  document.getElementById('personagemMaisCaro').textContent = personagemMaisCaro.nome_personagens || '-';
  document.getElementById('personagemMaisReservado').textContent = personagemMaisReservado.nome_personagens || '-';
}

function exibirCatalogoPersonagens(personagens) {
  const container = document.getElementById('catalogoPersonagens');
  let html = '';
  
  personagens.forEach(personagem => {
    const nome = personagem.nome_personagens || 'Personagem sem nome';
    const foto = personagem.foto || '';
    const figurino = personagem.figurino || 'N√£o informado';
    const tema = personagem.tema || 'N√£o informado';
    const quantidade = personagem.quantidade || 1;
    const valor = personagem.valor_personagens || 'R$ 0,00';
    
    html += `
      <div class="card-personagem">
        <div class="card-personagem-img">
          ${foto ? 
            `<img src="${foto}" alt="${nome}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNGMEYwRjAiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSIjNjY2Ij5QZXJzb25hZ2VtPC90ZXh0Pjwvc3ZnPg=='">` : 
            `<div style="width: 100%; height: 100%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #666;">
              <span>üé≠</span>
            </div>`
          }
        </div>
        <div class="card-personagem-content">
          <div class="card-personagem-title">${nome}</div>
          <div class="card-personagem-info">
            <div>
              <div class="card-personagem-label">Figurino</div>
              <div class="card-personagem-value">${figurino}</div>
            </div>
            <div>
              <div class="card-personagem-label">Tema</div>
              <div class="card-personagem-value">${tema}</div>
            </div>
            <div>
              <div class="card-personagem-label">Quantidade</div>
              <div class="card-personagem-value">${quantidade}</div>
            </div>
            <div>
              <div class="card-personagem-label">Valor</div>
              <div class="card-personagem-value" style="color: #28a745;">${valor}</div>
            </div>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
            <span class="status-badge status-${personagem.reservas > 0 ? 'ativo' : 'inativo'}">
              ${personagem.reservas} reserva${personagem.reservas !== 1 ? 's' : ''}
            </span>
            <button class="btn-small" onclick="verDetalhesPersonagemRelatorio('${personagem.id}')">
              üëÅÔ∏è Detalhes
            </button>
          </div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html || '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #6c757d;">Nenhum personagem cadastrado</p>';
}

function alternarVisualizacaoPersonagens() {
  const btn = document.getElementById('btnAlternarVisualizacao');
  const catalogo = document.getElementById('catalogoPersonagens');
  const tabela = document.getElementById('tabelaPersonagensContainer');
  
  if (catalogo.style.display !== 'none') {
    // Mudar para tabela
    catalogo.style.display = 'none';
    tabela.style.display = 'block';
    btn.textContent = 'üé® Ver em Cards';
    carregarTabelaPersonagens();
  } else {
    // Mudar para cards
    catalogo.style.display = 'grid';
    tabela.style.display = 'none';
    btn.textContent = 'üìã Ver em Tabela';
  }
}

// ==================== FUN√á√ïES PARA RELAT√ìRIO DE CASAS DE FESTA ====================

function carregarRelatorioCasasFesta() {
  const casas = JSON.parse(localStorage.getItem('casa_de_festas') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  const casasProcessadas = casas.map(casa => {
    // Contar eventos nesta casa
    const eventosDaCasa = eventos.filter(evento => 
      evento.local === casa.nomecasadefestas || 
      evento.casa_festa_id === casa.id
    );
    
    // Calcular receita gerada
    const receita = eventosDaCasa.reduce((total, evento) => {
      return total + parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    }, 0);
    
    // Calcular avalia√ß√£o m√©dia (exemplo)
    const avaliacao = eventosDaCasa.length > 0 ? 
      (3.5 + Math.random() * 1.5).toFixed(1) : 'N/A';
    
    return {
      ...casa,
      totalEventos: eventosDaCasa.length,
      receita: receita,
      avaliacao: avaliacao,
      ultimoEvento: eventosDaCasa.length > 0 ? 
        eventosDaCasa.reduce((maisRecente, atual) => {
          return new Date(atual.data) > new Date(maisRecente.data) ? atual : maisRecente;
        }, eventosDaCasa[0]).data : null
    };
  });
  
  // Atualizar totais
  atualizarTotaisCasasFesta(casasProcessadas);
  
  // Atualizar filtros
  atualizarFiltrosCasasFesta(casasProcessadas);
  
  // Exibir lista
  exibirListaCasasFesta(casasProcessadas);
}

function exibirListaCasasFesta(casas) {
  const container = document.getElementById('listaCasasFesta');
  let html = '';
  
  casas.forEach(casa => {
    const nome = casa.nomecasadefestas || 'Casa sem nome';
    const cidade = casa.cidade_casadefestas || 'N√£o informado';
    const telefone = casa.telefone_casadefestas || 'N√£o informado';
    
    html += `
      <div class="card-casa-festa">
        <div class="card-casa-festa-header">
          <h4 class="card-casa-festa-title">${nome}</h4>
          <span class="status-badge status-${casa.totalEventos > 0 ? 'ativo' : 'inativo'}">
            ${casa.totalEventos} evento${casa.totalEventos !== 1 ? 's' : ''}
          </span>
        </div>
        
        <div style="color: #666; margin-bottom: 1rem;">
          <div>üìç ${cidade}</div>
          <div>üìû ${telefone}</div>
          ${casa.avaliacao !== 'N/A' ? `<div>‚≠ê ${casa.avaliacao}/5.0</div>` : ''}
        </div>
        
        <div class="card-casa-festa-stats">
          <div class="stat-item">
            <span class="stat-value">${casa.totalEventos}</span>
            <span class="stat-label">Eventos</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" style="color: #28a745;">${formatarMoeda(casa.receita)}</span>
            <span class="stat-label">Receita</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${casa.avaliacao}</span>
            <span class="stat-label">Avalia√ß√£o</span>
          </div>
        </div>
        
        ${casa.ultimoEvento ? 
          `<div style="margin-top: 1rem; font-size: 0.875rem; color: #666;">
            √öltimo evento: ${formatarData(casa.ultimoEvento)}
          </div>` : ''
        }
        
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
          <button class="btn-small" onclick="verDetalhesCasaFesta('${casa.id}')">
            üëÅÔ∏è Detalhes
          </button>
          <button class="btn-small" onclick="verEventosCasaFesta('${casa.id}')">
            üìÖ Eventos
          </button>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html || '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #6c757d;">Nenhuma casa de festa cadastrada</p>';
}

// ==================== FUN√á√ïES AUXILIARES GERAIS ====================

function exportarRelatorioClientes() {
  const tabela = document.getElementById('tabelaRelatorioClientes');
  exportarTabelaParaCSV(tabela, 'relatorio_clientes');
}

function exportarRelatorioElenco() {
  const tabela = document.getElementById('tabelaElenco');
  exportarTabelaParaCSV(tabela, 'relatorio_elenco');
}

function exportarCatalogoPersonagens() {
  const personagens = JSON.parse(localStorage.getItem('personagens') || '[]');
  
  let csv = 'Nome;Figurino;Tema;Quantidade;Valor;Reservas;Status\n';
  personagens.forEach(personagem => {
    csv += `${personagem.nome_personagens || ''};`;
    csv += `${personagem.figurino || ''};`;
    csv += `${personagem.tema || ''};`;
    csv += `${personagem.quantidade || ''};`;
    csv += `${personagem.valor_personagens || ''};`;
    csv += `${personagem.reservas || 0};`;
    csv += `${personagem.reservas > 0 ? 'Ativo' : 'Inativo'}\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `catalogo_personagens_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

function exportarRelatorioCasasFesta() {
  const casas = JSON.parse(localStorage.getItem('casa_de_festas') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  let csv = 'Nome;Cidade;Telefone;Eventos Realizados;Receita Gerada;Avalia√ß√£o;√öltimo Evento\n';
  casas.forEach(casa => {
    const eventosDaCasa = eventos.filter(evento => 
      evento.local === casa.nomecasadefestas || 
      evento.casa_festa_id === casa.id
    );
    
    const receita = eventosDaCasa.reduce((total, evento) => {
      return total + parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    }, 0);
    
    const ultimoEvento = eventosDaCasa.length > 0 ? 
      eventosDaCasa.reduce((maisRecente, atual) => {
        return new Date(atual.data) > new Date(maisRecente.data) ? atual : maisRecente;
      }, eventosDaCasa[0]).data : '';
    
    csv += `${casa.nomecasadefestas || ''};`;
    csv += `${casa.cidade_casadefestas || ''};`;
    csv += `${casa.telefone_casadefestas || ''};`;
    csv += `${eventosDaCasa.length};`;
    csv += `${receita.toFixed(2)};`;
    csv += `${eventosDaCasa.length > 0 ? (3.5 + Math.random() * 1.5).toFixed(1) : 'N/A'};`;
    csv += `${ultimoEvento ? formatarData(ultimoEvento) : ''}\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `relatorio_casas_festa_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

function exportarTabelaParaCSV(tabela, nomeArquivo) {
  const rows = tabela.querySelectorAll('tr');
  let csv = [];
  
  rows.forEach(row => {
    const cells = row.querySelectorAll('td, th');
    if (cells.length > 0) {
      const rowData = [];
      cells.forEach(cell => {
        rowData.push(cell.innerText.replace(/\n/g, ' '));
      });
      csv.push(rowData.join(';'));
    }
  });
  
  if (csv.length <= 1) {
    alert('N√£o h√° dados para exportar!');
    return;
  }
  
  const csvContent = csv.join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${nomeArquivo}_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

function imprimirRelatorioClientes() {
  const tabela = document.getElementById('tabelaRelatorioClientes').cloneNode(true);
  imprimirTabela(tabela, 'Relat√≥rio de Clientes');
}

function imprimirCatalogoPersonagens() {
  const catalogo = document.getElementById('catalogoPersonagens').cloneNode(true);
  const janelaImpressao = window.open('', '_blank');
  janelaImpressao.document.write(`
    <html>
      <head>
        <title>Cat√°logo de Personagens</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1 { color: #333; text-align: center; }
          .cards-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 1.5rem; 
            margin-top: 20px;
          }
          .card { 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            padding: 1rem; 
            break-inside: avoid;
          }
          .card-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem; }
          .card-info { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin: 1rem 0; }
          .card-label { font-size: 0.8rem; color: #666; }
          .card-value { font-weight: bold; }
          @media print {
            body { margin: 0; }
            .cards-container { gap: 1rem; }
          }
        </style>
      </head>
      <body>
        <h1>Cat√°logo de Personagens</h1>
        <p>Data: ${new Date().toLocaleDateString('pt-BR')}</p>
        ${catalogo.outerHTML}
      </body>
    </html>
  `);
  
  janelaImpressao.document.close();
  janelaImpressao.focus();
  setTimeout(() => {
    janelaImpressao.print();
    janelaImpressao.close();
  }, 500);
}

function imprimirTabela(tabela, titulo) {
  const janelaImpressao = window.open('', '_blank');
  janelaImpressao.document.write(`
    <html>
      <head>
        <title>${titulo}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1 { color: #333; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th { background-color: #f8f9fa; padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6; }
          td { padding: 10px; border-bottom: 1px solid #dee2e6; }
          .badge-potencial { padding: 4px 8px; border-radius: 12px; font-size: 0.875rem; }
          .badge-alta { background-color: #d4edda; color: #155724; }
          .badge-media { background-color: #fff3cd; color: #856404; }
          .badge-baixa { background-color: #f8d7da; color: #721c24; }
          .badge-nenhum { background-color: #e2e3e5; color: #383d41; }
          @media print {
            body { margin: 0; }
            table { font-size: 11px; }
          }
        </style>
      </head>
      <body>
        <h1>${titulo}</h1>
        <p>Data do relat√≥rio: ${new Date().toLocaleDateString('pt-BR')}</p>
        ${tabela.outerHTML}
      </body>
    </html>
  `);
  
  janelaImpressao.document.close();
  janelaImpressao.focus();
  setTimeout(() => {
    janelaImpressao.print();
    janelaImpressao.close();
  }, 500);
}

// ==================== INICIALIZA√á√ÉO DOS RELAT√ìRIOS ====================

document.addEventListener('DOMContentLoaded', function() {
  // Configurar modais
  window.onclick = function(event) {
    const modais = ['modalDetalhesCliente', 'modalDetalhesPersonagem', 'modalDetalhesCasaFesta'];
    modais.forEach(modalId => {
      const modal = document.getElementById(modalId);
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });
  };
  
  // Configurar datas iniciais
  const hoje = new Date().toISOString().split('T')[0];
  
  // Configurar per√≠odos personalizados
  document.querySelectorAll('select[id^="periodo"]').forEach(select => {
    select.addEventListener('change', function() {
      const isPersonalizado = this.value === 'personalizado';
      const idBase = this.id.replace('periodo', '');
      
      const inicioDiv = document.getElementById(`dataInicio${idBase}Div`);
      const fimDiv = document.getElementById(`dataFim${idBase}Div`);
      
      if (inicioDiv && fimDiv) {
        inicioDiv.style.display = isPersonalizado ? 'block' : 'none';
        fimDiv.style.display = isPersonalizado ? 'block' : 'none';
        
        if (isPersonalizado && !inicioDiv.querySelector('input').value) {
          inicioDiv.querySelector('input').value = hoje;
          fimDiv.querySelector('input').value = hoje;
        }
      }
    });
  });
  
  // Carregar relat√≥rios quando as p√°ginas forem acessadas
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        const page = mutation.target;
        if (page.classList.contains('active')) {
          switch(page.id) {
            case 'relatorios_clientes':
              carregarRelatorioClientes();
              break;
            case 'relatorios_equipe':
              abrirTabEquipe('elenco');
              break;
            case 'relatorios_financeiro':
              carregarRelatorioFinanceiro();
              break;
            case 'relatorios_personagens':
              carregarRelatorioPersonagens();
              break;
            case 'relatorios_casas_de_festa':
              carregarRelatorioCasasFesta();
              break;
          }
        }
      }
    });
  });
  
  // Observar todas as p√°ginas de relat√≥rio
  const paginasRelatorio = [
    'relatorios_clientes',
    'relatorios_equipe',
    'relatorios_financeiro',
    'relatorios_personagens',
    'relatorios_casas_de_festa'
  ];
  
  paginasRelatorio.forEach(id => {
    const pagina = document.getElementById(id);
    if (pagina) {
      observer.observe(pagina, { attributes: true });
    }
  });
});
// C√≥digo de DEBUG para verificar se as p√°ginas est√£o sendo carregadas
console.log('=== DEBUG RELAT√ìRIOS ===');

// Verifica se as p√°ginas existem
const paginas = [
  'lista_elenco', 'lista_motoristas', 'lista_producao', 'lista_funcionarios',
  'relatorios_receitas', 'relatorios_despesas', 'relatorios_lucros'
];

paginas.forEach(id => {
  const pagina = document.getElementById(id);
  console.log(`P√°gina ${id}:`, pagina ? 'EXISTE' : 'N√ÉO EXISTE');
});

// Verifica dados no localStorage
console.log('Dados no localStorage:');
console.log('- Elenco:', JSON.parse(localStorage.getItem('elenco') || '[]').length);
console.log('- Motoristas:', JSON.parse(localStorage.getItem('motoristas') || '[]').length);
console.log('- Funcion√°rios:', JSON.parse(localStorage.getItem('funcionarios') || '[]').length);
console.log('- Eventos:', JSON.parse(localStorage.getItem('eventos') || '[]').length);

// ==================== FUN√á√ïES PARA RELAT√ìRIO DE RECEITAS ====================

function carregarRelatorioReceitas() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  // Filtrar eventos por per√≠odo
  const periodo = document.getElementById('periodoReceitas').value;
  const status = document.getElementById('statusReceitas').value;
  
  let eventosFiltrados = eventos;
  
  // Aplicar filtro de per√≠odo
  if (periodo !== 'todos') {
    eventosFiltrados = eventosFiltrados.filter(evento => {
      const dataEvento = new Date(evento.data);
      const hoje = new Date();
      
      switch(periodo) {
        case 'mes_atual':
          return dataEvento.getMonth() === hoje.getMonth() && 
                 dataEvento.getFullYear() === hoje.getFullYear();
        case 'mes_anterior':
          const mesAnterior = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1);
          return dataEvento.getMonth() === mesAnterior.getMonth() && 
                 dataEvento.getFullYear() === mesAnterior.getFullYear();
        case 'trimestre':
          const tresMesesAtras = new Date(hoje.getFullYear(), hoje.getMonth() - 2, 1);
          return dataEvento >= tresMesesAtras;
        case 'ano':
          return dataEvento.getFullYear() === hoje.getFullYear();
        default:
          return true;
      }
    });
  }
  
  // Calcular totais
  let totalReceita = 0;
  let totalRecebido = 0;
  let totalPendente = 0;
  let contadorEventos = 0;
  
  eventosFiltrados.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    const pendente = valorTotal - valorPago;
    
    // Aplicar filtro de status
    let statusPagamento = 'pendente';
    if (valorPago >= valorTotal) statusPagamento = 'pago';
    else if (valorPago > 0) statusPagamento = 'parcial';
    
    if (status === 'todos' || status === statusPagamento) {
      totalReceita += valorTotal;
      totalRecebido += valorPago;
      totalPendente += pendente;
      contadorEventos++;
    }
  });
  
  // Atualizar totais
  document.getElementById('totalReceita').textContent = formatarMoeda(totalReceita);
  document.getElementById('totalRecebido').textContent = formatarMoeda(totalRecebido);
  document.getElementById('totalPendenteReceita').textContent = formatarMoeda(totalPendente);
  document.getElementById('mediaReceita').textContent = formatarMoeda(contadorEventos > 0 ? totalReceita / contadorEventos : 0);
  
  // Atualizar tabela
  atualizarTabelaReceitas(eventosFiltrados, status);
}

function atualizarTabelaReceitas(eventos, statusFiltro) {
  const tabela = document.getElementById('tabelaReceitas');
  let html = '';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    const pendente = valorTotal - valorPago;
    
    // Determinar status de pagamento
    let statusPagamento = 'pendente';
    let statusClass = 'badge-pendente';
    let statusTexto = 'Pendente';
    
    if (valorPago >= valorTotal) {
      statusPagamento = 'pago';
      statusClass = 'badge-pago';
      statusTexto = 'Pago';
    } else if (valorPago > 0) {
      statusPagamento = 'parcial';
      statusClass = 'badge-parcial';
      statusTexto = 'Parcial';
    }
    
    // Aplicar filtro de status
    if (statusFiltro !== 'todos' && statusFiltro !== statusPagamento) {
      return;
    }
    
    // Forma de pagamento predominante
    let formaPagamento = 'N√£o definida';
    if (evento.forma_pagamento_sinal) formaPagamento = evento.forma_pagamento_sinal;
    else if (evento.forma_pagamento_avulso) formaPagamento = evento.forma_pagamento_avulso;
    else if (evento.forma_pagamento_restante) formaPagamento = evento.forma_pagamento_restante;
    
    html += `
      <tr>
        <td>${evento.id || 'N/A'}</td>
        <td>${formatarData(evento.data)}</td>
        <td><strong>${evento.cliente || 'N/A'}</strong></td>
        <td>${evento.local || 'N/A'}</td>
        <td style="font-weight: bold;">${formatarMoeda(valorTotal)}</td>
        <td style="color: #28a745;">${formatarMoeda(valorPago)}</td>
        <td style="color: #dc3545;">${formatarMoeda(pendente)}</td>
        <td><span class="status-badge ${statusClass}">${statusTexto}</span></td>
        <td>${formaPagamento}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhuma receita encontrada</td></tr>';
}

function filtrarReceitas() {
  carregarRelatorioReceitas();
}

function resetarFiltrosReceitas() {
  document.getElementById('periodoReceitas').value = 'todos';
  document.getElementById('statusReceitas').value = 'todos';
  carregarRelatorioReceitas();
}

function exportarReceitas() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  
  let csv = 'ID Evento;Data;Cliente;Local;Valor Total;Valor Recebido;Valor Pendente;Status;Forma Pagamento\n';
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    const valorPago = calcularValorPago(evento);
    const pendente = valorTotal - valorPago;
    
    let status = 'Pendente';
    if (valorPago >= valorTotal) status = 'Pago';
    else if (valorPago > 0) status = 'Parcial';
    
    let formaPagamento = 'N√£o definida';
    if (evento.forma_pagamento_sinal) formaPagamento = evento.forma_pagamento_sinal;
    
    csv += `${evento.id || ''};`;
    csv += `${evento.data || ''};`;
    csv += `${evento.cliente || ''};`;
    csv += `${evento.local || ''};`;
    csv += `${valorTotal.toFixed(2)};`;
    csv += `${valorPago.toFixed(2)};`;
    csv += `${pendente.toFixed(2)};`;
    csv += `${status};`;
    csv += `${formaPagamento}\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `relatorio_receitas_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

// ==================== FUN√á√ïES PARA RELAT√ìRIO DE DESPESAS ====================

function carregarRelatorioDespesas() {
  // Carregar dados de diferentes fontes
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
  
  // Criar array de despesas
  let despesas = [];
  
  // Adicionar elenco como despesa
  elenco.forEach(membro => {
    // Valor estimado por membro
    const valorEstimado = 150.00; // Exemplo: R$ 150 por evento
    despesas.push({
      tipo: 'elenco',
      descricao: `Cache ${membro.nome || membro.nome_elenco}`,
      beneficiario: membro.nome || membro.nome_elenco,
      valor: valorEstimado,
      status: 'pendente',
      formaPagamento: 'PIX'
    });
  });
  
  // Adicionar motoristas
  motoristas.forEach(motorista => {
    const valorEstimado = 200.00; // Exemplo: R$ 200 por evento
    despesas.push({
      tipo: 'motoristas',
      descricao: `Transporte ${motorista.veiculo_motoristas || ''}`,
      beneficiario: motorista.nome || motorista.nome_motoristas,
      valor: valorEstimado,
      status: 'pendente',
      formaPagamento: 'PIX'
    });
  });
  
  // Adicionar funcion√°rios (sal√°rios)
  funcionarios.forEach(funcionario => {
    const salario = 2500.00; // Exemplo: R$ 2.500 mensal
    despesas.push({
      tipo: 'funcionarios',
      descricao: 'Sal√°rio mensal',
      beneficiario: funcionario.nome || funcionario.nome_funcionarios,
      valor: salario,
      status: 'pendente',
      formaPagamento: 'Transfer√™ncia'
    });
  });
  
  // Adicionar fornecedores
  fornecedores.forEach(fornecedor => {
    const valorEstimado = 500.00; // Exemplo: R$ 500 por servi√ßo
    despesas.push({
      tipo: 'fornecedores',
      descricao: `Servi√ßo ${fornecedor.nome_fornecedores || ''}`,
      beneficiario: fornecedor.nome_fornecedores,
      valor: valorEstimado,
      status: 'pendente',
      formaPagamento: 'Transfer√™ncia'
    });
  });
  
  // Atualizar totais e tabela
  atualizarTotaisDespesas(despesas);
  atualizarTabelaDespesas(despesas);
  atualizarDistribuicaoDespesas(despesas);
}

function atualizarTotaisDespesas(despesas) {
  const totalDespesas = despesas.reduce((total, item) => total + item.valor, 0);
  const totalPago = despesas.filter(d => d.status === 'pago').reduce((total, item) => total + item.valor, 0);
  const totalPendente = totalDespesas - totalPago;
  const mediaDespesa = despesas.length > 0 ? totalDespesas / despesas.length : 0;
  
  document.getElementById('totalDespesas').textContent = formatarMoeda(totalDespesas);
  document.getElementById('totalPagoDespesas').textContent = formatarMoeda(totalPago);
  document.getElementById('totalPendenteDespesas').textContent = formatarMoeda(totalPendente);
  document.getElementById('mediaDespesa').textContent = formatarMoeda(mediaDespesa);
}

function atualizarTabelaDespesas(despesas) {
  const tipoFiltro = document.getElementById('tipoDespesa').value;
  const statusFiltro = document.getElementById('statusDespesas').value;
  
  let despesasFiltradas = despesas;
  
  // Aplicar filtros
  if (tipoFiltro !== 'todos') {
    despesasFiltradas = despesasFiltradas.filter(d => d.tipo === tipoFiltro);
  }
  
  if (statusFiltro !== 'todos') {
    despesasFiltradas = despesasFiltradas.filter(d => d.status === statusFiltro);
  }
  
  const tabela = document.getElementById('tabelaDespesas');
  let html = '';
  
  despesasFiltradas.forEach((despesa, index) => {
    const dataVencimento = new Date();
    dataVencimento.setDate(dataVencimento.getDate() + 30); // 30 dias a partir de hoje
    
    const tipoTexto = {
      'elenco': 'Elenco',
      'motoristas': 'Motoristas',
      'funcionarios': 'Funcion√°rios',
      'fornecedores': 'Fornecedores',
      'outros': 'Outros'
    }[despesa.tipo] || despesa.tipo;
    
    html += `
      <tr>
        <td><span class="badge-${despesa.tipo}">${tipoTexto}</span></td>
        <td>${despesa.descricao}</td>
        <td><strong>${despesa.beneficiario}</strong></td>
        <td>${dataVencimento.toLocaleDateString('pt-BR')}</td>
        <td style="font-weight: bold; color: #dc3545;">${formatarMoeda(despesa.valor)}</td>
        <td><span class="status-badge status-${despesa.status}">${despesa.status === 'pago' ? 'Pago' : 'Pendente'}</span></td>
        <td>${despesa.status === 'pago' ? new Date().toLocaleDateString('pt-BR') : 'N/A'}</td>
        <td>${despesa.formaPagamento}</td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="8" style="text-align: center; padding: 2rem;">Nenhuma despesa encontrada</td></tr>';
}

function atualizarDistribuicaoDespesas(despesas) {
  const container = document.getElementById('distribuicaoDespesas');
  
  // Agrupar por tipo
  const agrupadas = {};
  despesas.forEach(despesa => {
    if (!agrupadas[despesa.tipo]) {
      agrupadas[despesa.tipo] = {
        total: 0,
        quantidade: 0
      };
    }
    agrupadas[despesa.tipo].total += despesa.valor;
    agrupadas[despesa.tipo].quantidade++;
  });
  
  const totalGeral = despesas.reduce((total, item) => total + item.valor, 0);
  
  let html = '';
  
  Object.entries(agrupadas).forEach(([tipo, dados]) => {
    const percentual = totalGeral > 0 ? ((dados.total / totalGeral) * 100).toFixed(1) : 0;
    const tipoTexto = {
      'elenco': 'Elenco',
      'motoristas': 'Motoristas',
      'funcionarios': 'Funcion√°rios',
      'fornecedores': 'Fornecedores',
      'outros': 'Outros'
    }[tipo] || tipo;
    
    html += `
      <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
          <strong>${tipoTexto}</strong>
          <span style="font-weight: bold; color: #dc3545;">${formatarMoeda(dados.total)}</span>
        </div>
        <div style="height: 8px; background: #e2e3e5; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem;">
          <div style="height: 100%; background: ${getCorPorTipo(tipo)}; width: ${percentual}%"></div>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: #666;">
          <span>${dados.quantidade} item${dados.quantidade !== 1 ? 's' : ''}</span>
          <span>${percentual}%</span>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function getCorPorTipo(tipo) {
  const cores = {
    'elenco': '#007bff',
    'motoristas': '#20c997',
    'funcionarios': '#fd7e14',
    'fornecedores': '#6f42c1',
    'outros': '#6c757d'
  };
  return cores[tipo] || '#6c757d';
}

function filtrarDespesas() {
  // Recarregar as despesas e aplicar filtros
  carregarRelatorioDespesas();
}

function resetarFiltrosDespesas() {
  document.getElementById('tipoDespesa').value = 'todos';
  document.getElementById('statusDespesas').value = 'todos';
  carregarRelatorioDespesas();
}

function exportarDespesas() {
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
  
  let csv = 'Tipo;Descri√ß√£o;Benefici√°rio;Valor Estimado;Status;Forma Pagamento\n';
  
  // Exportar elenco
  elenco.forEach(membro => {
    csv += `Elenco;Cache ${membro.nome || membro.nome_elenco};${membro.nome || membro.nome_elenco};150.00;Pendente;PIX\n`;
  });
  
  // Exportar motoristas
  motoristas.forEach(motorista => {
    csv += `Motoristas;Transporte ${motorista.veiculo_motoristas || ''};${motorista.nome || motorista.nome_motoristas};200.00;Pendente;PIX\n`;
  });
  
  // Exportar funcion√°rios
  funcionarios.forEach(funcionario => {
    csv += `Funcion√°rios;Sal√°rio mensal;${funcionario.nome || funcionario.nome_funcionarios};2500.00;Pendente;Transfer√™ncia\n`;
  });
  
  // Exportar fornecedores
  fornecedores.forEach(fornecedor => {
    csv += `Fornecedores;Servi√ßo ${fornecedor.nome_fornecedores || ''};${fornecedor.nome_fornecedores};500.00;Pendente;Transfer√™ncia\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `relatorio_despesas_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

// ==================== FUN√á√ïES PARA RELAT√ìRIO DE LUCROS ====================

function calcularLucros() {
  const periodo = document.getElementById('periodoLucros').value;
  
  // Calcular receitas
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  let receitas = 0;
  
  eventos.forEach(evento => {
    const valorTotal = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    
    // Filtrar por per√≠odo
    const dataEvento = new Date(evento.data);
    const hoje = new Date();
    let incluir = false;
    
    switch(periodo) {
      case 'mes_atual':
        incluir = dataEvento.getMonth() === hoje.getMonth() && 
                  dataEvento.getFullYear() === hoje.getFullYear();
        break;
      case 'mes_anterior':
        const mesAnterior = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1);
        incluir = dataEvento.getMonth() === mesAnterior.getMonth() && 
                  dataEvento.getFullYear() === mesAnterior.getFullYear();
        break;
      case 'trimestre':
        const tresMesesAtras = new Date(hoje.getFullYear(), hoje.getMonth() - 2, 1);
        incluir = dataEvento >= tresMesesAtras;
        break;
      case 'semestre':
        const seisMesesAtras = new Date(hoje.getFullYear(), hoje.getMonth() - 5, 1);
        incluir = dataEvento >= seisMesesAtras;
        break;
      case 'ano':
        incluir = dataEvento.getFullYear() === hoje.getFullYear();
        break;
      case 'todos':
        incluir = true;
        break;
    }
    
    if (incluir) {
      receitas += valorTotal;
    }
  });
  
  // Calcular despesas (estimativas)
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]').length;
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]').length;
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]').length;
  const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]').length;
  
  const despesasElenco = elenco * 150;
  const despesasMotoristas = motoristas * 200;
  const despesasFuncionarios = funcionarios * 2500;
  const despesasFornecedores = fornecedores * 500;
  
  const despesas = despesasElenco + despesasMotoristas + despesasFuncionarios + despesasFornecedores;
  const lucro = receitas - despesas;
  const margem = receitas > 0 ? ((lucro / receitas) * 100).toFixed(1) : 0;
  
  // Atualizar resumo
  document.getElementById('resumoReceitas').textContent = formatarMoeda(receitas);
  document.getElementById('resumoDespesas').textContent = formatarMoeda(despesas);
  document.getElementById('resumoLucro').textContent = formatarMoeda(lucro);
  document.getElementById('resumoMargem').textContent = `${margem}%`;
  
  // Atualizar gr√°fico
  atualizarGraficoLucros(receitas, despesas, lucro);
  
  // Atualizar an√°lise
  atualizarAnaliseLucros(despesasElenco, despesasMotoristas, despesasFuncionarios, despesasFornecedores, receitas);
}

function atualizarGraficoLucros(receitas, despesas, lucro) {
  const container = document.getElementById('graficoLucros');
  const maxValor = Math.max(receitas, despesas, Math.abs(lucro));
  const alturaMaxima = 250; // altura m√°xima em pixels
  
  // Criar meses fict√≠cios para o gr√°fico
  const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
  const hoje = new Date();
  const mesAtual = hoje.getMonth();
  
  container.innerHTML = '';
  
  // Gerar 6 meses de dados (3 anteriores, atual, 2 futuros)
  for (let i = -3; i <= 2; i++) {
    const mesIndex = (mesAtual + i + 12) % 12;
    const mesNome = meses[mesIndex];
    
    // Valores fict√≠cios baseados no per√≠odo
    let receitaMes = receitas / 6 * (1 + Math.random() * 0.3);
    let despesaMes = despesas / 6 * (1 + Math.random() * 0.2);
    let lucroMes = receitaMes - despesaMes;
    
    const alturaReceita = (receitaMes / maxValor) * alturaMaxima;
    const alturaDespesa = (despesaMes / maxValor) * alturaMaxima;
    const alturaLucro = (Math.abs(lucroMes) / maxValor) * alturaMaxima;
    
    container.innerHTML += `
      <div class="barra-grafico">
        <div style="display: flex; flex-direction: column; align-items: center; height: 100%;">
          <!-- Lucro (pode ser negativo) -->
          <div style="width: 20px; background: ${lucroMes >= 0 ? '#007bff' : '#dc3545'}; height: ${alturaLucro}px; border-radius: 4px 4px 0 0;"></div>
          <!-- Receitas -->
          <div style="width: 20px; background: #28a745; height: ${alturaReceita}px;"></div>
          <!-- Despesas -->
          <div style="width: 20px; background: #dc3545; height: ${alturaDespesa}px; border-radius: 0 0 4px 4px;"></div>
        </div>
        <div class="barra-label">${mesNome}</div>
      </div>
    `;
  }
}

function atualizarAnaliseLucros(despesasElenco, despesasMotoristas, despesasFuncionarios, despesasFornecedores, receitas) {
  const tabela = document.getElementById('tabelaAnaliseLucros');
  const despesasTotal = despesasElenco + despesasMotoristas + despesasFuncionarios + despesasFornecedores;
  
  const analises = [
    { tipo: 'Elenco', valor: despesasElenco },
    { tipo: 'Motoristas', valor: despesasMotoristas },
    { tipo: 'Funcion√°rios', valor: despesasFuncionarios },
    { tipo: 'Fornecedores', valor: despesasFornecedores }
  ];
  
  let html = '';
  
  analises.forEach(analise => {
    const percentDespesas = despesasTotal > 0 ? ((analise.valor / despesasTotal) * 100).toFixed(1) : 0;
    const percentReceitas = receitas > 0 ? ((analise.valor / receitas) * 100).toFixed(1) : 0;
    
    // Determinar recomenda√ß√£o
    let recomendacao = '‚úÖ Adequado';
    if (percentReceitas > 30) recomendacao = '‚ö†Ô∏è Alto';
    if (percentReceitas > 50) recomendacao = '‚ùå Muito Alto';
    
    html += `
      <tr>
        <td><strong>${analise.tipo}</strong></td>
        <td style="font-weight: bold; color: #dc3545;">${formatarMoeda(analise.valor)}</td>
        <td>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div style="width: 60px; height: 20px; background: #e2e3e5; border-radius: 10px; overflow: hidden;">
              <div style="height: 100%; background: #dc3545; width: ${percentDespesas}%"></div>
            </div>
            <span>${percentDespesas}%</span>
          </div>
        </td>
        <td>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div style="width: 60px; height: 20px; background: #e2e3e5; border-radius: 10px; overflow: hidden;">
              <div style="height: 100%; background: #28a745; width: ${Math.min(percentReceitas, 100)}%"></div>
            </div>
            <span>${percentReceitas}%</span>
          </div>
        </td>
        <td>
          <span class="badge-${recomendacao.includes('‚úÖ') ? 'success' : recomendacao.includes('‚ö†Ô∏è') ? 'warning' : 'danger'}">
            ${recomendacao}
          </span>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
}

function exportarLucros() {
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
  
  // Calcular totais
  let receitasTotal = 0;
  eventos.forEach(evento => {
    const valor = parseFloat(evento.valor_total?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
    receitasTotal += valor;
  });
  
  const despesasElenco = elenco.length * 150;
  const despesasMotoristas = motoristas.length * 200;
  const despesasFuncionarios = funcionarios.length * 2500;
  const despesasFornecedores = fornecedores.length * 500;
  const despesasTotal = despesasElenco + despesasMotoristas + despesasFuncionarios + despesasFornecedores;
  
  const lucro = receitasTotal - despesasTotal;
  const margem = receitasTotal > 0 ? ((lucro / receitasTotal) * 100).toFixed(1) : 0;
  
  let csv = 'Item;Valor;Descri√ß√£o\n';
  csv += `Receitas Totais;${receitasTotal.toFixed(2)};Receitas de todos os eventos\n`;
  csv += `Despesas Elenco;${despesasElenco.toFixed(2)};Cache para ${elenco.length} membros do elenco\n`;
  csv += `Despesas Motoristas;${despesasMotoristas.toFixed(2)};Transporte para ${motoristas.length} motoristas\n`;
  csv += `Despesas Funcion√°rios;${despesasFuncionarios.toFixed(2)};Sal√°rios para ${funcionarios.length} funcion√°rios\n`;
  csv += `Despesas Fornecedores;${despesasFornecedores.toFixed(2)};Servi√ßos de ${fornecedores.length} fornecedores\n`;
  csv += `Despesas Totais;${despesasTotal.toFixed(2)};Soma de todas as despesas\n`;
  csv += `Lucro L√≠quido;${lucro.toFixed(2)};Receitas - Despesas\n`;
  csv += `Margem de Lucro;${margem}%;(Lucro / Receitas) √ó 100\n`;
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `relatorio_lucros_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

// ==================== FUN√á√ïES PARA RELAT√ìRIOS DE EQUIPE ====================

function carregarRelatorioElenco() {
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const eventos = JSON.parse(localStorage.getItem('eventos') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  
  // Atualizar estat√≠sticas
  const totalElenco = elenco.length;
  let idadeTotal = 0;
  let idadeContador = 0;
  let elencoComEventos = 0;
  
  elenco.forEach(membro => {
    // Calcular idade
    if (membro.data_nascimento_elenco) {
      const nascimento = new Date(membro.data_nascimento_elenco);
      const hoje = new Date();
      let idade = hoje.getFullYear() - nascimento.getFullYear();
      const mes = hoje.getMonth() - nascimento.getMonth();
      if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
      }
      idadeTotal += idade;
      idadeContador++;
    }
    
    // Verificar se participou de eventos
    let participouEventos = false;
    escalas.forEach(escala => {
      if (escala.elenco && escala.elenco.includes(membro.id)) {
        participouEventos = true;
      }
    });
    
    if (participouEventos) elencoComEventos++;
  });
  
  const idadeMedia = idadeContador > 0 ? Math.round(idadeTotal / idadeContador) : 0;
  const elencoSemEventos = totalElenco - elencoComEventos;
  
  document.getElementById('totalElenco').textContent = totalElenco;
  document.getElementById('idadeMediaElenco').textContent = `${idadeMedia} anos`;
  document.getElementById('elencoComEventos').textContent = elencoComEventos;
  document.getElementById('elencoSemEventos').textContent = elencoSemEventos;
  
  // Atualizar filtro de cidades
  atualizarFiltroCidades(elenco, 'cidadeElenco');
  
  // Atualizar tabela
  atualizarTabelaRelatorioElenco(elenco, escalas);
}

function atualizarTabelaRelatorioElenco(elenco, escalas) {
  const busca = document.getElementById('buscarElenco').value.toLowerCase();
  const cidade = document.getElementById('cidadeElenco').value;
  
  const tabela = document.getElementById('tabelaElenco');
  let html = '';
  
  elenco.forEach(membro => {
    // Aplicar filtros
    const nome = (membro.nome || membro.nome_elenco || '').toLowerCase();
    const membroCidade = (membro.cidade_elenco || '').toLowerCase();
    
    if (busca && !nome.includes(busca)) return;
    if (cidade !== 'todos' && membroCidade !== cidade.toLowerCase()) return;
    
    // Calcular idade
    let idade = 'N/A';
    if (membro.data_nascimento_elenco) {
      const nascimento = new Date(membro.data_nascimento_elenco);
      const hoje = new Date();
      idade = hoje.getFullYear() - nascimento.getFullYear();
      const mes = hoje.getMonth() - nascimento.getMonth();
      if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
      }
    }
    
    // Contar eventos participados
    let eventosParticipados = 0;
    escalas.forEach(escala => {
      if (escala.elenco && escala.elenco.includes(membro.id)) {
        eventosParticipados++;
      }
    });
    
    const status = eventosParticipados > 0 ? 'Ativo' : 'Inativo';
    const statusClass = eventosParticipados > 0 ? 'ativo' : 'inativo';
    
    html += `
      <tr>
        <td><strong>${membro.nome || membro.nome_elenco || 'N√£o informado'}</strong></td>
        <td>${membro.doc_elenco_cadastro || 'N√£o informado'}</td>
        <td>${idade}</td>
        <td>${membro.telefone_elenco || 'N√£o informado'}</td>
        <td>${membro.email_elenco || 'N√£o informado'}</td>
        <td>${membro.cidade_elenco || 'N√£o informado'}</td>
        <td style="text-align: center; font-weight: bold;">${eventosParticipados}</td>
        <td><span class="status-badge status-${statusClass}">${status}</span></td>
        <td>
          <button class="btn-small" onclick="editarCadastroEquipe('${membro.id}', 'elenco')">
            ‚úèÔ∏è Editar
          </button>
          <button class="btn-small" onclick="verDetalhesEquipe('${membro.id}', 'elenco')">
            üëÅÔ∏è Ver
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum membro do elenco encontrado</td></tr>';
}

function carregarRelatorioMotoristas() {
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  
  // Estat√≠sticas
  const totalMotoristas = motoristas.length;
  
  // Contar tipos de ve√≠culos √∫nicos
  const tiposVeiculos = new Set();
  motoristas.forEach(motorista => {
    if (motorista.veiculo_motoristas) {
      tiposVeiculos.add(motorista.veiculo_motoristas.toLowerCase());
    }
  });
  
  // Contar motoristas com eventos
  let motoristasComEventos = 0;
  motoristas.forEach(motorista => {
    let participouEventos = false;
    escalas.forEach(escala => {
      if (escala.motorista === motorista.id) {
        participouEventos = true;
      }
    });
    if (participouEventos) motoristasComEventos++;
  });
  
  document.getElementById('totalMotoristas').textContent = totalMotoristas;
  document.getElementById('tiposVeiculos').textContent = tiposVeiculos.size;
  document.getElementById('motoristasComEventos').textContent = motoristasComEventos;
  
  // Atualizar tabela
  atualizarTabelaRelatorioMotoristas(motoristas, escalas);
}

function atualizarTabelaRelatorioMotoristas(motoristas, escalas) {
  const tipoVeiculo = document.getElementById('tipoVeiculo').value.toLowerCase();
  
  const tabela = document.getElementById('tabelaMotoristas');
  let html = '';
  
  motoristas.forEach(motorista => {
    // Aplicar filtro de tipo de ve√≠culo
    const veiculo = (motorista.veiculo_motoristas || '').toLowerCase();
    if (tipoVeiculo !== 'todos' && !veiculo.includes(tipoVeiculo)) {
      // Verificar categoria do ve√≠culo
      if (tipoVeiculo === 'carro' && !veiculo.includes('carro')) return;
      if (tipoVeiculo === 'van' && !veiculo.includes('van')) return;
      if (tipoVeiculo === 'caminhonete' && !veiculo.includes('caminhonete') && !veiculo.includes('pickup')) return;
      if (tipoVeiculo === 'outros' && (veiculo.includes('carro') || veiculo.includes('van') || veiculo.includes('caminhonete') || veiculo.includes('pickup'))) return;
    }
    
    // Contar eventos participados
    let eventosParticipados = 0;
    escalas.forEach(escala => {
      if (escala.motorista === motorista.id) {
        eventosParticipados++;
      }
    });
    
    const status = eventosParticipados > 0 ? 'Ativo' : 'Inativo';
    const statusClass = eventosParticipados > 0 ? 'ativo' : 'inativo';
    
    html += `
      <tr>
        <td><strong>${motorista.nome || motorista.nome_motoristas || 'N√£o informado'}</strong></td>
        <td>${motorista.cnh_motoristas || 'N√£o informado'}</td>
        <td>${motorista.veiculo_motoristas || 'N√£o informado'}</td>
        <td>${motorista.telefone_motoristas || 'N√£o informado'}</td>
        <td>${motorista.chave_pix_motoristas || 'N√£o informado'}</td>
        <td style="text-align: center; font-weight: bold;">${eventosParticipados}</td>
        <td><span class="status-badge status-${statusClass}">${status}</span></td>
        <td>
          <button class="btn-small" onclick="editarCadastroEquipe('${motorista.id}', 'motoristas')">
            ‚úèÔ∏è Editar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="8" style="text-align: center; padding: 2rem;">Nenhum motorista encontrado</td></tr>';
}

function carregarRelatorioProducao() {
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  
  // Estat√≠sticas
  const totalProducao = funcionarios.length;
  let producaoAtivos = 0;
  
  funcionarios.forEach(funcionario => {
    let participouEventos = false;
    escalas.forEach(escala => {
      if (escala.producao && escala.producao.includes(funcionario.id)) {
        participouEventos = true;
      }
    });
    if (participouEventos) producaoAtivos++;
  });
  
  document.getElementById('totalProducao').textContent = totalProducao;
  document.getElementById('producaoAtivos').textContent = producaoAtivos;
  
  // Atualizar tabela
  atualizarTabelaRelatorioProducao(funcionarios, escalas);
}

function atualizarTabelaRelatorioProducao(funcionarios, escalas) {
  const tabela = document.getElementById('tabelaProducao');
  let html = '';
  
  funcionarios.forEach(funcionario => {
    // Contar eventos participados (como produ√ß√£o)
    let eventosParticipados = 0;
    escalas.forEach(escala => {
      if (escala.producao && escala.producao.includes(funcionario.id)) {
        eventosParticipados++;
      }
    });
    
    const status = eventosParticipados > 0 ? 'Ativo' : 'Inativo';
    const statusClass = eventosParticipados > 0 ? 'ativo' : 'inativo';
    
    html += `
      <tr>
        <td><strong>${funcionario.nome || funcionario.nome_funcionarios || 'N√£o informado'}</strong></td>
        <td>Produ√ß√£o</td>
        <td>${funcionario.doc_funcionarios_cadastro || 'N√£o informado'}</td>
        <td>${funcionario.telefone_funcionarios || 'N√£o informado'}</td>
        <td>${funcionario.email_funcionarios || 'N√£o informado'}</td>
        <td style="text-align: center; font-weight: bold;">${eventosParticipados}</td>
        <td><span class="status-badge status-${statusClass}">${status}</span></td>
        <td>
          <button class="btn-small" onclick="editarCadastroEquipe('${funcionario.id}', 'funcionarios')">
            ‚úèÔ∏è Editar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="8" style="text-align: center; padding: 2rem;">Nenhum membro da produ√ß√£o encontrado</td></tr>';
}

function carregarRelatorioFuncionarios() {
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  
  // Estat√≠sticas
  const totalFuncionarios = funcionarios.length;
  let idadeTotal = 0;
  let idadeContador = 0;
  let folhaMensal = 0;
  
  funcionarios.forEach(funcionario => {
    // Calcular idade
    if (funcionario.data_nascimento_funcionarios) {
      const nascimento = new Date(funcionario.data_nascimento_funcionarios);
      const hoje = new Date();
      let idade = hoje.getFullYear() - nascimento.getFullYear();
      const mes = hoje.getMonth() - nascimento.getMonth();
      if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
      }
      idadeTotal += idade;
      idadeContador++;
    }
    
    // Adicionar sal√°rio (exemplo)
    folhaMensal += 2500; // R$ 2.500 por funcion√°rio
  });
  
  const idadeMedia = idadeContador > 0 ? Math.round(idadeTotal / idadeContador) : 0;
  
  document.getElementById('totalFuncionarios').textContent = totalFuncionarios;
  document.getElementById('idadeMediaFuncionarios').textContent = `${idadeMedia} anos`;
  document.getElementById('folhaMensal').textContent = formatarMoeda(folhaMensal);
  
  // Atualizar tabela
  atualizarTabelaRelatorioFuncionarios(funcionarios);
}

function atualizarTabelaRelatorioFuncionarios(funcionarios) {
  const cargo = document.getElementById('cargoFuncionarios').value;
  
  const tabela = document.getElementById('tabelaFuncionarios');
  let html = '';
  
  funcionarios.forEach(funcionario => {
    // Aplicar filtro de cargo
    const funcionarioCargo = (funcionario.cargo || 'funcionario').toLowerCase();
    if (cargo !== 'todos') {
      if (cargo === 'administrativo' && !funcionarioCargo.includes('admin')) return;
      if (cargo === 'producao' && !funcionarioCargo.includes('prod')) return;
      if (cargo === 'coordena√ß√£o' && !funcionarioCargo.includes('coord')) return;
      if (cargo === 'outros' && (funcionarioCargo.includes('admin') || funcionarioCargo.includes('prod') || funcionarioCargo.includes('coord'))) return;
    }
    
    // Calcular idade
    let idade = 'N/A';
    if (funcionario.data_nascimento_funcionarios) {
      const nascimento = new Date(funcionario.data_nascimento_funcionarios);
      const hoje = new Date();
      idade = hoje.getFullYear() - nascimento.getFullYear();
      const mes = hoje.getMonth() - nascimento.getMonth();
      if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
        idade--;
      }
    }
    
    html += `
      <tr>
        <td><strong>${funcionario.nome || funcionario.nome_funcionarios || 'N√£o informado'}</strong></td>
        <td>${funcionario.cargo || 'Funcion√°rio'}</td>
        <td>${funcionario.doc_funcionarios_cadastro || 'N√£o informado'}</td>
        <td>${funcionario.telefone_funcionarios || 'N√£o informado'}</td>
        <td>${funcionario.email_funcionarios || 'N√£o informado'}</td>
        <td style="font-weight: bold; color: #28a745;">R$ 2.500,00</td>
        <td>${funcionario.data_admissao || 'N/A'}</td>
        <td><span class="status-badge status-ativo">Ativo</span></td>
        <td>
          <button class="btn-small" onclick="editarCadastroEquipe('${funcionario.id}', 'funcionarios')">
            ‚úèÔ∏è Editar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum funcion√°rio encontrado</td></tr>';
}

function carregarRelatorioFornecedores() {
  const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
  
  // Estat√≠sticas
  const totalFornecedores = fornecedores.length;
  let tempoTotal = 0;
  let tempoContador = 0;
  let gastoTotal = 0;
  
  fornecedores.forEach(fornecedor => {
    // Calcular tempo de empresa
    if (fornecedor.data_abertura_fornecedores) {
      const abertura = new Date(fornecedor.data_abertura_fornecedores);
      const hoje = new Date();
      let anos = hoje.getFullYear() - abertura.getFullYear();
      const mes = hoje.getMonth() - abertura.getMonth();
      if (mes < 0 || (mes === 0 && hoje.getDate() < abertura.getDate())) {
        anos--;
      }
      tempoTotal += anos;
      tempoContador++;
    }
    
    // Adicionar gasto estimado
    gastoTotal += 500; // R$ 500 por fornecedor
  });
  
  const tempoMedio = tempoContador > 0 ? Math.round(tempoTotal / tempoContador) : 0;
  
  document.getElementById('totalFornecedores').textContent = totalFornecedores;
  document.getElementById('tempoMedioFornecedores').textContent = `${tempoMedio} anos`;
  document.getElementById('gastoTotalFornecedores').textContent = formatarMoeda(gastoTotal);
  
  // Atualizar filtro de cidades
  atualizarFiltroCidades(fornecedores, 'cidadeFornecedores');
  
  // Atualizar tabela
  atualizarTabelaRelatorioFornecedores(fornecedores);
}

function atualizarTabelaRelatorioFornecedores(fornecedores) {
  const tipo = document.getElementById('tipoFornecedor').value;
  const cidade = document.getElementById('cidadeFornecedores').value;
  
  const tabela = document.getElementById('tabelaFornecedores');
  let html = '';
  
  fornecedores.forEach(fornecedor => {
    // Aplicar filtros
    const fornecedorTipo = (fornecedor.tipo || 'outros').toLowerCase();
    const fornecedorCidade = (fornecedor.cidade_fornecedores || '').toLowerCase();
    
    if (tipo !== 'todos' && fornecedorTipo !== tipo.toLowerCase()) return;
    if (cidade !== 'todos' && fornecedorCidade !== cidade.toLowerCase()) return;
    
    // Calcular tempo de empresa
    let tempoEmpresa = 'N/A';
    if (fornecedor.data_abertura_fornecedores) {
      const abertura = new Date(fornecedor.data_abertura_fornecedores);
      const hoje = new Date();
      let anos = hoje.getFullYear() - abertura.getFullYear();
      const mes = hoje.getMonth() - abertura.getMonth();
      if (mes < 0 || (mes === 0 && hoje.getDate() < abertura.getDate())) {
        anos--;
      }
      tempoEmpresa = `${anos} anos`;
    }
    
    const tipoTexto = {
      'figurino': 'Figurino',
      'alimentacao': 'Alimenta√ß√£o',
      'transporte': 'Transporte',
      'equipamento': 'Equipamento',
      'outros': 'Outros'
    }[fornecedorTipo] || 'Outros';
    
    html += `
      <tr>
        <td><strong>${fornecedor.nome || fornecedor.nome_fornecedores || 'N√£o informado'}</strong></td>
        <td>${fornecedor.doc_fornecedores_cadastro || 'N√£o informado'}</td>
        <td><span class="badge-${fornecedorTipo}">${tipoTexto}</span></td>
        <td>${fornecedor.telefone_fornecedores || 'N√£o informado'}</td>
        <td>${fornecedor.email_fornecedores || 'N√£o informado'}</td>
        <td>${fornecedor.cidade_fornecedores || 'N√£o informado'}</td>
        <td>${tempoEmpresa}</td>
        <td><span class="status-badge status-ativo">Ativo</span></td>
        <td>
          <button class="btn-small" onclick="editarCadastroEquipe('${fornecedor.id}', 'fornecedores')">
            ‚úèÔ∏è Editar
          </button>
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html || '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Nenhum fornecedor encontrado</td></tr>';
}

// ==================== FUN√á√ïES AUXILIARES ====================

function calcularValorPago(evento) {
  let valorPago = 0;
  
  // Verificar sinal pago
  if (evento.sinal_pago_status === 'true') {
    valorPago += parseFloat(evento.valor_sinal?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  // Verificar valor avulso pago
  if (evento.valor_avulso_pago === 'true') {
    valorPago += parseFloat(evento.valor_avulso?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  // Verificar valor restante pago
  if (evento.valor_restante_recebido === 'true') {
    valorPago += parseFloat(evento.valor_falta_receber?.replace('R$', '').replace('.', '').replace(',', '.') || 0);
  }
  
  return valorPago;
}

function formatarMoeda(valor) {
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(valor);
}

function formatarData(dataString) {
  if (!dataString) return 'N/A';
  const [ano, mes, dia] = dataString.split('-');
  return `${dia}/${mes}/${ano}`;
}

function atualizarFiltroCidades(dados, selectId) {
  const select = document.getElementById(selectId);
  const cidades = new Set();
  
  dados.forEach(item => {
    const cidade = item.cidade_elenco || item.cidade_fornecedores || item.cidade_motoristas || item.cidade_funcionarios;
    if (cidade) {
      cidades.add(cidade);
    }
  });
  
  let options = '<option value="todos">Todas</option>';
  Array.from(cidades).sort().forEach(cidade => {
    options += `<option value="${cidade.toLowerCase()}">${cidade}</option>`;
  });
  
  select.innerHTML = options;
}

function filtrarElenco() {
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  atualizarTabelaRelatorioElenco(elenco, escalas);
}

function resetarFiltrosElenco() {
  document.getElementById('buscarElenco').value = '';
  document.getElementById('cidadeElenco').value = 'todos';
  const elenco = JSON.parse(localStorage.getItem('elenco') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  atualizarTabelaRelatorioElenco(elenco, escalas);
}

function filtrarMotoristas() {
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  atualizarTabelaRelatorioMotoristas(motoristas, escalas);
}

function resetarFiltrosMotoristas() {
  document.getElementById('tipoVeiculo').value = 'todos';
  const motoristas = JSON.parse(localStorage.getItem('motoristas') || '[]');
  const escalas = JSON.parse(localStorage.getItem('escalas') || '[]');
  atualizarTabelaRelatorioMotoristas(motoristas, escalas);
}

function filtrarFuncionarios() {
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  atualizarTabelaRelatorioFuncionarios(funcionarios);
}

function resetarFiltrosFuncionarios() {
  document.getElementById('cargoFuncionarios').value = 'todos';
  const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
  atualizarTabelaRelatorioFuncionarios(funcionarios);
}

function filtrarFornecedores() {
  const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
  atualizarTabelaRelatorioFornecedores(fornecedores);
}

function resetarFiltrosFornecedores() {
  document.getElementById('tipoFornecedor').value = 'todos';
  document.getElementById('cidadeFornecedores').value = 'todos';
  const fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
  atualizarTabelaRelatorioFornecedores(fornecedores);
}

function exportarRelatorioEquipe(tipo) {
  let dados = [];
  let nomeArquivo = '';
  let cabecalho = '';
  
  switch(tipo) {
    case 'elenco':
      dados = JSON.parse(localStorage.getItem('elenco') || '[]');
      nomeArquivo = 'relatorio_elenco';
      cabecalho = 'Nome;Documento;Idade;Telefone;Email;Cidade;Status\n';
      break;
    case 'motoristas':
      dados = JSON.parse(localStorage.getItem('motoristas') || '[]');
      nomeArquivo = 'relatorio_motoristas';
      cabecalho = 'Nome;CNH;Ve√≠culo;Telefone;Chave PIX;Status\n';
      break;
    case 'funcionarios':
      dados = JSON.parse(localStorage.getItem('funcionarios') || '[]');
      nomeArquivo = 'relatorio_funcionarios';
      cabecalho = 'Nome;Cargo;Documento;Telefone;Email;Sal√°rio;Status\n';
      break;
    case 'fornecedores':
      dados = JSON.parse(localStorage.getItem('fornecedores') || '[]');
      nomeArquivo = 'relatorio_fornecedores';
      cabecalho = 'Empresa;CNPJ;Tipo;Telefone;Email;Cidade;Tempo Empresa;Status\n';
      break;
    default:
      return;
  }
  
  if (dados.length === 0) {
    alert('N√£o h√° dados para exportar!');
    return;
  }
  
  let csv = cabecalho;
  
  dados.forEach(item => {
    switch(tipo) {
      case 'elenco':
        csv += `${item.nome || item.nome_elenco || ''};`;
        csv += `${item.doc_elenco_cadastro || ''};`;
        
        // Calcular idade
        let idade = 'N/A';
        if (item.data_nascimento_elenco) {
          const nascimento = new Date(item.data_nascimento_elenco);
          const hoje = new Date();
          idade = hoje.getFullYear() - nascimento.getFullYear();
        }
        csv += `${idade};`;
        
        csv += `${item.telefone_elenco || ''};`;
        csv += `${item.email_elenco || ''};`;
        csv += `${item.cidade_elenco || ''};`;
        csv += `Ativo\n`;
        break;
        
      case 'motoristas':
        csv += `${item.nome || item.nome_motoristas || ''};`;
        csv += `${item.cnh_motoristas || ''};`;
        csv += `${item.veiculo_motoristas || ''};`;
        csv += `${item.telefone_motoristas || ''};`;
        csv += `${item.chave_pix_motoristas || ''};`;
        csv += `Ativo\n`;
        break;
        
      case 'funcionarios':
        csv += `${item.nome || item.nome_funcionarios || ''};`;
        csv += `${item.cargo || 'Funcion√°rio'};`;
        csv += `${item.doc_funcionarios_cadastro || ''};`;
        csv += `${item.telefone_funcionarios || ''};`;
        csv += `${item.email_funcionarios || ''};`;
        csv += `R$ 2.500,00;`;
        csv += `Ativo\n`;
        break;
        
      case 'fornecedores':
        csv += `${item.nome || item.nome_fornecedores || ''};`;
        csv += `${item.doc_fornecedores_cadastro || ''};`;
        csv += `${item.tipo || 'Outros'};`;
        csv += `${item.telefone_fornecedores || ''};`;
        csv += `${item.email_fornecedores || ''};`;
        csv += `${item.cidade_fornecedores || ''};`;
        
        // Calcular tempo de empresa
        let tempo = 'N/A';
        if (item.data_abertura_fornecedores) {
          const abertura = new Date(item.data_abertura_fornecedores);
          const hoje = new Date();
          tempo = `${hoje.getFullYear() - abertura.getFullYear()} anos`;
        }
        csv += `${tempo};`;
        csv += `Ativo\n`;
        break;
    }
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `${nomeArquivo}_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  
  URL.revokeObjectURL(url);
}

function imprimirRelatorioEquipe(tipo) {
  const tabelaId = `tabela${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`;
  const tabela = document.getElementById(tabelaId);
  
  if (!tabela || !tabela.querySelector('tr td')) {
    alert('N√£o h√° dados para imprimir!');
    return;
  }
  
  const titulo = {
    'elenco': 'Relat√≥rio do Elenco',
    'motoristas': 'Relat√≥rio de Motoristas',
    'funcionarios': 'Relat√≥rio de Funcion√°rios',
    'fornecedores': 'Relat√≥rio de Fornecedores'
  }[tipo] || 'Relat√≥rio';
  
  const janelaImpressao = window.open('', '_blank');
  janelaImpressao.document.write(`
    <html>
      <head>
        <title>${titulo}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          h1 { color: #333; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
          th { background-color: #f8f9fa; padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6; }
          td { padding: 8px; border-bottom: 1px solid #dee2e6; }
          .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 0.875rem; }
          .status-ativo { background-color: #d4edda; color: #155724; }
          .status-inativo { background-color: #e2e3e5; color: #383d41; }
          @media print {
            body { margin: 0; }
            table { font-size: 10px; }
          }
        </style>
      </head>
      <body>
        <h1>${titulo}</h1>
        <p>Data do relat√≥rio: ${new Date().toLocaleDateString('pt-BR')}</p>
        ${tabela.outerHTML}
      </body>
    </html>
  `);
  
  janelaImpressao.document.close();
  janelaImpressao.focus();
  setTimeout(() => {
    janelaImpressao.print();
    janelaImpressao.close();
  }, 500);
}

function editarCadastroEquipe(id, tipo) {
  // Redireciona para a p√°gina de cadastro
  showPage(tipo);
  
  // Aqui voc√™ poderia implementar uma fun√ß√£o para preencher automaticamente
  // o formul√°rio com os dados do item selecionado
  setTimeout(() => {
    alert(`Para editar, v√° para o cadastro de ${tipo} e busque pelo ID: ${id}`);
  }, 500);
}

function verDetalhesEquipe(id, tipo) {
  // Implementa√ß√£o para mostrar detalhes em um modal
  alert(`Detalhes do ${tipo} com ID: ${id}\n\nImplemente um modal para mostrar informa√ß√µes detalhadas.`);
}

// ==================== INICIALIZA√á√ÉO DOS RELAT√ìRIOS ====================

// Observador para carregar relat√≥rios quando as p√°ginas forem abertas
document.addEventListener('DOMContentLoaded', function() {
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        const page = mutation.target;
        if (page.classList.contains('active')) {
          // Aguardar um pouco para garantir que o DOM est√° pronto
          setTimeout(() => {
            switch(page.id) {
              // Relat√≥rios Financeiros
              case 'relatorio_receitas':
                carregarRelatorioReceitas();
                break;
              case 'relatorio_despesas':
                carregarRelatorioDespesas();
                break;
              case 'relatorio_lucros':
                calcularLucros();
                break;
                
              // Relat√≥rios de Equipe
              case 'relatorio_elenco':
                carregarRelatorioElenco();
                break;
              case 'relatorio_motoristas':
                carregarRelatorioMotoristas();
                break;
              case 'relatorio_producao':
                carregarRelatorioProducao();
                break;
              case 'relatorio_funcionarios':
                carregarRelatorioFuncionarios();
                break;
              case 'relatorio_fornecedores':
                carregarRelatorioFornecedores();
                break;
            }
          }, 100);
        }
      }
    });
  });
  
  // P√°ginas a serem observadas
  const paginasParaObservar = [
    'relatorio_receitas', 'relatorio_despesas', 'relatorio_lucros',
    'relatorio_elenco', 'relatorio_motoristas', 'relatorio_producao',
    'relatorio_funcionarios', 'relatorio_fornecedores'
  ];
  
  paginasParaObservar.forEach(id => {
    const pagina = document.getElementById(id);
    if (pagina) {
      observer.observe(pagina, { attributes: true });
    }
  });
});
// Corre√ß√£o tempor√°ria - For√ßar exibi√ß√£o b√°sica
document.addEventListener('DOMContentLoaded', function() {
  // Verificar se estamos em uma p√°gina de relat√≥rio
  const currentPage = document.querySelector('.page.active');
  if (currentPage && currentPage.id.includes('relatorio') || currentPage.id.includes('lista_')) {
    
    // Criar tabela b√°sica se n√£o existir
    const card = currentPage.querySelector('.card');
    if (card && !card.querySelector('table')) {
      card.innerHTML += `
        <div style="margin-top: 20px;">
          <h3>üìä Dados do Relat√≥rio</h3>
          <div style="color: #666; margin-bottom: 20px;">
            Os dados ser√£o carregados em breve...
          </div>
          <table class="tabela-relatorio" style="width: 100%;">
            <thead>
              <tr>
                <th>Item</th>
                <th>Valor</th>
                <th>Status</th>
                <th>Data</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Exemplo 1</td>
                <td>R$ 1.000,00</td>
                <td><span class="status-pago">Pago</span></td>
                <td>01/01/2024</td>
              </tr>
              <tr>
                <td>Exemplo 2</td>
                <td>R$ 2.500,00</td>
                <td><span class="status-pendente">Pendente</span></td>
                <td>15/01/2024</td>
              </tr>
            </tbody>
          </table>
        </div>
      `;
    }
  }
});
function showPage(pageId) {
  // Esconder todas as p√°ginas
  document.querySelectorAll('.page').forEach(page => {
    page.style.display = 'none';
    page.classList.remove('active');
  });
  // Mostrar a p√°gina selecionada
  const selectedPage = document.getElementById(pageId);
  if (selectedPage) {
    selectedPage.style.display = 'block';
    selectedPage.classList.add('active');
    // Disparar um evento para o observer de MutationObserver
    // Isso garante que o carregamento din√¢mico dos relat√≥rios funcione
    const event = new Event('attributes');
    selectedPage.dispatchEvent(event);
  }
}
// ==================== FUN√á√ïES PARA MANUTEN√á√ÉO ====================

// 1. Carregar personagens no select
function carregarPersonagensManutencao() {
  const select = document.getElementById('personagem_manutencao');
  const personagens = JSON.parse(localStorage.getItem('personagens') || '[]');
  
  select.innerHTML = '<option value="">‚Äî Selecione o personagem ‚Äî</option>';
  
  personagens.forEach(personagem => {
    const option = document.createElement('option');
    option.value = personagem.id;
    option.textContent = `${personagem.nome_personagens || 'Sem nome'} - ${personagem.figurino || 'Sem figurino'}`;
    option.setAttribute('data-foto', personagem.foto_personagem || '');
    option.setAttribute('data-nome', personagem.nome_personagens || '');
    option.setAttribute('data-figurino', personagem.figurino || '');
    option.setAttribute('data-tema', personagem.tema || '');
    select.appendChild(option);
  });
}

// 2. Carregar foto do personagem selecionado
function carregarFotoPersonagem() {
  const select = document.getElementById('personagem_manutencao');
  const selectedOption = select.options[select.selectedIndex];
  const previewDiv = document.getElementById('previewPersonagem');
  const fotoContainer = document.getElementById('fotoPersonagemContainer');
  const fotoImg = document.getElementById('fotoPersonagem');
  const semFoto = document.getElementById('semFoto');
  
  if (select.value) {
    previewDiv.style.display = 'block';
    document.getElementById('nomePersonagem').textContent = selectedOption.getAttribute('data-nome');
    document.getElementById('figurinoPersonagem').textContent = selectedOption.getAttribute('data-figurino');
    document.getElementById('temaPersonagem').textContent = selectedOption.getAttribute('data-tema');
    
    const fotoBase64 = selectedOption.getAttribute('data-foto');
    if (fotoBase64) {
      fotoImg.src = fotoBase64;
      fotoImg.style.display = 'block';
      semFoto.style.display = 'none';
    } else {
      fotoImg.style.display = 'none';
      semFoto.style.display = 'block';
    }
  } else {
    previewDiv.style.display = 'none';
  }
}

// 3. Pr√©-visualizar foto do defeito
function previewFotoDefeito(event) {
  const file = event.target.files[0];
  const preview = document.getElementById('previewFotoDefeito');
  const placeholder = document.getElementById('previewPlaceholder');
  
  if (file) {
    if (file.size > 5 * 1024 * 1024) { // 5MB
      alert('Arquivo muito grande! Selecione uma imagem menor que 5MB.');
      event.target.value = '';
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.style.display = 'block';
      placeholder.style.display = 'none';
    };
    reader.readAsDataURL(file);
  }
}

// 4. Salvar manuten√ß√£o
function salvarManutencao() {
  // Validar formul√°rio
  const form = document.getElementById('formManutencao');
  if (!form.checkValidity()) {
    alert('Por favor, preencha todos os campos obrigat√≥rios!');
    return;
  }
  
  // Coletar dados
  const personagemId = document.getElementById('personagem_manutencao').value;
  const personagemNome = document.getElementById('personagem_manutencao').options[document.getElementById('personagem_manutencao').selectedIndex].text;
  const defeitoDescricao = document.getElementById('defeito_descricao').value;
  const localDefeito = document.getElementById('local_defeito').value;
  const severidade = document.getElementById('severidade').value;
  const observacoes = document.getElementById('observacoes_manutencao').value;
  
  // Obter foto do defeito
  const fotoInput = document.getElementById('foto_defeito');
  let fotoDefeito = '';
  if (fotoInput.files.length > 0) {
    const file = fotoInput.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      fotoDefeito = e.target.result;
      salvarDadosManutencao();
    };
    reader.readAsDataURL(file);
  } else {
    salvarDadosManutencao();
  }
  
  function salvarDadosManutencao() {
    // Gerar ID √∫nico
    const manutencaoId = 'MAN-' + Date.now();
    
    // Criar objeto da manuten√ß√£o
    const novaManutencao = {
      id: manutencaoId,
      personagemId: personagemId,
      personagemNome: personagemNome,
      defeitoDescricao: defeitoDescricao,
      localDefeito: localDefeito,
      severidade: severidade,
      fotoDefeito: fotoDefeito,
      observacoes: observacoes,
      status: 'analise',
      dataRegistro: new Date().toISOString(),
      dataConclusao: null,
      oQueFoiFeito: '',
      custoReparo: 0,
      tempoGasto: 0,
      materialUtilizado: '',
      responsavelReparo: '',
      criadoPor: 'Administrador', // Voc√™ pode pegar do usu√°rio logado
      criadoEm: new Date().toISOString()
    };
    
    // Salvar no localStorage
    const manutencoes = JSON.parse(localStorage.getItem('manutencoes') || '[]');
    manutencoes.push(novaManutencao);
    localStorage.setItem('manutencoes', JSON.stringify(manutencoes));
    
    // Atualizar status do personagem
    const personagens = JSON.parse(localStorage.getItem('personagens') || '[]');
    const personagemIndex = personagens.findIndex(p => p.id === personagemId);
    if (personagemIndex !== -1) {
      personagens[personagemIndex].status = 'em_manutencao';
      personagens[personagemIndex].ultimaManutencao = new Date().toISOString();
      localStorage.setItem('personagens', JSON.stringify(personagens));
    }
    
    // Feedback e limpeza
    alert('‚úÖ Manuten√ß√£o registrada com sucesso!');
    limparFormularioManutencao();
    
    // Redirecionar para lista
    setTimeout(() => {
      showPage('lista_de_manutencao');
      carregarListaManutencoes();
    }, 500);
  }
}

// 5. Limpar formul√°rio
function limparFormularioManutencao() {
  document.getElementById('formManutencao').reset();
  document.getElementById('previewPersonagem').style.display = 'none';
  document.getElementById('previewFotoDefeito').style.display = 'none';
  document.getElementById('previewPlaceholder').style.display = 'block';
}

// 6. Carregar lista de manuten√ß√µes
function carregarListaManutencoes() {
  const manutencoes = JSON.parse(localStorage.getItem('manutencoes') || '[]');
  
  // Atualizar filtro de personagens
  atualizarFiltroPersonagensManutencao(manutencoes);
  
  // Filtrar manuten√ß√µes
  filtrarManutencoes();
  
  // Atualizar totais
  atualizarTotaisManutencoes(manutencoes);
}

// 7. Atualizar filtro de personagens
function atualizarFiltroPersonagensManutencao(manutencoes) {
  const select = document.getElementById('filtroPersonagemManutencao');
  const personagensUnicos = [...new Set(manutencoes.map(m => m.personagemNome))];
  
  select.innerHTML = '<option value="todos">Todos os Personagens</option>';
  personagensUnicos.forEach(nome => {
    const option = document.createElement('option');
    option.value = nome;
    option.textContent = nome;
    select.appendChild(option);
  });
}

// 8. Filtrar manuten√ß√µes
function filtrarManutencoes() {
  const status = document.getElementById('filtroStatusManutencao').value;
  const personagem = document.getElementById('filtroPersonagemManutencao').value;
  const dataInicio = document.getElementById('filtroDataInicioManutencao').value;
  const dataFim = document.getElementById('filtroDataFimManutencao').value;
  
  const manutencoes = JSON.parse(localStorage.getItem('manutencoes') || '[]');
  let manutencoesFiltradas = manutencoes;
  
  // Aplicar filtros
  if (status !== 'todos') {
    manutencoesFiltradas = manutencoesFiltradas.filter(m => m.status === status);
  }
  
  if (personagem !== 'todos') {
    manutencoesFiltradas = manutencoesFiltradas.filter(m => m.personagemNome === personagem);
  }
  
  if (dataInicio) {
    manutencoesFiltradas = manutencoesFiltradas.filter(m => 
      new Date(m.dataRegistro) >= new Date(dataInicio)
    );
  }
  
  if (dataFim) {
    manutencoesFiltradas = manutencoesFiltradas.filter(m => 
      new Date(m.dataRegistro) <= new Date(dataFim)
    );
  }
  
  // Ordenar por data mais recente
  manutencoesFiltradas.sort((a, b) => new Date(b.dataRegistro) - new Date(a.dataRegistro));
  
  // Atualizar tabela
  atualizarTabelaManutencoes(manutencoesFiltradas);
}

// 9. Atualizar tabela de manuten√ß√µes
function atualizarTabelaManutencoes(manutencoes) {
  const tabela = document.getElementById('tabelaManutencoes');
  let html = '';
  
  manutencoes.forEach(manutencao => {
    const dataRegistro = formatarData(manutencao.dataRegistro);
    const dataConclusao = manutencao.dataConclusao ? formatarData(manutencao.dataConclusao) : 'N/A';
    
    // Cor do status
    let statusClass = '';
    let statusText = '';
    switch(manutencao.status) {
      case 'analise':
        statusClass = 'status-analise';
        statusText = 'üîç Em An√°lise';
        break;
      case 'andamento':
        statusClass = 'status-andamento';
        statusText = 'üõ†Ô∏è Em Andamento';
        break;
      case 'aguardando':
        statusClass = 'status-aguardando';
        statusText = '‚è≥ Aguardando';
        break;
      case 'concluida':
        statusClass = 'status-concluida';
        statusText = '‚úÖ Conclu√≠da';
        break;
      case 'cancelada':
        statusClass = 'status-cancelada';
        statusText = '‚ùå Cancelada';
        break;
      default:
        statusClass = 'status-analise';
        statusText = 'üîç Em An√°lise';
    }
    
    // Cor da severidade
    let severidadeClass = '';
    switch(manutencao.severidade) {
      case 'baixa':
        severidadeClass = 'severidade-baixa';
        break;
      case 'media':
        severidadeClass = 'severidade-media';
        break;
      case 'alta':
        severidadeClass = 'severidade-alta';
        break;
      case 'critica':
        severidadeClass = 'severidade-critica';
        break;
    }
    
    html += `
      <tr>
        <td><strong>${manutencao.id}</strong></td>
        <td>${dataRegistro}</td>
        <td><strong>${manutencao.personagemNome}</strong></td>
        <td>
          <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
            ${manutencao.defeitoDescricao.substring(0, 50)}...
          </div>
        </td>
        <td>
          <span class="${severidadeClass}">${manutencao.severidade.toUpperCase()}</span>
        </td>
        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
        <td>
          ${manutencao.oQueFoiFeito ? 
            `<div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
              ${manutencao.oQueFoiFeito.substring(0, 50)}...
            </div>` : 
            '<span style="color: #6c757d;">Nada registrado</span>'
          }
        </td>
        <td>${dataConclusao}</td>
        <td>
          <button class="btn-small" onclick="verDetalhesManutencao('${manutencao.id}')">
            üëÅÔ∏è Detalhes
          </button>
          ${manutencao.status !== 'concluida' && manutencao.status !== 'cancelada' ? `
            <button class="btn-small primary" onclick="abrirModalReparo('${manutencao.id}')">
              üîß Reparar
            </button>
          ` : ''}
        </td>
      </tr>
    `;
  });
  
  tabela.innerHTML = html;
}

// 10. Atualizar totais
function atualizarTotaisManutencoes(manutencoes) {
  const totais = {
    analise: 0,
    andamento: 0,
    aguardando: 0,
    concluida: 0,
    cancelada: 0,
    total: manutencoes.length
  };
  
  manutencoes.forEach(m => {
    if (m.status in totais) {
      totais[m.status]++;
    }
  });
  
  document.getElementById('totalAnalise').textContent = totais.analise;
  document.getElementById('totalAndamento').textContent = totais.andamento;
  document.getElementById('totalAguardando').textContent = totais.aguardando;
  document.getElementById('totalConcluidas').textContent = totais.concluida;
  document.getElementById('totalManutencoes').textContent = totais.total;
}

// 11. Ver detalhes da manuten√ß√£o
function verDetalhesManutencao(manutencaoId) {
  const manutencoes = JSON.parse(localStorage.getItem('manutencoes') || '[]');
  const manutencao = manutencoes.find(m => m.id === manutencaoId);
  
  if (!manutencao) {
    alert('Manuten√ß√£o n√£o encontrada!');
    return;
  }
  
  // Formatar datas
  const dataRegistro = formatarDataHora(manutencao.dataRegistro);
  const dataConclusao = manutencao.dataConclusao ? formatarDataHora(manutencao.dataConclusao) : 'N/A';
  
  let statusText = '';
  switch(manutencao.status) {
    case 'analise': statusText = 'üîç Em An√°lise'; break;
    case 'andamento': statusText = 'üõ†Ô∏è Em Andamento'; break;
    case 'aguardando': statusText = '‚è≥ Aguardando Pe√ßas'; break;
    case 'concluida': statusText = '‚úÖ Conclu√≠da'; break;
    case 'cancelada': statusText = '‚ùå Cancelada'; break;
  }
  
  let severidadeText = '';
  switch(manutencao.severidade) {
    case 'baixa': severidadeText = 'üü¢ Baixa'; break;
    case 'media': severidadeText = 'üü° M√©dia'; break;
    case 'alta': severidadeText = 'üü† Alta'; break;
    case 'critica': severidadeText = 'üî¥ Cr√≠tica'; break;
  }
  
  // Construir conte√∫do do modal
  let html = `
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
      
      <!-- Coluna 1: Informa√ß√µes Gerais -->
      <div>
        <div style="background: #e8f4fd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
          <h4 style="margin-top: 0;">üìã Informa√ß√µes Gerais</h4>
          <p><strong>ID:</strong> ${manutencao.id}</p>
          <p><strong>Status:</strong> <span class="status-badge status-${manutencao.status}">${statusText}</span></p>
          <p><strong>Severidade:</strong> <span class="severidade-${manutencao.severidade}">${severidadeText}</span></p>
          <p><strong>Data Registro:</strong> ${dataRegistro}</p>
          <p><strong>Data Conclus√£o:</strong> ${dataConclusao}</p>
          <p><strong>Registrado por:</strong> ${manutencao.criadoPor}</p>
        </div>
        
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
          <h4 style="margin-top: 0;">üé≠ Personagem</h4>
          <p><strong>Nome:</strong> ${manutencao.personagemNome}</p>
          <p><strong>Local do Defeito:</strong> ${formatarLocalDefeito(manutencao.localDefeito)}</p>
        </div>
        
        <div style="background: #fff3cd; padding: 1rem; border-radius: 8px;">
          <h4 style="margin-top: 0;">üìù Descri√ß√£o do Defeito</h4>
          <p>${manutencao.defeitoDescricao}</p>
          ${manutencao.observacoes ? `
            <p><strong>Observa√ß√µes:</strong> ${manutencao.observacoes}</p>
          ` : ''}
        </div>
      </div>
      
      <!-- Coluna 2: Foto e Reparo -->
      <div>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
          <h4 style="margin-top: 0;">üì∏ Foto do Defeito</h4>
          ${manutencao.fotoDefeito ? 
            `<img src="${manutencao.fotoDefeito}" alt="Foto do Defeito" style="max-width: 100%; border-radius: 8px;">` :
            `<div style="text-align: center; color: #6c757d; padding: 2rem;">
              <div style="font-size: 3rem;">üì∑</div>
              <p>Nenhuma foto anexada</p>
            </div>`
          }
        </div>
        
        <div style="background: #d4edda; padding: 1rem; border-radius: 8px;">
          <h4 style="margin-top: 0;">üîß Reparo Realizado</h4>
          ${manutencao.oQueFoiFeito ? `
            <p><strong>O Que Foi Feito:</strong> ${manutencao.oQueFoiFeito}</p>
            ${manutencao.materialUtilizado ? `<p><strong>Material Utilizado:</strong> ${manutencao.materialUtilizado}</p>` : ''}
            ${manutencao.responsavelReparo ? `<p><strong>Respons√°vel:</strong> ${manutencao.responsavelReparo}</p>` : ''}
            ${manutencao.custoReparo > 0 ? `<p><strong>Custo:</strong> R$ ${manutencao.custoReparo.toFixed(2).replace('.', ',')}</p>` : ''}
            ${manutencao.tempoGasto > 0 ? `<p><strong>Tempo Gasto:</strong> ${manutencao.tempoGasto}h</p>` : ''}
          ` : `
            <div style="text-align: center; color: #6c757d; padding: 1rem;">
              <div style="font-size: 2rem;">üîß</div>
              <p>Reparo ainda n√£o realizado</p>
              <button class="btn-small primary" onclick="abrirModalReparo('${manutencao.id}')">
                Registrar Reparo
              </button>
            </div>
          `}
        </div>
      </div>
    </div>
  `;
  
  document.getElementById('detalhesManutencaoConteudo').innerHTML = html;
  document.getElementById('modalDetalhesManutencao').style.display = 'block';
}

// 12. Abrir modal de reparo
function abrirModalReparo(manutencaoId) {
  document.getElementById('manutencaoIdReparo').value = manutencaoId;
  document.getElementById('modalRegistrarReparo').style.display = 'block';
}

// 13. Salvar reparo
function salvarReparo() {
  const manutencaoId = document.getElementById('manutencaoIdReparo').value;
  const oQueFoiFeito = document.getElementById('oque_foi_feito').value;
  const custoReparo = parseFloat(document.getElementById('custo_reparo').value.replace('R$ ', '').replace('.', '').replace(',', '.') || 0);
  const tempoGasto = parseFloat(document.getElementById('tempo_gasto').value || 0);
  const materialUtilizado = document.getElementById('material_utilizado').value;
  const responsavelReparo = document.getElementById('responsavel_reparo').value;
  const statusFinal = document.getElementById('status_final').value;
  
  if (!oQueFoiFeito.trim()) {
    alert('Por favor, descreva o que foi feito no reparo!');
    return;
  }
  
  const manutencoes = JSON.parse(localStorage.getItem('manutencoes') || '[]');
  const manutencaoIndex = manutencoes.findIndex(m => m.id === manutencaoId);
  
  if (manutencaoIndex !== -1) {
    // Atualizar manuten√ß√£o
    manutencoes[manutencaoIndex].oQueFoiFeito = oQueFoiFeito;
    manutencoes[manutencaoIndex].custoReparo = custoReparo;
    manutencoes[manutencaoIndex].tempoGasto = tempoGasto;
    manutencoes[manutencaoIndex].materialUtilizado = materialUtilizado;
    manutencoes[manutencaoIndex].responsavelReparo = responsavelReparo;
    manutencoes[manutencaoIndex].status = statusFinal;
    manutencoes[manutencaoIndex].dataConclusao = new Date().toISOString();
    
    // Atualizar status do personagem se conclu√≠do
    if (statusFinal === 'concluida') {
      const personagens = JSON.parse(localStorage.getItem('personagens') || '[]');
      const personagemIndex = personagens.findIndex(p => p.id === manutencoes[manutencaoIndex].personagemId);
      if (personagemIndex !== -1) {
        personagens[personagemIndex].status = 'disponivel';
        localStorage.setItem('personagens', JSON.stringify(personagens));
      }
    }
    
    localStorage.setItem('manutencoes', JSON.stringify(manutencoes));
    
    // Fechar modal e atualizar
    fecharModalReparo();
    alert('‚úÖ Reparo registrado com sucesso!');
    
    // Atualizar lista
    carregarListaManutencoes();
    
    // Se estava vendo detalhes, atualizar
    if (document.getElementById('modalDetalhesManutencao').style.display === 'block') {
      verDetalhesManutencao(manutencaoId);
    }
  }
}

// 14. Fun√ß√µes auxiliares
function formatarData(dataString) {
  if (!dataString) return 'N/A';
  const date = new Date(dataString);
  return date.toLocaleDateString('pt-BR');
}

function formatarDataHora(dataString) {
  if (!dataString) return 'N/A';
  const date = new Date(dataString);
  return date.toLocaleString('pt-BR');
}

function formatarLocalDefeito(local) {
  const locais = {
    'cabeca': 'Cabe√ßa/Capacete',
    'rosto': 'Rosto/M√°scara',
    'corpo': 'Corpo (Parte Principal)',
    'bra√ßos': 'Bra√ßos/M√£os',
    'pernas': 'Pernas/P√©s',
    'costas': 'Costas',
    'acessorios': 'Acess√≥rios',
    'costura': 'Costura/Fechos',
    'material': 'Material/Tecido',
    'eletronico': 'Componente Eletr√¥nico',
    'outro': 'Outro Local'
  };
  return locais[local] || local;
}

function resetarFiltrosManutencao() {
  document.getElementById('filtroStatusManutencao').value = 'analise';
  document.getElementById('filtroPersonagemManutencao').value = 'todos';
  document.getElementById('filtroDataInicioManutencao').value = '';
  document.getElementById('filtroDataFimManutencao').value = '';
  filtrarManutencoes();
}

function fecharModalManutencao() {
  document.getElementById('modalDetalhesManutencao').style.display = 'none';
}

function fecharModalReparo() {
  document.getElementById('modalRegistrarReparo').style.display = 'none';
  document.getElementById('formReparo').reset();
}

function exportarRelatorioManutencao() {
  alert('Funcionalidade de exporta√ß√£o em desenvolvimento...');
}

function imprimirRelatorioManutencao() {
  window.print();
}

// 15. Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', function() {
  // Quando a p√°gina de cadastro de manuten√ß√£o for carregada
  if (document.getElementById('cadastrar_manutencao')) {
    carregarPersonagensManutencao();
  }
  
  // Quando a p√°gina de lista de manuten√ß√£o for carregada
  if (document.getElementById('lista_de_manutencao')) {
    carregarListaManutencoes();
  }
});
// Fun√ß√£o para validar login
function validarLogin() {
  const login = document.getElementById('loginInput').value;
  const senha = document.getElementById('senhaInput').value;
  
  if (fazerLogin(login, senha)) {
    document.getElementById('modalLogin').style.display = 'none';
    alert(`Bem-vindo, ${usuarioLogado.nome}!`);
    aplicarPermissoesUsuario();
    atualizarInterfaceUsuario();
  } else {
    alert('‚ùå Login ou senha incorretos!');
  }
}

// Mostrar modal de login se n√£o estiver logado
document.addEventListener('DOMContentLoaded', function() {
  if (!localStorage.getItem('usuarioLogado')) {
    setTimeout(() => {
      document.getElementById('modalLogin').style.display = 'block';
    }, 500);
  }
});
// ==================== FUN√á√ïES PARA USU√ÅRIOS ====================

// 1. Formatar CPF
function formatarCPF(input) {
  let value = input.value.replace(/\D/g, '');
  
  if (value.length > 11) {
    value = value.substring(0, 11);
  }
  
  if (value.length > 9) {
    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
  } else if (value.length > 6) {
    value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
  } else if (value.length > 3) {
    value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
  }
  
  input.value = value;
}

// 2. Formatar Telefone
function formatarTelefone(input) {
  let value = input.value.replace(/\D/g, '');
  
  if (value.length > 11) {
    value = value.substring(0, 11);
  }
  
  if (value.length > 10) {
    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
  } else if (value.length > 6) {
    value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
  } else if (value.length > 2) {
    value = value.replace(/(\d{2})(\d{1,4})/, '($1) $2');
  } else if (value.length > 0) {
    value = value.replace(/(\d{1,2})/, '($1');
  }
  
  input.value = value;
}

// 3. Gerar ID √∫nico
function gerarIDUsuario() {
  return 'USR' + Date.now().toString().substring(5) + Math.floor(Math.random() * 1000);
}

// 4. Alternar visibilidade da senha
function toggleSenha() {
  const senhaInput = document.getElementById('senha_usuario');
  const tipoAtual = senhaInput.type;
  senhaInput.type = tipoAtual === 'password' ? 'text' : 'password';
}

// 5. Salvar novo usu√°rio
function salvarUsuario() {
  // Validar formul√°rio
  const form = document.getElementById('formUsuario');
  if (!form.checkValidity()) {
    alert('Por favor, preencha todos os campos obrigat√≥rios!');
    return;
  }
  
  // Verificar se CPF j√° existe
  const cpf = document.getElementById('cpf_usuario').value;
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  
  if (usuarios.some(u => u.cpf === cpf)) {
    alert('CPF j√° cadastrado no sistema!');
    return;
  }
  
  // Verificar se login j√° existe
  const login = document.getElementById('login_usuario').value;
  if (usuarios.some(u => u.login === login)) {
    alert('Login j√° existe! Escolha outro login.');
    return;
  }
  
  // Criar objeto do usu√°rio
  const novoUsuario = {
    id: gerarIDUsuario(),
    cpf: cpf,
    nome: document.getElementById('nome_usuario').value,
    login: login,
    senha: document.getElementById('senha_usuario').value,
    email: document.getElementById('email_usuario').value || '',
    telefone: document.getElementById('telefone_usuario').value || '',
    cargo: document.getElementById('cargo_usuario').value || 'atendente',
    data_admissao: document.getElementById('data_admissao').value || new Date().toISOString().split('T')[0],
    status: 'ativo',
    criado_em: new Date().toISOString(),
    criado_por: 'Administrador',
    // Permiss√µes padr√£o (nenhuma)
    permissoes: [],
    // Permiss√µes padr√£o para usu√°rio b√°sico
    permissoes_padrao: ['dashboard', 'eventos_futuros', 'confirmar_dados']
  };
  
  // Salvar no localStorage
  usuarios.push(novoUsuario);
  localStorage.setItem('usuarios', JSON.stringify(usuarios));
  
  // Feedback
  alert('‚úÖ Usu√°rio cadastrado com sucesso!');
  
  // Atualizar lista
  carregarListaUsuarios();
  
  // Limpar formul√°rio
  limparFormularioUsuario();
}

// 6. Carregar lista de usu√°rios
function carregarListaUsuarios() {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const tbody = document.getElementById('listaUsuarios');
  
  let html = '';
  
  usuarios.forEach(usuario => {
    // Status badge
    let statusBadge = '';
    if (usuario.status === 'ativo') {
      statusBadge = '<span class="status-ativo" style="cursor:pointer;" onclick="alterarStatusUsuario(\'' + usuario.id + '\')">‚úÖ Ativo</span>';
    } else {
      statusBadge = '<span class="status-inativo" style="cursor:pointer;" onclick="alterarStatusUsuario(\'' + usuario.id + '\')">‚ùå Inativo</span>';
    }
    
    // Cargo formatado
    const cargoFormatado = usuario.cargo ? usuario.cargo.charAt(0).toUpperCase() + usuario.cargo.slice(1) : 'N/A';
    
    html += `
      <tr>
        <td><small>${usuario.id}</small></td>
        <td><strong>${usuario.nome}</strong></td>
        <td>${usuario.login}</td>
        <td>${cargoFormatado}</td>
        <td>${statusBadge}</td>
        <td>
          <button class="btn-small" onclick="editarUsuario('${usuario.id}')">
            ‚úèÔ∏è Editar
          </button>
          <button class="btn-small" onclick="excluirUsuario('${usuario.id}')">
            üóëÔ∏è Excluir
          </button>
          <button class="btn-small primary" onclick="showPage('permissoes_sistema'); setTimeout(() => selecionarUsuarioPermissao('${usuario.id}'), 100);">
            üîí Permiss√µes
          </button>
        </td>
      </tr>
    `;
  });
  
  tbody.innerHTML = html;
}

// 7. Filtrar usu√°rios
function filtrarUsuarios() {
  const termo = document.getElementById('buscarUsuario').value.toLowerCase();
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const tbody = document.getElementById('listaUsuarios');
  
  let html = '';
  
  usuarios.forEach(usuario => {
    if (termo === '' || 
        usuario.nome.toLowerCase().includes(termo) || 
        usuario.login.toLowerCase().includes(termo) ||
        usuario.cargo.toLowerCase().includes(termo)) {
      
      let statusBadge = '';
      if (usuario.status === 'ativo') {
        statusBadge = '<span class="status-ativo" onclick="alterarStatusUsuario(\'' + usuario.id + '\')">‚úÖ Ativo</span>';
      } else {
        statusBadge = '<span class="status-inativo" onclick="alterarStatusUsuario(\'' + usuario.id + '\')">‚ùå Inativo</span>';
      }
      
      const cargoFormatado = usuario.cargo ? usuario.cargo.charAt(0).toUpperCase() + usuario.cargo.slice(1) : 'N/A';
      
      html += `
        <tr>
          <td><small>${usuario.id}</small></td>
          <td><strong>${usuario.nome}</strong></td>
          <td>${usuario.login}</td>
          <td>${cargoFormatado}</td>
          <td>${statusBadge}</td>
          <td>
            <button class="btn-small" onclick="editarUsuario('${usuario.id}')">
              ‚úèÔ∏è Editar
            </button>
            <button class="btn-small" onclick="excluirUsuario('${usuario.id}')">
              üóëÔ∏è Excluir
            </button>
            <button class="btn-small primary" onclick="showPage('permissoes_sistema'); setTimeout(() => selecionarUsuarioPermissao('${usuario.id}'), 100);">
              üîí Permiss√µes
            </button>
          </td>
        </tr>
      `;
    }
  });
  
  tbody.innerHTML = html;
}

// 8. Alterar status do usu√°rio (ativo/inativo)
function alterarStatusUsuario(usuarioId) {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuarioIndex = usuarios.findIndex(u => u.id === usuarioId);
  
  if (usuarioIndex !== -1) {
    const novoStatus = usuarios[usuarioIndex].status === 'ativo' ? 'inativo' : 'ativo';
    
    if (confirm(`Deseja ${novoStatus === 'ativo' ? 'ativar' : 'inativar'} o usu√°rio ${usuarios[usuarioIndex].nome}?`)) {
      usuarios[usuarioIndex].status = novoStatus;
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
      
      // Recarregar lista
      carregarListaUsuarios();
      
      // Se estiver na p√°gina de permiss√µes e este for o usu√°rio selecionado, atualizar
      if (document.getElementById('permissoes_sistema') && 
          document.getElementById('selectUsuarioPermissao').value === usuarioId) {
        carregarPermissoesUsuario();
      }
    }
  }
}

// 9. Editar usu√°rio
function editarUsuario(usuarioId) {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuario = usuarios.find(u => u.id === usuarioId);
  
  if (usuario) {
    document.getElementById('editar_id').value = usuario.id;
    document.getElementById('editar_nome').value = usuario.nome;
    document.getElementById('editar_login').value = usuario.login;
    document.getElementById('editar_email').value = usuario.email || '';
    document.getElementById('editar_cargo').value = usuario.cargo || 'atendente';
    document.getElementById('editar_status').value = usuario.status || 'ativo';
    
    document.getElementById('modalEditarUsuario').style.display = 'block';
  }
}

// 10. Atualizar usu√°rio
function atualizarUsuario() {
  const usuarioId = document.getElementById('editar_id').value;
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuarioIndex = usuarios.findIndex(u => u.id === usuarioId);
  
  if (usuarioIndex !== -1) {
    // Atualizar dados
    usuarios[usuarioIndex].nome = document.getElementById('editar_nome').value;
    usuarios[usuarioIndex].login = document.getElementById('editar_login').value;
    usuarios[usuarioIndex].email = document.getElementById('editar_email').value;
    usuarios[usuarioIndex].cargo = document.getElementById('editar_cargo').value;
    usuarios[usuarioIndex].status = document.getElementById('editar_status').value;
    
    // Atualizar senha se foi informada
    const novaSenha = document.getElementById('editar_senha').value;
    if (novaSenha.trim() !== '') {
      usuarios[usuarioIndex].senha = novaSenha;
    }
    
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    
    // Fechar modal e atualizar
    fecharModalUsuario();
    carregarListaUsuarios();
    
    alert('‚úÖ Usu√°rio atualizado com sucesso!');
  }
}

// 11. Excluir usu√°rio
function excluirUsuario(usuarioId) {
  if (confirm('Tem certeza que deseja excluir este usu√°rio?\nEsta a√ß√£o n√£o pode ser desfeita!')) {
    const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
    const usuarioIndex = usuarios.findIndex(u => u.id === usuarioId);
    
    if (usuarioIndex !== -1) {
      // N√£o permitir excluir o √∫ltimo administrador
      const adminCount = usuarios.filter(u => u.cargo === 'administrador' && u.status === 'ativo').length;
      if (usuarios[usuarioIndex].cargo === 'administrador' && adminCount <= 1) {
        alert('N√£o √© poss√≠vel excluir o √∫nico administrador ativo do sistema!');
        return;
      }
      
      usuarios.splice(usuarioIndex, 1);
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
      
      // Recarregar lista
      carregarListaUsuarios();
      alert('‚úÖ Usu√°rio exclu√≠do com sucesso!');
    }
  }
}

// 12. Limpar formul√°rio
function limparFormularioUsuario() {
  document.getElementById('formUsuario').reset();
  document.getElementById('ID_usuario').value = gerarIDUsuario();
}

// 13. Fechar modal
function fecharModalUsuario() {
  document.getElementById('modalEditarUsuario').style.display = 'none';
  document.getElementById('formEditarUsuario').reset();
}

// 14. Exportar lista
function exportarUsuarios() {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  
  // Converter para CSV
  let csv = 'ID;Nome;CPF;Login;Cargo;Status;Email;Telefone;Data Admiss√£o\n';
  
  usuarios.forEach(usuario => {
    csv += `"${usuario.id}";"${usuario.nome}";"${usuario.cpf}";"${usuario.login}";"${usuario.cargo}";"${usuario.status}";"${usuario.email}";"${usuario.telefone}";"${usuario.data_admissao}"\n`;
  });
  
  // Criar arquivo
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  
  link.setAttribute('href', url);
  link.setAttribute('download', `usuarios_${new Date().toISOString().split('T')[0]}.csv`);
  link.style.visibility = 'hidden';
  
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// ==================== FUN√á√ïES PARA PERMISS√ïES ====================

// 15. Carregar usu√°rios no select de permiss√µes
function carregarUsuariosPermissoes() {
  const select = document.getElementById('selectUsuarioPermissao');
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  
  select.innerHTML = '<option value="">‚Äî Selecione um usu√°rio ‚Äî</option>';
  
  usuarios.forEach(usuario => {
    // Mostrar apenas usu√°rios ativos
    if (usuario.status === 'ativo') {
      const option = document.createElement('option');
      option.value = usuario.id;
      option.textContent = `${usuario.nome} (${usuario.login}) - ${usuario.cargo}`;
      select.appendChild(option);
    }
  });
}

// 16. Selecionar usu√°rio programaticamente
function selecionarUsuarioPermissao(usuarioId) {
  document.getElementById('selectUsuarioPermissao').value = usuarioId;
  carregarPermissoesUsuario();
}

// 17. Carregar permiss√µes do usu√°rio selecionado
function carregarPermissoesUsuario() {
  const usuarioId = document.getElementById('selectUsuarioPermissao').value;
  
  if (!usuarioId) {
    document.getElementById('painelPermissoes').style.display = 'none';
    document.getElementById('infoUsuarioSelecionado').style.display = 'none';
    return;
  }
  
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuario = usuarios.find(u => u.id === usuarioId);
  
  if (!usuario) {
    alert('Usu√°rio n√£o encontrado!');
    return;
  }
  
  // Mostrar informa√ß√µes do usu√°rio
  document.getElementById('nomeUsuarioSelecionado').textContent = usuario.nome;
  document.getElementById('cargoUsuarioSelecionado').textContent = usuario.cargo;
  
  const statusElement = document.getElementById('statusUsuarioSelecionado');
  statusElement.textContent = usuario.status === 'ativo' ? '‚úÖ Ativo' : '‚ùå Inativo';
  statusElement.className = usuario.status === 'ativo' ? 'status-ativo' : 'status-inativo';
  
  document.getElementById('infoUsuarioSelecionado').style.display = 'inline-block';
  
  // Mostrar painel de permiss√µes
  document.getElementById('painelPermissoes').style.display = 'block';
  
  // Limpar todas as sele√ß√µes
  document.querySelectorAll('.permissao-check').forEach(checkbox => {
    checkbox.checked = false;
  });
  
  // Carregar permiss√µes do usu√°rio
  if (usuario.permissoes && Array.isArray(usuario.permissoes)) {
    usuario.permissoes.forEach(pageId => {
      const checkbox = document.querySelector(`.permissao-check[data-page="${pageId}"]`);
      if (checkbox) {
        checkbox.checked = true;
      }
    });
  }
  
  // Adicionar permiss√µes padr√£o se n√£o tiver nenhuma
  if ((!usuario.permissoes || usuario.permissoes.length === 0) && usuario.permissoes_padrao) {
    usuario.permissoes_padrao.forEach(pageId => {
      const checkbox = document.querySelector(`.permissao-check[data-page="${pageId}"]`);
      if (checkbox) {
        checkbox.checked = true;
      }
    });
  }
  
  // Verificar se √© administrador (acesso total)
  if (usuario.cargo === 'administrador') {
    // Marcar todos os checkboxes
    document.querySelectorAll('.permissao-check').forEach(checkbox => {
      checkbox.checked = true;
    });
  }
  
  // Desabilitar checkboxes de configura√ß√µes se n√£o for admin
  if (usuario.cargo !== 'administrador') {
    document.querySelectorAll('.permissao-check[data-restrito="true"]').forEach(checkbox => {
      checkbox.disabled = true;
      checkbox.title = 'Apenas para administradores';
    });
  } else {
    document.querySelectorAll('.permissao-check[data-restrito="true"]').forEach(checkbox => {
      checkbox.disabled = false;
      checkbox.title = '';
    });
  }
}

// 18. Salvar permiss√µes
function salvarPermissoes() {
  const usuarioId = document.getElementById('selectUsuarioPermissao').value;
  
  if (!usuarioId) {
    alert('Selecione um usu√°rio primeiro!');
    return;
  }
  
  // Coletar permiss√µes selecionadas
  const checkboxes = document.querySelectorAll('.permissao-check:checked');
  const permissoes = Array.from(checkboxes).map(cb => cb.getAttribute('data-page'));
  
  // Verificar se selecionou alguma permiss√£o
  if (permissoes.length === 0 && !confirm('Nenhuma permiss√£o selecionada. Deseja continuar?')) {
    return;
  }
  
  // Atualizar usu√°rio
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuarioIndex = usuarios.findIndex(u => u.id === usuarioId);
  
  if (usuarioIndex !== -1) {
    usuarios[usuarioIndex].permissoes = permissoes;
    usuarios[usuarioIndex].permissoes_atualizadas_em = new Date().toISOString();
    usuarios[usuarioIndex].permissoes_atualizadas_por = 'Administrador';
    
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    
    alert(`‚úÖ Permiss√µes salvas para ${usuarios[usuarioIndex].nome}!\nTotal: ${permissoes.length} permiss√µes concedidas.`);
  }
}

// 19. Fun√ß√µes de sele√ß√£o r√°pida
function selecionarTudo() {
  document.querySelectorAll('.permissao-check:not(:disabled)').forEach(checkbox => {
    checkbox.checked = true;
  });
}

function limparTudo() {
  document.querySelectorAll('.permissao-check:not(:disabled)').forEach(checkbox => {
    checkbox.checked = false;
  });
}

function permissaoAdministrador() {
  // Selecionar tudo
  document.querySelectorAll('.permissao-check:not(:disabled)').forEach(checkbox => {
    checkbox.checked = true;
  });
  
  alert('Permiss√µes de Administrador aplicadas: Acesso total ao sistema.');
}

function permissaoAtendente() {
  // Limpar tudo primeiro
  limparTudo();
  
  // Permiss√µes b√°sicas para atendente
  const permissoesAtendente = [
    'dashboard', 'reservar_evento', 'eventos_futuros', 'confirmar_dados',
    'clientes', 'personagens', 'lista_disponibilidade_personagens'
  ];
  
  permissoesAtendente.forEach(pageId => {
    const checkbox = document.querySelector(`.permissao-check[data-page="${pageId}"]`);
    if (checkbox && !checkbox.disabled) {
      checkbox.checked = true;
    }
  });
  
  alert('Permiss√µes de Atendente aplicadas: Cadastro e reservas b√°sicas.');
}

function permissaoProducao() {
  limparTudo();
  
  const permissoesProducao = [
    'dashboard', 'eventos_futuros', 'confirmar_dados', 'eventos_finalizados',
    'escalas', 'lista_disponibilidade_personagens', 'cadastrar_manutencao',
    'lista_de_manutencao', 'elenco', 'motoristas', 'funcionarios'
  ];
  
  permissoesProducao.forEach(pageId => {
    const checkbox = document.querySelector(`.permissao-check[data-page="${pageId}"]`);
    if (checkbox && !checkbox.disabled) {
      checkbox.checked = true;
    }
  });
  
  alert('Permiss√µes de Produ√ß√£o aplicadas: Escalas, equipe e manuten√ß√£o.');
}

function permissaoFinanceiro() {
  limparTudo();
  
  const permissoesFinanceiro = [
    'dashboard', 'contas_receber_eventos', 'contas_pagar_fornecedores',
    'contas_pagar_elenco', 'contas_pagar_motoristas', 'contas_pagar_producao',
    'contas_pagar_funcionarios', 'relatorios_receitas', 'relatorios_despesas',
    'relatorios_lucros', 'fornecedores'
  ];
  
  permissoesFinanceiro.forEach(pageId => {
    const checkbox = document.querySelector(`.permissao-check[data-page="${pageId}"]`);
    if (checkbox && !checkbox.disabled) {
      checkbox.checked = true;
    }
  });
  
  alert('Permiss√µes de Financeiro aplicadas: Contas e relat√≥rios financeiros.');
}

// 20. Testar permiss√µes
function testarPermissoes() {
  const usuarioId = document.getElementById('selectUsuarioPermissao').value;
  
  if (!usuarioId) {
    alert('Selecione um usu√°rio primeiro!');
    return;
  }
  
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuario = usuarios.find(u => u.id === usuarioId);
  
  if (!usuario) return;
  
  // Coletar permiss√µes selecionadas
  const checkboxes = document.querySelectorAll('.permissao-check:checked');
  const permissoes = Array.from(checkboxes).map(cb => cb.getAttribute('data-page'));
  
  let mensagem = `üß™ TESTE DE PERMISS√ïES\n`;
  mensagem += `Usu√°rio: ${usuario.nome}\n`;
  mensagem += `Cargo: ${usuario.cargo}\n`;
  mensagem += `Total de permiss√µes: ${permissoes.length}\n\n`;
  mensagem += `P√°ginas permitidas:\n`;
  
  permissoes.forEach((page, index) => {
    mensagem += `${index + 1}. ${page}\n`;
  });
  
  alert(mensagem);
}

// ==================== SISTEMA DE LOGIN E CONTROLE DE ACESSO ====================

// 21. Sistema de Login (substitua o usu√°rio fixo)
let usuarioLogado = null;

function fazerLogin(login, senha) {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuario = usuarios.find(u => u.login === login && u.senha === senha && u.status === 'ativo');
  
  if (usuario) {
    usuarioLogado = usuario;
    localStorage.setItem('usuarioLogado', JSON.stringify(usuario));
    
    // Atualizar interface
    atualizarInterfaceUsuario();
    
    // Aplicar permiss√µes
    aplicarPermissoesUsuario();
    
    return true;
  }
  
  return false;
}

function fazerLogout() {
  usuarioLogado = null;
  localStorage.removeItem('usuarioLogado');
  
  // Redirecionar para login (voc√™ precisar√° criar uma p√°gina de login)
  alert('Logout realizado com sucesso!');
  // showPage('login'); // Se tiver p√°gina de login
}

// 22. Verificar login ao carregar a p√°gina
function verificarLogin() {
  const usuarioSalvo = localStorage.getItem('usuarioLogado');
  
  if (usuarioSalvo) {
    usuarioLogado = JSON.parse(usuarioSalvo);
    aplicarPermissoesUsuario();
  } else {
    // Se n√£o tem usu√°rio logado, criar admin padr√£o se n√£o existir
    criarAdminPadrao();
    
    // Fazer login autom√°tico como admin (remova isto em produ√ß√£o!)
    const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
    const admin = usuarios.find(u => u.cargo === 'administrador' && u.status === 'ativo');
    
    if (admin) {
      usuarioLogado = admin;
      localStorage.setItem('usuarioLogado', JSON.stringify(admin));
      aplicarPermissoesUsuario();
    }
  }
  
  atualizarInterfaceUsuario();
}

// 23. Criar admin padr√£o se n√£o existir
function criarAdminPadrao() {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  
  // Verificar se j√° existe admin
  const existeAdmin = usuarios.some(u => u.cargo === 'administrador');
  
  if (!existeAdmin) {
    const adminPadrao = {
      id: gerarIDUsuario(),
      cpf: '000.000.000-00',
      nome: 'Administrador do Sistema',
      login: 'admin',
      senha: 'admin123', // Mude esta senha!
      email: 'admin@sistema.com',
      cargo: 'administrador',
      status: 'ativo',
      data_admissao: new Date().toISOString().split('T')[0],
      criado_em: new Date().toISOString(),
      permissoes: [], // Vazio = acesso total
      permissoes_padrao: []
    };
    
    usuarios.push(adminPadrao);
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    
    console.log('‚úÖ Administrador padr√£o criado: login: admin | senha: admin123');
  }
}

// 24. Atualizar interface com informa√ß√µes do usu√°rio
function atualizarInterfaceUsuario() {
  const userNameElement = document.getElementById('userName');
  const logoutBtn = document.getElementById('logoutBtn');
  
  if (usuarioLogado && userNameElement) {
    userNameElement.textContent = usuarioLogado.nome;
    
    // Adicionar badge de cargo
    const cargoBadge = document.createElement('span');
    cargoBadge.style.cssText = `
      margin-left: 8px;
      padding: 2px 6px;
      background: ${usuarioLogado.cargo === 'administrador' ? '#dc3545' : '#28a745'};
      color: white;
      border-radius: 10px;
      font-size: 0.8rem;
    `;
    cargoBadge.textContent = usuarioLogado.cargo;
    
    userNameElement.appendChild(cargoBadge);
    
    // Configurar bot√£o de logout
    if (logoutBtn) {
      logoutBtn.onclick = fazerLogout;
    }
  }
}

// 25. Aplicar permiss√µes ao menu
function aplicarPermissoesUsuario() {
  if (!usuarioLogado) return;
  
  // Se for administrador, n√£o restringe
  if (usuarioLogado.cargo === 'administrador') {
    // Administrador v√™ tudo
    document.querySelectorAll('.nav-btn, .nav-subbtn, .nav-subbtn-nested').forEach(btn => {
      btn.style.display = 'flex';
    });
    return;
  }
  
  // Obter p√°ginas permitidas
  let paginasPermitidas = [];
  
  if (usuarioLogado.permissoes && Array.isArray(usuarioLogado.permissoes)) {
    paginasPermitidas = usuarioLogado.permissoes;
  }
  
  // Adicionar permiss√µes padr√£o
  if (usuarioLogado.permissoes_padrao && Array.isArray(usuarioLogado.permissoes_padrao)) {
    paginasPermitidas = [...new Set([...paginasPermitidas, ...usuarioLogado.permissoes_padrao])];
  }
  
  // Sempre permitir dashboard
  if (!paginasPermitidas.includes('dashboard')) {
    paginasPermitidas.push('dashboard');
  }
  
  // Esconder todos os bot√µes primeiro
  document.querySelectorAll('.nav-btn, .nav-subbtn, .nav-subbtn-nested').forEach(btn => {
    btn.style.display = 'none';
  });
  
  // Mostrar bot√µes permitidos
  paginasPermitidas.forEach(pageId => {
    // Encontrar bot√µes que levam a esta p√°gina
    const botoes = document.querySelectorAll(`[data-page="${pageId}"]`);
    botoes.forEach(btn => {
      btn.style.display = 'flex';
      
      // Mostrar tamb√©m o pai do bot√£o (grupo do menu)
      const parentGroup = btn.closest('.nav-group, .submenu-group');
      if (parentGroup) {
        // Mostrar o bot√£o principal do grupo
        const mainBtn = parentGroup.querySelector('.nav-btn, .nav-subbtn[data-toggle]');
        if (mainBtn) {
          mainBtn.style.display = 'flex';
        }
        
        // Mostrar o grupo pai tamb√©m
        const grandParent = parentGroup.parentElement.closest('.nav-group, .submenu-group');
        if (grandParent) {
          const grandBtn = grandParent.querySelector('.nav-btn, .nav-subbtn[data-toggle]');
          if (grandBtn) {
            grandBtn.style.display = 'flex';
          }
        }
      }
    });
  });
  
  // Garantir que o bot√£o de logout sempre aparece
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.style.display = 'block';
  }
}

// 26. Verificar permiss√£o antes de mostrar p√°gina
function verificarPermissaoPagina(pageId) {
  if (!usuarioLogado) {
    // Se n√£o tem usu√°rio logado, redirecionar para dashboard
    if (pageId !== 'dashboard') {
      showPage('dashboard');
      return false;
    }
    return true;
  }
  
  // Administrador tem acesso a tudo
  if (usuarioLogado.cargo === 'administrador') {
    return true;
  }
  
  // Verificar se a p√°gina est√° nas permiss√µes
  const paginasPermitidas = [
    ...(usuarioLogado.permissoes || []),
    ...(usuarioLogado.permissoes_padrao || []),
    'dashboard' // Sempre permitido
  ];
  
  if (!paginasPermitidas.includes(pageId)) {
    alert('‚ùå Acesso negado!\nVoc√™ n√£o tem permiss√£o para acessar esta p√°gina.');
    showPage('dashboard');
    return false;
  }
  
  return true;
}

// 27. Modificar a fun√ß√£o showPage para verificar permiss√µes
function showPageComPermissao(pageId) {
  if (verificarPermissaoPagina(pageId)) {
    showPage(pageId);
  }
}

// ==================== INICIALIZA√á√ÉO ====================

document.addEventListener('DOMContentLoaded', function() {
  // Criar admin padr√£o se necess√°rio
  criarAdminPadrao();
  
  // Verificar login
  verificarLogin();
  
  // Quando a p√°gina de usu√°rios for carregada
  if (document.getElementById('usuarios_sistema')) {
    // Gerar ID inicial
    document.getElementById('ID_usuario').value = gerarIDUsuario();
    
    // Carregar lista de usu√°rios
    carregarListaUsuarios();
  }
  
  // Quando a p√°gina de permiss√µes for carregada
  if (document.getElementById('permissoes_sistema')) {
    carregarUsuariosPermissoes();
  }
  
  // Modificar todos os bot√µes do menu para usar verifica√ß√£o de permiss√£o
  document.querySelectorAll('[data-page]').forEach(btn => {
    const originalOnClick = btn.onclick;
    btn.onclick = function() {
      const pageId = this.getAttribute('data-page');
      showPageComPermissao(pageId);
    };
  });
});
// ==================== FUN√á√ïES ATUALIZADAS PARA USU√ÅRIOS ====================

// 1. Gerar ID autom√°tico para usu√°rio (USU + n√∫meros + 2026)
function gerarIDUsuario() {
  const timestamp = Date.now().toString();
  const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
  return `USU${timestamp.substring(5)}${random}2026`;
}

// 2. Alternar visibilidade da senha (funcional)
function toggleSenha(inputId, btnId) {
  const senhaInput = document.getElementById(inputId);
  const btn = document.getElementById(btnId);
  
  if (senhaInput.type === 'password') {
    senhaInput.type = 'text';
    btn.innerHTML = 'üôà';
    btn.style.background = '#28a745';
  } else {
    senhaInput.type = 'password';
    btn.innerHTML = 'üëÅÔ∏è';
    btn.style.background = '#6c757d';
  }
}

// 3. Salvar novo usu√°rio (atualizado)
function salvarUsuario() {
  // Validar formul√°rio
  const form = document.getElementById('formUsuario');
  if (!form.checkValidity()) {
    alert('Por favor, preencha todos os campos obrigat√≥rios (*)!');
    return;
  }
  
  // Coletar dados
  const cpf = document.getElementById('cpf_usuario').value;
  const login = document.getElementById('login_usuario').value;
  const senha = document.getElementById('senha_usuario').value;
  const nome = document.getElementById('nome_usuario').value;
  
  // Verificar se campos obrigat√≥rios est√£o preenchidos
  if (!cpf || !login || !senha || !nome) {
    alert('Preencha todos os campos obrigat√≥rios!');
    return;
  }
  
  // Verificar se CPF j√° existe
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  if (usuarios.some(u => u.cpf === cpf)) {
    alert('CPF j√° cadastrado no sistema!');
    return;
  }
  
  // Verificar se login j√° existe
  if (usuarios.some(u => u.login === login)) {
    alert('Login j√° existe! Escolha outro login.');
    return;
  }
  
  // Criar objeto do usu√°rio
  const novoUsuario = {
    id: document.getElementById('ID_usuario').value,
    cpf: cpf,
    nome: nome,
    login: login,
    senha: senha,
    email: document.getElementById('email_usuario').value || '',
    telefone: document.getElementById('telefone_usuario').value || '',
    cargo: document.getElementById('cargo_usuario').value || 'atendente',
    data_admissao: document.getElementById('data_admissao').value || new Date().toISOString().split('T')[0],
    status: 'ativo', // Sempre cadastra como ativo
    criado_em: new Date().toISOString(),
    criado_por: localStorage.getItem('usuarioLogado') ? JSON.parse(localStorage.getItem('usuarioLogado')).nome : 'Sistema',
    permissoes: [],
    permissoes_padrao: ['dashboard', 'eventos_futuros', 'confirmar_dados']
  };
  
  // Salvar no localStorage
  usuarios.push(novoUsuario);
  localStorage.setItem('usuarios', JSON.stringify(usuarios));
  
  // Feedback
  alert(`‚úÖ Usu√°rio ${nome} cadastrado com sucesso!\nID: ${novoUsuario.id}\nLogin: ${login}`);
  
  // Atualizar lista
  carregarListaUsuarios();
  
  // Limpar formul√°rio e gerar novo ID
  limparFormularioUsuario();
  
  // Gerar novo ID autom√°tico
  document.getElementById('ID_usuario').value = gerarIDUsuario();
}

// 4. Carregar lista de usu√°rios com bot√µes de status
function carregarListaUsuarios() {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const tbody = document.getElementById('listaUsuarios');
  
  let html = '';
  
  usuarios.forEach(usuario => {
    // Status badge com cores diferentes
    let statusBadge = '';
    if (usuario.status === 'ativo') {
      statusBadge = `<button class="btn-status ativo" onclick="alterarStatusUsuario('${usuario.id}')" title="Clique para desativar">
                       ‚úÖ Ativo
                     </button>`;
    } else {
      statusBadge = `<button class="btn-status inativo" onclick="alterarStatusUsuario('${usuario.id}')" title="Clique para ativar">
                       ‚ùå Inativo
                     </button>`;
    }
    
    // Cargo formatado
    const cargoFormatado = usuario.cargo ? 
      usuario.cargo.charAt(0).toUpperCase() + usuario.cargo.slice(1) : 'N/A';
    
    html += `
      <tr>
        <td><small style="font-weight: bold; color: #007bff;">${usuario.id}</small></td>
        <td><strong>${usuario.nome}</strong></td>
        <td>${usuario.login}</td>
        <td>${cargoFormatado}</td>
        <td>${statusBadge}</td>
        <td>
          <button class="btn-small" onclick="editarUsuario('${usuario.id}')" title="Editar">
            ‚úèÔ∏è
          </button>
          <button class="btn-small danger" onclick="excluirUsuario('${usuario.id}')" title="Excluir">
            üóëÔ∏è
          </button>
          <button class="btn-small primary" onclick="showPage('permissoes_sistema'); setTimeout(() => selecionarUsuarioPermissao('${usuario.id}'), 100);" title="Gerenciar permiss√µes">
            üîí
          </button>
        </td>
      </tr>
    `;
  });
  
  tbody.innerHTML = html;
}

// 5. Alterar status do usu√°rio com confirma√ß√£o
function alterarStatusUsuario(usuarioId) {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuarioIndex = usuarios.findIndex(u => u.id === usuarioId);
  
  if (usuarioIndex !== -1) {
    const usuario = usuarios[usuarioIndex];
    const novoStatus = usuario.status === 'ativo' ? 'inativo' : 'ativo';
    const acao = novoStatus === 'ativo' ? 'ativar' : 'desativar';
    
    if (confirm(`Deseja ${acao} o usu√°rio ${usuario.nome}?`)) {
      usuarios[usuarioIndex].status = novoStatus;
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
      
      // Recarregar lista
      carregarListaUsuarios();
      
      // Atualizar na p√°gina de permiss√µes se estiver vis√≠vel
      const selectPermissao = document.getElementById('selectUsuarioPermissao');
      if (selectPermissao && selectPermissao.value === usuarioId) {
        carregarUsuariosPermissoes(); // Recarregar lista no select
        selectPermissao.value = usuarioId; // Manter selecionado
        carregarPermissoesUsuario(); // Recarregar permiss√µes
      }
      
      alert(`Usu√°rio ${usuario.nome} ${novoStatus === 'ativo' ? 'ativado' : 'desativado'} com sucesso!`);
    }
  }
}

// 6. Limpar formul√°rio e gerar novo ID
function limparFormularioUsuario() {
  document.getElementById('formUsuario').reset();
  
  // Resetar valores espec√≠ficos
  document.getElementById('cargo_usuario').value = 'atendente';
  document.getElementById('data_admissao').value = new Date().toISOString().split('T')[0];
  document.getElementById('senha_usuario').type = 'password';
  document.getElementById('btnMostrarSenha').innerHTML = 'üëÅÔ∏è';
  document.getElementById('btnMostrarSenha').style.background = '#6c757d';
  
  // Gerar novo ID
  document.getElementById('ID_usuario').value = gerarIDUsuario();
}
// ==================== FUN√á√ïES ATUALIZADAS PARA USU√ÅRIOS ====================

// 1. Gerar ID autom√°tico para usu√°rio (USU + n√∫meros + 2026)
function gerarIDUsuario() {
  const timestamp = Date.now().toString();
  const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
  return `USU${timestamp.substring(5)}${random}2026`;
}

// 2. Alternar visibilidade da senha (funcional)
function toggleSenha(inputId, btnId) {
  const senhaInput = document.getElementById(inputId);
  const btn = document.getElementById(btnId);
  
  if (senhaInput.type === 'password') {
    senhaInput.type = 'text';
    btn.innerHTML = 'üôà';
    btn.style.background = '#28a745';
  } else {
    senhaInput.type = 'password';
    btn.innerHTML = 'üëÅÔ∏è';
    btn.style.background = '#6c757d';
  }
}

// 3. Salvar novo usu√°rio (atualizado)
function salvarUsuario() {
  // Validar formul√°rio
  const form = document.getElementById('formUsuario');
  if (!form.checkValidity()) {
    alert('Por favor, preencha todos os campos obrigat√≥rios (*)!');
    return;
  }
  
  // Coletar dados
  const cpf = document.getElementById('cpf_usuario').value;
  const login = document.getElementById('login_usuario').value;
  const senha = document.getElementById('senha_usuario').value;
  const nome = document.getElementById('nome_usuario').value;
  
  // Verificar se campos obrigat√≥rios est√£o preenchidos
  if (!cpf || !login || !senha || !nome) {
    alert('Preencha todos os campos obrigat√≥rios!');
    return;
  }
  
  // Verificar se CPF j√° existe
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  if (usuarios.some(u => u.cpf === cpf)) {
    alert('CPF j√° cadastrado no sistema!');
    return;
  }
  
  // Verificar se login j√° existe
  if (usuarios.some(u => u.login === login)) {
    alert('Login j√° existe! Escolha outro login.');
    return;
  }
  
  // Criar objeto do usu√°rio
  const novoUsuario = {
    id: document.getElementById('ID_usuario').value,
    cpf: cpf,
    nome: nome,
    login: login,
    senha: senha,
    email: document.getElementById('email_usuario').value || '',
    telefone: document.getElementById('telefone_usuario').value || '',
    cargo: document.getElementById('cargo_usuario').value || 'atendente',
    data_admissao: document.getElementById('data_admissao').value || new Date().toISOString().split('T')[0],
    status: 'ativo', // Sempre cadastra como ativo
    criado_em: new Date().toISOString(),
    criado_por: localStorage.getItem('usuarioLogado') ? JSON.parse(localStorage.getItem('usuarioLogado')).nome : 'Sistema',
    permissoes: [],
    permissoes_padrao: ['dashboard', 'eventos_futuros', 'confirmar_dados']
  };
  
  // Salvar no localStorage
  usuarios.push(novoUsuario);
  localStorage.setItem('usuarios', JSON.stringify(usuarios));
  
  // Feedback
  alert(`‚úÖ Usu√°rio ${nome} cadastrado com sucesso!\nID: ${novoUsuario.id}\nLogin: ${login}`);
  
  // Atualizar lista
  carregarListaUsuarios();
  
  // Limpar formul√°rio e gerar novo ID
  limparFormularioUsuario();
  
  // Gerar novo ID autom√°tico
  document.getElementById('ID_usuario').value = gerarIDUsuario();
}

// 4. Carregar lista de usu√°rios com bot√µes de status
function carregarListaUsuarios() {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const tbody = document.getElementById('listaUsuarios');
  
  let html = '';
  
  usuarios.forEach(usuario => {
    // Status badge com cores diferentes
    let statusBadge = '';
    if (usuario.status === 'ativo') {
      statusBadge = `<button class="btn-status ativo" onclick="alterarStatusUsuario('${usuario.id}')" title="Clique para desativar">
                       ‚úÖ Ativo
                     </button>`;
    } else {
      statusBadge = `<button class="btn-status inativo" onclick="alterarStatusUsuario('${usuario.id}')" title="Clique para ativar">
                       ‚ùå Inativo
                     </button>`;
    }
    
    // Cargo formatado
    const cargoFormatado = usuario.cargo ? 
      usuario.cargo.charAt(0).toUpperCase() + usuario.cargo.slice(1) : 'N/A';
    
    html += `
      <tr>
        <td><small style="font-weight: bold; color: #007bff;">${usuario.id}</small></td>
        <td><strong>${usuario.nome}</strong></td>
        <td>${usuario.login}</td>
        <td>${cargoFormatado}</td>
        <td>${statusBadge}</td>
        <td>
          <button class="btn-small" onclick="editarUsuario('${usuario.id}')" title="Editar">
            ‚úèÔ∏è
          </button>
          <button class="btn-small danger" onclick="excluirUsuario('${usuario.id}')" title="Excluir">
            üóëÔ∏è
          </button>
          <button class="btn-small primary" onclick="showPage('permissoes_sistema'); setTimeout(() => selecionarUsuarioPermissao('${usuario.id}'), 100);" title="Gerenciar permiss√µes">
            üîí
          </button>
        </td>
      </tr>
    `;
  });
  
  tbody.innerHTML = html;
}

// 5. Alterar status do usu√°rio com confirma√ß√£o
function alterarStatusUsuario(usuarioId) {
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuarioIndex = usuarios.findIndex(u => u.id === usuarioId);
  
  if (usuarioIndex !== -1) {
    const usuario = usuarios[usuarioIndex];
    const novoStatus = usuario.status === 'ativo' ? 'inativo' : 'ativo';
    const acao = novoStatus === 'ativo' ? 'ativar' : 'desativar';
    
    if (confirm(`Deseja ${acao} o usu√°rio ${usuario.nome}?`)) {
      usuarios[usuarioIndex].status = novoStatus;
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
      
      // Recarregar lista
      carregarListaUsuarios();
      
      // Atualizar na p√°gina de permiss√µes se estiver vis√≠vel
      const selectPermissao = document.getElementById('selectUsuarioPermissao');
      if (selectPermissao && selectPermissao.value === usuarioId) {
        carregarUsuariosPermissoes(); // Recarregar lista no select
        selectPermissao.value = usuarioId; // Manter selecionado
        carregarPermissoesUsuario(); // Recarregar permiss√µes
      }
      
      alert(`Usu√°rio ${usuario.nome} ${novoStatus === 'ativo' ? 'ativado' : 'desativado'} com sucesso!`);
    }
  }
}

// 6. Limpar formul√°rio e gerar novo ID
function limparFormularioUsuario() {
  document.getElementById('formUsuario').reset();
  
  // Resetar valores espec√≠ficos
  document.getElementById('cargo_usuario').value = 'atendente';
  document.getElementById('data_admissao').value = new Date().toISOString().split('T')[0];
  document.getElementById('senha_usuario').type = 'password';
  document.getElementById('btnMostrarSenha').innerHTML = 'üëÅÔ∏è';
  document.getElementById('btnMostrarSenha').style.background = '#6c757d';
  
  // Gerar novo ID
  document.getElementById('ID_usuario').value = gerarIDUsuario();
}
// ==================== FUN√á√ïES ATUALIZADAS PARA PERMISS√ïES ====================

// 1. Carregar apenas usu√°rios ATIVOS no select de permiss√µes
function carregarUsuariosPermissoes() {
  const select = document.getElementById('selectUsuarioPermissao');
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  
  select.innerHTML = '<option value="">‚Äî Selecione um usu√°rio ‚Äî</option>';
  
  // Filtrar apenas usu√°rios ativos
  const usuariosAtivos = usuarios.filter(u => u.status === 'ativo');
  
  if (usuariosAtivos.length === 0) {
    const option = document.createElement('option');
    option.value = '';
    option.textContent = '‚ö†Ô∏è Nenhum usu√°rio ativo encontrado';
    select.appendChild(option);
    return;
  }
  
  usuariosAtivos.forEach(usuario => {
    const option = document.createElement('option');
    option.value = usuario.id;
    option.textContent = `${usuario.nome} (${usuario.login}) - ${usuario.cargo}`;
    select.appendChild(option);
  });
}

// 2. Carregar permiss√µes do usu√°rio selecionado
function carregarPermissoesUsuario() {
  const usuarioId = document.getElementById('selectUsuarioPermissao').value;
  
  if (!usuarioId) {
    document.getElementById('painelPermissoes').style.display = 'none';
    document.getElementById('infoUsuarioSelecionado').style.display = 'none';
    return;
  }
  
  const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
  const usuario = usuarios.find(u => u.id === usuarioId);
  
  if (!usuario) {
    alert('Usu√°rio n√£o encontrado!');
    return;
  }
  
  // Verificar se o usu√°rio est√° ativo
  if (usuario.status !== 'ativo') {
    alert('‚ö†Ô∏è Este usu√°rio est√° INATIVO. Ative-o primeiro para gerenciar permiss√µes.');
    document.getElementById('selectUsuarioPermissao').value = '';
    document.getElementById('painelPermissoes').style.display = 'none';
    document.getElementById('infoUsuarioSelecionado').style.display = 'none';
    return;
  }
  
  // Mostrar informa√ß√µes do usu√°rio
  document.getElementById('nomeUsuarioSelecionado').textContent = usuario.nome;
  document.getElementById('cargoUsuarioSelecionado').textContent = usuario.cargo;
  
  const statusElement = document.getElementById('statusUsuarioSelecionado');
  statusElement.textContent = '‚úÖ Ativo';
  statusElement.className = 'status-ativo';
  
  document.getElementById('infoUsuarioSelecionado').style.display = 'inline-block';
  
  // Mostrar painel de permiss√µes
  document.getElementById('painelPermissoes').style.display = 'block';
  
  // Limpar todas as sele√ß√µes
  document.querySelectorAll('.permissao-check').forEach(checkbox => {
    checkbox.checked = false;
    checkbox.disabled = false;
  });
  
  // Carregar permiss√µes do usu√°rio
  if (usuario.permissoes && Array.isArray(usuario.permissoes)) {
    usuario.permissoes.forEach(pageId => {
      const checkbox = document.querySelector(`.permissao-check[data-page="${pageId}"]`);
      if (checkbox) {
        checkbox.checked = true;
      }
    });
  }
  
  // Adicionar permiss√µes padr√£o se n√£o tiver nenhuma
  if ((!usuario.permissoes || usuario.permissoes.length === 0) && usuario.permissoes_padrao) {
    usuario.permissoes_padrao.forEach(pageId => {
      const checkbox = document.querySelector(`.permissao-check[data-page="${pageId}"]`);
      if (checkbox) {
        checkbox.checked = true;
      }
    });
  }
  
  // Verificar se √© administrador (acesso total)
  if (usuario.cargo === 'administrador') {
    // Marcar todos os checkboxes
    document.querySelectorAll('.permissao-check').forEach(checkbox => {
      checkbox.checked = true;
    });
    
    // Desabilitar checkboxes de configura√ß√µes para n√£o-admins
    document.querySelectorAll('.permissao-check[data-restrito="true"]').forEach(checkbox => {
      checkbox.disabled = false;
      checkbox.title = 'Acesso de administrador';
    });
  } else {
    // Para n√£o-admins, desabilitar checkboxes de configura√ß√µes
    document.querySelectorAll('.permissao-check[data-restrito="true"]').forEach(checkbox => {
      checkbox.disabled = true;
      checkbox.title = 'Apenas para administradores';
    });
  }
}
// Fun√ß√£o para gerar IDs autom√°ticos para todos os formul√°rios
function gerarIDsAutomaticos() {
  const hoje = new Date();
  const timestamp = hoje.getTime().toString();
  const dataFormatada = hoje.toISOString().replace(/[-:T.]/g, '').substring(2, 14);
  
  // IDs espec√≠ficos para cada formul√°rio
  const idsConfig = {
    'ID_cliente': `CLI${dataFormatada}`,
    'ID_casa_de_festas': `CAS${dataFormatada}`,
    'ID_elenco': `ELN${dataFormatada}`,
    'ID_personagens': `PER${dataFormatada}`,
    'ID_motoristas': `MOT${dataFormatada}`,
    'ID_fornecedores': `FOR${dataFormatada}`,
    'ID_funcionarios': `FUN${dataFormatada}`,
    'ID_usuario': `USU${dataFormatada}2026`
  };
  
  // Aplicar IDs quando cada p√°gina for carregada
  Object.keys(idsConfig).forEach(id => {
    const element = document.getElementById(id);
    if (element) {
      element.value = idsConfig[id];
      
      // Adicionar classe especial para IDs autom√°ticos
      element.classList.add('id-automatico');
    }
  });
}

// Executar quando o DOM carregar
document.addEventListener('DOMContentLoaded', function() {
  gerarIDsAutomaticos();
  
  // Recriar ID do usu√°rio quando abrir a p√°gina
  if (document.getElementById('usuarios_sistema')) {
    document.getElementById('ID_usuario').value = gerarIDUsuario();
  }
});

// Fun√ß√£o para recriar ID do usu√°rio quando limpar formul√°rio
function recriarIDUsuario() {
  document.getElementById('ID_usuario').value = gerarIDUsuario();
}
</script>    
</body>
  
